(function(window,document,undefined){var oldL=window.L,L={};L.version="0.6.4";if(typeof module==="object"&&typeof module.exports==="object")module.exports=L;else if(typeof define==="function"&&define.amd)define(L);L.noConflict=function(){window.L=oldL;return this};window.L=L;L.Util={extend:function(dest){var sources=Array.prototype.slice.call(arguments,1),i,j,len,src;for(j=0,len=sources.length;j<len;j++){src=sources[j]||{};for(i in src)if(src.hasOwnProperty(i))dest[i]=src[i]}return dest},bind:function(fn,
obj){var args=arguments.length>2?Array.prototype.slice.call(arguments,2):null;return function(){return fn.apply(obj,args||arguments)}},stamp:function(){var lastId=0,key="_leaflet_id";return function(obj){obj[key]=obj[key]||++lastId;return obj[key]}}(),invokeEach:function(obj,method,context){var i,args;if(typeof obj==="object"){args=Array.prototype.slice.call(arguments,3);for(i in obj)method.apply(context,[i,obj[i]].concat(args));return true}return false},limitExecByInterval:function(fn,time,context){var lock,
execOnUnlock;return function wrapperFn(){var args=arguments;if(lock){execOnUnlock=true;return}lock=true;setTimeout(function(){lock=false;if(execOnUnlock){wrapperFn.apply(context,args);execOnUnlock=false}},time);fn.apply(context,args)}},falseFn:function(){return false},formatNum:function(num,digits){var pow=Math.pow(10,digits||5);return Math.round(num*pow)/pow},trim:function(str){return str.trim?str.trim():str.replace(/^\s+|\s+$/g,"")},splitWords:function(str){return L.Util.trim(str).split(/\s+/)},
setOptions:function(obj,options){obj.options=L.extend({},obj.options,options);return obj.options},getParamString:function(obj,existingUrl,uppercase){var params=[];for(var i in obj)params.push(encodeURIComponent(uppercase?i.toUpperCase():i)+"="+encodeURIComponent(obj[i]));return(!existingUrl||existingUrl.indexOf("?")===-1?"?":"&")+params.join("&")},template:function(str,data){return str.replace(/\{ *([\w_]+) *\}/g,function(str,key){var value=data[key];if(value===undefined)throw new Error("No value provided for variable "+
str);else if(typeof value==="function")value=value(data);return value})},isArray:function(obj){return Object.prototype.toString.call(obj)==="[object Array]"},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="};(function(){function getPrefixed(name){var i,fn,prefixes=["webkit","moz","o","ms"];for(i=0;i<prefixes.length&&!fn;i++)fn=window[prefixes[i]+name];return fn}var lastTime=0;function timeoutDefer(fn){var time=+new Date,timeToCall=Math.max(0,16-(time-lastTime));lastTime=
time+timeToCall;return window.setTimeout(fn,timeToCall)}var requestFn=window.requestAnimationFrame||getPrefixed("RequestAnimationFrame")||timeoutDefer;var cancelFn=window.cancelAnimationFrame||getPrefixed("CancelAnimationFrame")||getPrefixed("CancelRequestAnimationFrame")||function(id){window.clearTimeout(id)};L.Util.requestAnimFrame=function(fn,context,immediate,element){fn=L.bind(fn,context);if(immediate&&requestFn===timeoutDefer)fn();else return requestFn.call(window,fn,element)};L.Util.cancelAnimFrame=
function(id){if(id)cancelFn.call(window,id)}})();L.extend=L.Util.extend;L.bind=L.Util.bind;L.stamp=L.Util.stamp;L.setOptions=L.Util.setOptions;L.Class=function(){};L.Class.extend=function(props){var NewClass=function(){if(this.initialize)this.initialize.apply(this,arguments);if(this._initHooks)this.callInitHooks()};var F=function(){};F.prototype=this.prototype;var proto=new F;proto.constructor=NewClass;NewClass.prototype=proto;for(var i in this)if(this.hasOwnProperty(i)&&i!=="prototype")NewClass[i]=
this[i];if(props.statics){L.extend(NewClass,props.statics);delete props.statics}if(props.includes){L.Util.extend.apply(null,[proto].concat(props.includes));delete props.includes}if(props.options&&proto.options)props.options=L.extend({},proto.options,props.options);L.extend(proto,props);proto._initHooks=[];var parent=this;NewClass.__super__=parent.prototype;proto.callInitHooks=function(){if(this._initHooksCalled)return;if(parent.prototype.callInitHooks)parent.prototype.callInitHooks.call(this);this._initHooksCalled=
true;for(var i=0,len=proto._initHooks.length;i<len;i++)proto._initHooks[i].call(this)};return NewClass};L.Class.include=function(props){L.extend(this.prototype,props)};L.Class.mergeOptions=function(options){L.extend(this.prototype.options,options)};L.Class.addInitHook=function(fn){var args=Array.prototype.slice.call(arguments,1);var init=typeof fn==="function"?fn:function(){this[fn].apply(this,args)};this.prototype._initHooks=this.prototype._initHooks||[];this.prototype._initHooks.push(init)};var eventsKey=
"_leaflet_events";L.Mixin={};L.Mixin.Events={addEventListener:function(types,fn,context){if(L.Util.invokeEach(types,this.addEventListener,this,fn,context))return this;var events=this[eventsKey]=this[eventsKey]||{},contextId=context&&L.stamp(context),i,len,event,type,indexKey,indexLenKey,typeIndex;types=L.Util.splitWords(types);for(i=0,len=types.length;i<len;i++){event={action:fn,context:context||this};type=types[i];if(context){indexKey=type+"_idx";indexLenKey=indexKey+"_len";typeIndex=events[indexKey]=
events[indexKey]||{};if(!typeIndex[contextId]){typeIndex[contextId]=[];events[indexLenKey]=(events[indexLenKey]||0)+1}typeIndex[contextId].push(event)}else{events[type]=events[type]||[];events[type].push(event)}}return this},hasEventListeners:function(type){var events=this[eventsKey];return!!events&&(type in events&&events[type].length>0||type+"_idx"in events&&events[type+"_idx_len"]>0)},removeEventListener:function(types,fn,context){if(!this[eventsKey])return this;if(!types)return this.clearAllEventListeners();
if(L.Util.invokeEach(types,this.removeEventListener,this,fn,context))return this;var events=this[eventsKey],contextId=context&&L.stamp(context),i,len,type,listeners,j,indexKey,indexLenKey,typeIndex,removed;types=L.Util.splitWords(types);for(i=0,len=types.length;i<len;i++){type=types[i];indexKey=type+"_idx";indexLenKey=indexKey+"_len";typeIndex=events[indexKey];if(!fn){delete events[type];delete events[indexKey]}else{listeners=context&&typeIndex?typeIndex[contextId]:events[type];if(listeners){for(j=
listeners.length-1;j>=0;j--)if(listeners[j].action===fn&&(!context||listeners[j].context===context)){removed=listeners.splice(j,1);removed[0].action=L.Util.falseFn}if(context&&typeIndex&&listeners.length===0){delete typeIndex[contextId];events[indexLenKey]--}}}}return this},clearAllEventListeners:function(){delete this[eventsKey];return this},fireEvent:function(type,data){if(!this.hasEventListeners(type))return this;var event=L.Util.extend({},data,{type:type,target:this});var events=this[eventsKey],
listeners,i,len,typeIndex,contextId;if(events[type]){listeners=events[type].slice();for(i=0,len=listeners.length;i<len;i++)listeners[i].action.call(listeners[i].context||this,event)}typeIndex=events[type+"_idx"];for(contextId in typeIndex){listeners=typeIndex[contextId].slice();if(listeners)for(i=0,len=listeners.length;i<len;i++)listeners[i].action.call(listeners[i].context||this,event)}return this},addOneTimeEventListener:function(types,fn,context){if(L.Util.invokeEach(types,this.addOneTimeEventListener,
this,fn,context))return this;var handler=L.bind(function(){this.removeEventListener(types,fn,context).removeEventListener(types,handler,context)},this);return this.addEventListener(types,fn,context).addEventListener(types,handler,context)}};L.Mixin.Events.on=L.Mixin.Events.addEventListener;L.Mixin.Events.off=L.Mixin.Events.removeEventListener;L.Mixin.Events.once=L.Mixin.Events.addOneTimeEventListener;L.Mixin.Events.fire=L.Mixin.Events.fireEvent;(function(){var ie=!!window.ActiveXObject,ie6=ie&&!window.XMLHttpRequest,
ie7=ie&&!document.querySelector,ielt9=ie&&!document.addEventListener,ua=navigator.userAgent.toLowerCase(),webkit=ua.indexOf("webkit")!==-1,chrome=ua.indexOf("chrome")!==-1,phantomjs=ua.indexOf("phantom")!==-1,android=ua.indexOf("android")!==-1,android23=ua.search("android [23]")!==-1,mobile=typeof orientation!==undefined+"",msTouch=window.navigator&&window.navigator.msPointerEnabled&&window.navigator.msMaxTouchPoints,retina="devicePixelRatio"in window&&window.devicePixelRatio>1||"matchMedia"in window&&
window.matchMedia("(min-resolution:144dpi)")&&window.matchMedia("(min-resolution:144dpi)").matches,doc=document.documentElement,ie3d=ie&&"transition"in doc.style,webkit3d="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix,gecko3d="MozPerspective"in doc.style,opera3d="OTransition"in doc.style,any3d=!window.L_DISABLE_3D&&(ie3d||webkit3d||gecko3d||opera3d)&&!phantomjs;var touch=!window.L_NO_TOUCH&&!phantomjs&&function(){var startName="ontouchstart";if(msTouch||startName in doc)return true;
var div=document.createElement("div"),supported=false;if(!div.setAttribute)return false;div.setAttribute(startName,"return;");if(typeof div[startName]==="function")supported=true;div.removeAttribute(startName);div=null;return supported}();L.Browser={ie:ie,ie6:ie6,ie7:ie7,ielt9:ielt9,webkit:webkit,android:android,android23:android23,chrome:chrome,ie3d:ie3d,webkit3d:webkit3d,gecko3d:gecko3d,opera3d:opera3d,any3d:any3d,mobile:mobile,mobileWebkit:mobile&&webkit,mobileWebkit3d:mobile&&webkit3d,mobileOpera:mobile&&
window.opera,touch:touch,msTouch:msTouch,retina:retina}})();L.Point=function(x,y,round){this.x=round?Math.round(x):x;this.y=round?Math.round(y):y};L.Point.prototype={clone:function(){return new L.Point(this.x,this.y)},add:function(point){return this.clone()._add(L.point(point))},_add:function(point){this.x+=point.x;this.y+=point.y;return this},subtract:function(point){return this.clone()._subtract(L.point(point))},_subtract:function(point){this.x-=point.x;this.y-=point.y;return this},divideBy:function(num){return this.clone()._divideBy(num)},
_divideBy:function(num){this.x/=num;this.y/=num;return this},multiplyBy:function(num){return this.clone()._multiplyBy(num)},_multiplyBy:function(num){this.x*=num;this.y*=num;return this},round:function(){return this.clone()._round()},_round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},floor:function(){return this.clone()._floor()},_floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},distanceTo:function(point){point=L.point(point);var x=
point.x-this.x,y=point.y-this.y;return Math.sqrt(x*x+y*y)},equals:function(point){point=L.point(point);return point.x===this.x&&point.y===this.y},contains:function(point){point=L.point(point);return Math.abs(point.x)<=Math.abs(this.x)&&Math.abs(point.y)<=Math.abs(this.y)},toString:function(){return"Point("+L.Util.formatNum(this.x)+", "+L.Util.formatNum(this.y)+")"}};L.point=function(x,y,round){if(x instanceof L.Point)return x;if(L.Util.isArray(x))return new L.Point(x[0],x[1]);if(x===undefined||x===
null)return x;return new L.Point(x,y,round)};L.Bounds=function(a,b){if(!a)return;var points=b?[a,b]:a;for(var i=0,len=points.length;i<len;i++)this.extend(points[i])};L.Bounds.prototype={extend:function(point){point=L.point(point);if(!this.min&&!this.max){this.min=point.clone();this.max=point.clone()}else{this.min.x=Math.min(point.x,this.min.x);this.max.x=Math.max(point.x,this.max.x);this.min.y=Math.min(point.y,this.min.y);this.max.y=Math.max(point.y,this.max.y)}return this},getCenter:function(round){return new L.Point((this.min.x+
this.max.x)/2,(this.min.y+this.max.y)/2,round)},getBottomLeft:function(){return new L.Point(this.min.x,this.max.y)},getTopRight:function(){return new L.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(obj){var min,max;if(typeof obj[0]==="number"||obj instanceof L.Point)obj=L.point(obj);else obj=L.bounds(obj);if(obj instanceof L.Bounds){min=obj.min;max=obj.max}else min=max=obj;return min.x>=this.min.x&&max.x<=this.max.x&&min.y>=this.min.y&&max.y<=
this.max.y},intersects:function(bounds){bounds=L.bounds(bounds);var min=this.min,max=this.max,min2=bounds.min,max2=bounds.max,xIntersects=max2.x>=min.x&&min2.x<=max.x,yIntersects=max2.y>=min.y&&min2.y<=max.y;return xIntersects&&yIntersects},isValid:function(){return!!(this.min&&this.max)}};L.bounds=function(a,b){if(!a||a instanceof L.Bounds)return a;return new L.Bounds(a,b)};L.Transformation=function(a,b,c,d){this._a=a;this._b=b;this._c=c;this._d=d};L.Transformation.prototype={transform:function(point,
scale){return this._transform(point.clone(),scale)},_transform:function(point,scale){scale=scale||1;point.x=scale*(this._a*point.x+this._b);point.y=scale*(this._c*point.y+this._d);return point},untransform:function(point,scale){scale=scale||1;return new L.Point((point.x/scale-this._b)/this._a,(point.y/scale-this._d)/this._c)}};L.DomUtil={get:function(id){return typeof id==="string"?document.getElementById(id):id},getStyle:function(el,style){var value=el.style[style];if(!value&&el.currentStyle)value=
el.currentStyle[style];if((!value||value==="auto")&&document.defaultView){var css=document.defaultView.getComputedStyle(el,null);value=css?css[style]:null}return value==="auto"?null:value},getViewportOffset:function(element){var top=0,left=0,el=element,docBody=document.body,docEl=document.documentElement,pos,ie7=L.Browser.ie7;do{top+=el.offsetTop||0;left+=el.offsetLeft||0;top+=parseInt(L.DomUtil.getStyle(el,"borderTopWidth"),10)||0;left+=parseInt(L.DomUtil.getStyle(el,"borderLeftWidth"),10)||0;pos=
L.DomUtil.getStyle(el,"position");if(el.offsetParent===docBody&&pos==="absolute")break;if(pos==="fixed"){top+=docBody.scrollTop||docEl.scrollTop||0;left+=docBody.scrollLeft||docEl.scrollLeft||0;break}if(pos==="relative"&&!el.offsetLeft){var width=L.DomUtil.getStyle(el,"width"),maxWidth=L.DomUtil.getStyle(el,"max-width"),r=el.getBoundingClientRect();if(width!=="none"||maxWidth!=="none")left+=r.left+el.clientLeft;top+=r.top+(docBody.scrollTop||docEl.scrollTop||0);break}el=el.offsetParent}while(el);
el=element;do{if(el===docBody)break;top-=el.scrollTop||0;left-=el.scrollLeft||0;if(!L.DomUtil.documentIsLtr()&&(L.Browser.webkit||ie7)){left+=el.scrollWidth-el.clientWidth;if(ie7&&L.DomUtil.getStyle(el,"overflow-y")!=="hidden"&&L.DomUtil.getStyle(el,"overflow")!=="hidden")left+=17}el=el.parentNode}while(el);return new L.Point(left,top)},documentIsLtr:function(){if(!L.DomUtil._docIsLtrCached){L.DomUtil._docIsLtrCached=true;L.DomUtil._docIsLtr=L.DomUtil.getStyle(document.body,"direction")==="ltr"}return L.DomUtil._docIsLtr},
create:function(tagName,className,container){var el=document.createElement(tagName);el.className=className;if(container)container.appendChild(el);return el},hasClass:function(el,name){return el.className.length>0&&(new RegExp("(^|\\s)"+name+"(\\s|$)")).test(el.className)},addClass:function(el,name){if(!L.DomUtil.hasClass(el,name))el.className+=(el.className?" ":"")+name},removeClass:function(el,name){el.className=L.Util.trim((" "+el.className+" ").replace(" "+name+" "," "))},setOpacity:function(el,
value){if("opacity"in el.style)el.style.opacity=value;else if("filter"in el.style){var filter=false,filterName="DXImageTransform.Microsoft.Alpha";try{filter=el.filters.item(filterName)}catch(e){if(value===1)return}value=Math.round(value*100);if(filter){filter.Enabled=value!==100;filter.Opacity=value}else el.style.filter+=" progid:"+filterName+"(opacity="+value+")"}},testProp:function(props){var style=document.documentElement.style;for(var i=0;i<props.length;i++)if(props[i]in style)return props[i];
return false},getTranslateString:function(point){var is3d=L.Browser.webkit3d,open="translate"+(is3d?"3d":"")+"(",close=(is3d?",0":"")+")";return open+point.x+"px,"+point.y+"px"+close},getScaleString:function(scale,origin){var preTranslateStr=L.DomUtil.getTranslateString(origin.add(origin.multiplyBy(-1*scale))),scaleStr=" scale("+scale+") ";return preTranslateStr+scaleStr},setPosition:function(el,point,disable3D){el._leaflet_pos=point;if(!disable3D&&L.Browser.any3d){el.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(point);
if(L.Browser.mobileWebkit3d)el.style.WebkitBackfaceVisibility="hidden"}else{el.style.left=point.x+"px";el.style.top=point.y+"px"}},getPosition:function(el){return el._leaflet_pos}};L.DomUtil.TRANSFORM=L.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]);L.DomUtil.TRANSITION=L.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]);L.DomUtil.TRANSITION_END=L.DomUtil.TRANSITION==="webkitTransition"||L.DomUtil.TRANSITION===
"OTransition"?L.DomUtil.TRANSITION+"End":"transitionend";(function(){var userSelectProperty=L.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);L.extend(L.DomUtil,{disableTextSelection:function(){L.DomEvent.on(window,"selectstart",L.DomEvent.preventDefault);if(userSelectProperty){var style=document.documentElement.style;this._userSelect=style[userSelectProperty];style[userSelectProperty]="none"}},enableTextSelection:function(){L.DomEvent.off(window,"selectstart",
L.DomEvent.preventDefault);if(userSelectProperty){document.documentElement.style[userSelectProperty]=this._userSelect;delete this._userSelect}},disableImageDrag:function(){L.DomEvent.on(window,"dragstart",L.DomEvent.preventDefault)},enableImageDrag:function(){L.DomEvent.off(window,"dragstart",L.DomEvent.preventDefault)}})})();L.LatLng=function(rawLat,rawLng){var lat=parseFloat(rawLat),lng=parseFloat(rawLng);if(isNaN(lat)||isNaN(lng))throw new Error("Invalid LatLng object: ("+rawLat+", "+rawLng+")");
this.lat=lat;this.lng=lng};L.extend(L.LatLng,{DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MAX_MARGIN:1.0E-9});L.LatLng.prototype={equals:function(obj){if(!obj)return false;obj=L.latLng(obj);var margin=Math.max(Math.abs(this.lat-obj.lat),Math.abs(this.lng-obj.lng));return margin<=L.LatLng.MAX_MARGIN},toString:function(precision){return"LatLng("+L.Util.formatNum(this.lat,precision)+", "+L.Util.formatNum(this.lng,precision)+")"},distanceTo:function(other){other=L.latLng(other);var R=6378137,d2r=L.LatLng.DEG_TO_RAD,
dLat=(other.lat-this.lat)*d2r,dLon=(other.lng-this.lng)*d2r,lat1=this.lat*d2r,lat2=other.lat*d2r,sin1=Math.sin(dLat/2),sin2=Math.sin(dLon/2);var a=sin1*sin1+sin2*sin2*Math.cos(lat1)*Math.cos(lat2);return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))},wrap:function(a,b){var lng=this.lng;a=a||-180;b=b||180;lng=(lng+b)%(b-a)+(lng<a||lng===b?b:a);return new L.LatLng(this.lat,lng)}};L.latLng=function(a,b){if(a instanceof L.LatLng)return a;if(L.Util.isArray(a))return new L.LatLng(a[0],a[1]);if(a===undefined||
a===null)return a;if(typeof a==="object"&&"lat"in a)return new L.LatLng(a.lat,"lng"in a?a.lng:a.lon);return new L.LatLng(a,b)};L.LatLngBounds=function(southWest,northEast){if(!southWest)return;var latlngs=northEast?[southWest,northEast]:southWest;for(var i=0,len=latlngs.length;i<len;i++)this.extend(latlngs[i])};L.LatLngBounds.prototype={extend:function(obj){if(!obj)return this;if(typeof obj[0]==="number"||typeof obj[0]==="string"||obj instanceof L.LatLng)obj=L.latLng(obj);else obj=L.latLngBounds(obj);
if(obj instanceof L.LatLng)if(!this._southWest&&!this._northEast){this._southWest=new L.LatLng(obj.lat,obj.lng);this._northEast=new L.LatLng(obj.lat,obj.lng)}else{this._southWest.lat=Math.min(obj.lat,this._southWest.lat);this._southWest.lng=Math.min(obj.lng,this._southWest.lng);this._northEast.lat=Math.max(obj.lat,this._northEast.lat);this._northEast.lng=Math.max(obj.lng,this._northEast.lng)}else if(obj instanceof L.LatLngBounds){this.extend(obj._southWest);this.extend(obj._northEast)}return this},
pad:function(bufferRatio){var sw=this._southWest,ne=this._northEast,heightBuffer=Math.abs(sw.lat-ne.lat)*bufferRatio,widthBuffer=Math.abs(sw.lng-ne.lng)*bufferRatio;return new L.LatLngBounds(new L.LatLng(sw.lat-heightBuffer,sw.lng-widthBuffer),new L.LatLng(ne.lat+heightBuffer,ne.lng+widthBuffer))},getCenter:function(){return new L.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},
getNorthWest:function(){return new L.LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new L.LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(obj){if(typeof obj[0]==="number"||obj instanceof L.LatLng)obj=L.latLng(obj);else obj=L.latLngBounds(obj);var sw=this._southWest,ne=this._northEast,
sw2,ne2;if(obj instanceof L.LatLngBounds){sw2=obj.getSouthWest();ne2=obj.getNorthEast()}else sw2=ne2=obj;return sw2.lat>=sw.lat&&ne2.lat<=ne.lat&&sw2.lng>=sw.lng&&ne2.lng<=ne.lng},intersects:function(bounds){bounds=L.latLngBounds(bounds);var sw=this._southWest,ne=this._northEast,sw2=bounds.getSouthWest(),ne2=bounds.getNorthEast(),latIntersects=ne2.lat>=sw.lat&&sw2.lat<=ne.lat,lngIntersects=ne2.lng>=sw.lng&&sw2.lng<=ne.lng;return latIntersects&&lngIntersects},toBBoxString:function(){return[this.getWest(),
this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(bounds){if(!bounds)return false;bounds=L.latLngBounds(bounds);return this._southWest.equals(bounds.getSouthWest())&&this._northEast.equals(bounds.getNorthEast())},isValid:function(){return!!(this._southWest&&this._northEast)}};L.latLngBounds=function(a,b){if(!a||a instanceof L.LatLngBounds)return a;return new L.LatLngBounds(a,b)};L.Projection={};L.Projection.SphericalMercator={MAX_LATITUDE:85.0511287798,project:function(latlng){var d=
L.LatLng.DEG_TO_RAD,max=this.MAX_LATITUDE,lat=Math.max(Math.min(max,latlng.lat),-max),x=latlng.lng*d,y=lat*d;y=Math.log(Math.tan(Math.PI/4+y/2));return new L.Point(x,y)},unproject:function(point){var d=L.LatLng.RAD_TO_DEG,lng=point.x*d,lat=(2*Math.atan(Math.exp(point.y))-Math.PI/2)*d;return new L.LatLng(lat,lng)}};L.Projection.LonLat={project:function(latlng){return new L.Point(latlng.lng,latlng.lat)},unproject:function(point){return new L.LatLng(point.y,point.x)}};L.CRS={latLngToPoint:function(latlng,
zoom){var projectedPoint=this.projection.project(latlng),scale=this.scale(zoom);return this.transformation.transform(projectedPoint,scale)},pointToLatLng:function(point,zoom){var scale=this.scale(zoom),untransformedPoint=this.transformation.untransform(point,scale);return this.projection.unproject(untransformedPoint)},project:function(latlng){return this.projection.project(latlng)},scale:function(zoom){return 256*Math.pow(2,zoom)}};L.CRS.Simple=L.extend({},L.CRS,{projection:L.Projection.LonLat,transformation:new L.Transformation(1,
0,-1,0),scale:function(zoom){return Math.pow(2,zoom)}});L.CRS.EPSG3857=L.extend({},L.CRS,{code:"EPSG:3857",projection:L.Projection.SphericalMercator,transformation:new L.Transformation(0.5/Math.PI,0.5,-0.5/Math.PI,0.5),project:function(latlng){var projectedPoint=this.projection.project(latlng),earthRadius=6378137;return projectedPoint.multiplyBy(earthRadius)}});L.CRS.EPSG900913=L.extend({},L.CRS.EPSG3857,{code:"EPSG:900913"});L.CRS.EPSG4326=L.extend({},L.CRS,{code:"EPSG:4326",projection:L.Projection.LonLat,
transformation:new L.Transformation(1/360,0.5,-1/360,0.5)});L.Map=L.Class.extend({includes:L.Mixin.Events,options:{crs:L.CRS.EPSG3857,fadeAnimation:false,trackResize:true,markerZoomAnimation:L.DomUtil.TRANSITION&&L.Browser.any3d},initialize:function(id,options){options=L.setOptions(this,options);this._initContainer(id);this._initLayout();this._initEvents();if(options.maxBounds)this.setMaxBounds(options.maxBounds);if(options.center&&options.zoom!==undefined)this.setView(L.latLng(options.center),options.zoom,
{reset:true});this._handlers=[];this._layers={};this._zoomBoundLayers={};this._tileLayersNum=0;this.callInitHooks();this._addLayers(options.layers)},setView:function(center,zoom){this._resetView(L.latLng(center),this._limitZoom(zoom));return this},setZoom:function(zoom,options){return this.setView(this.getCenter(),zoom,{zoom:options})},zoomIn:function(delta,options){return this.setZoom(this._zoom+(delta||1),options)},zoomOut:function(delta,options){return this.setZoom(this._zoom-(delta||1),options)},
setZoomAround:function(latlng,zoom,options){var scale=this.getZoomScale(zoom),viewHalf=this.getSize().divideBy(2),containerPoint=latlng instanceof L.Point?latlng:this.latLngToContainerPoint(latlng),centerOffset=containerPoint.subtract(viewHalf).multiplyBy(1-1/scale),newCenter=this.containerPointToLatLng(viewHalf.add(centerOffset));return this.setView(newCenter,zoom,{zoom:options})},fitBounds:function(bounds,options){options=options||{};bounds=bounds.getBounds?bounds.getBounds():L.latLngBounds(bounds);
var paddingTL=L.point(options.paddingTopLeft||options.padding||[0,0]),paddingBR=L.point(options.paddingBottomRight||options.padding||[0,0]),zoom=this.getBoundsZoom(bounds,false,paddingTL.add(paddingBR)),paddingOffset=paddingBR.subtract(paddingTL).divideBy(2),swPoint=this.project(bounds.getSouthWest(),zoom),nePoint=this.project(bounds.getNorthEast(),zoom),center=this.unproject(swPoint.add(nePoint).divideBy(2).add(paddingOffset),zoom);return this.setView(center,zoom,options)},fitWorld:function(options){return this.fitBounds([[-90,
-180],[90,180]],options)},panTo:function(center,options){return this.setView(center,this._zoom,{pan:options})},panBy:function(offset){this.fire("movestart");this._rawPanBy(L.point(offset));this.fire("move");return this.fire("moveend")},setMaxBounds:function(bounds,options){bounds=L.latLngBounds(bounds);this.options.maxBounds=bounds;if(!bounds){this._boundsMinZoom=null;this.off("moveend",this._panInsideMaxBounds,this);return this}var minZoom=this.getBoundsZoom(bounds,true);this._boundsMinZoom=minZoom;
if(this._loaded)if(this._zoom<minZoom)this.setView(bounds.getCenter(),minZoom,options);else this.panInsideBounds(bounds);this.on("moveend",this._panInsideMaxBounds,this);return this},panInsideBounds:function(bounds){bounds=L.latLngBounds(bounds);var viewBounds=this.getPixelBounds(),viewSw=viewBounds.getBottomLeft(),viewNe=viewBounds.getTopRight(),sw=this.project(bounds.getSouthWest()),ne=this.project(bounds.getNorthEast()),dx=0,dy=0;if(viewNe.y<ne.y)dy=Math.ceil(ne.y-viewNe.y);if(viewNe.x>ne.x)dx=
Math.floor(ne.x-viewNe.x);if(viewSw.y>sw.y)dy=Math.floor(sw.y-viewSw.y);if(viewSw.x<sw.x)dx=Math.ceil(sw.x-viewSw.x);if(dx||dy)return this.panBy([dx,dy]);return this},addLayer:function(layer){var id=L.stamp(layer);if(this._layers[id])return this;this._layers[id]=layer;if(layer.options&&(!isNaN(layer.options.maxZoom)||!isNaN(layer.options.minZoom))){this._zoomBoundLayers[id]=layer;this._updateZoomLevels()}if(this.options.zoomAnimation&&L.TileLayer&&layer instanceof L.TileLayer){this._tileLayersNum++;
this._tileLayersToLoad++;layer.on("load",this._onTileLayerLoad,this)}if(this._loaded)this._layerAdd(layer);return this},removeLayer:function(layer){var id=L.stamp(layer);if(!this._layers[id])return;if(this._loaded)layer.onRemove(this);delete this._layers[id];if(this._loaded)this.fire("layerremove",{layer:layer});if(this._zoomBoundLayers[id]){delete this._zoomBoundLayers[id];this._updateZoomLevels()}if(this.options.zoomAnimation&&L.TileLayer&&layer instanceof L.TileLayer){this._tileLayersNum--;this._tileLayersToLoad--;
layer.off("load",this._onTileLayerLoad,this)}return this},hasLayer:function(layer){if(!layer)return false;return L.stamp(layer)in this._layers},eachLayer:function(method,context){for(var i in this._layers)method.call(context,this._layers[i]);return this},invalidateSize:function(options){options=L.extend({animate:false,pan:true},options===true?{animate:true}:options);var oldSize=this.getSize();this._sizeChanged=true;if(this.options.maxBounds)this.setMaxBounds(this.options.maxBounds);if(!this._loaded)return this;
var newSize=this.getSize(),offset=oldSize.subtract(newSize).divideBy(2).round();if(!offset.x&&!offset.y)return this;if(options.animate&&options.pan)this.panBy(offset);else{if(options.pan)this._rawPanBy(offset);this.fire("move");clearTimeout(this._sizeTimer);this._sizeTimer=setTimeout(L.bind(this.fire,this,"moveend"),200)}return this.fire("resize",{oldSize:oldSize,newSize:newSize})},addHandler:function(name,HandlerClass){if(!HandlerClass)return;var handler=this[name]=new HandlerClass(this);this._handlers.push(handler);
if(this.options[name])handler.enable();return this},remove:function(){if(this._loaded)this.fire("unload");this._initEvents("off");delete this._container._leaflet;this._clearPanes();if(this._clearControlPos)this._clearControlPos();this._clearHandlers();return this},getCenter:function(){this._checkIfLoaded();if(!this._moved())return this._initialCenter;return this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var bounds=this.getPixelBounds(),
sw=this.unproject(bounds.getBottomLeft()),ne=this.unproject(bounds.getTopRight());return new L.LatLngBounds(sw,ne)},getMinZoom:function(){var z1=this._layersMinZoom===undefined?0:this._layersMinZoom,z2=this._boundsMinZoom===undefined?0:this._boundsMinZoom;return this.options.minZoom===undefined?Math.max(z1,z2):this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===undefined?this._layersMaxZoom===undefined?Infinity:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(bounds,
inside,padding){bounds=L.latLngBounds(bounds);var zoom=this.getMinZoom()-(inside?1:0),maxZoom=this.getMaxZoom(),size=this.getSize(),nw=bounds.getNorthWest(),se=bounds.getSouthEast(),zoomNotFound=true,boundsSize;padding=L.point(padding||[0,0]);do{zoom++;boundsSize=this.project(se,zoom).subtract(this.project(nw,zoom)).add(padding);zoomNotFound=!inside?size.contains(boundsSize):boundsSize.x<size.x||boundsSize.y<size.y}while(zoomNotFound&&zoom<=maxZoom);if(zoomNotFound&&inside)return null;return inside?
zoom:zoom-1},getSize:function(){if(!this._size||this._sizeChanged){this._size=new L.Point(this._container.clientWidth,this._container.clientHeight);this._sizeChanged=false}return this._size.clone()},getPixelBounds:function(){var topLeftPoint=this._getTopLeftPoint();return new L.Bounds(topLeftPoint,topLeftPoint.add(this.getSize()))},getPixelOrigin:function(){this._checkIfLoaded();return this._initialTopLeftPoint},getPanes:function(){return this._panes},getContainer:function(){return this._container},
getZoomScale:function(toZoom){var crs=this.options.crs;return crs.scale(toZoom)/crs.scale(this._zoom)},getScaleZoom:function(scale){return this._zoom+Math.log(scale)/Math.LN2},project:function(latlng,zoom){zoom=zoom===undefined?this._zoom:zoom;return this.options.crs.latLngToPoint(L.latLng(latlng),zoom)},unproject:function(point,zoom){zoom=zoom===undefined?this._zoom:zoom;return this.options.crs.pointToLatLng(L.point(point),zoom)},layerPointToLatLng:function(point){var projectedPoint=L.point(point).add(this.getPixelOrigin());
return this.unproject(projectedPoint)},latLngToLayerPoint:function(latlng){var projectedPoint=this.project(L.latLng(latlng))._round();return projectedPoint._subtract(this.getPixelOrigin())},containerPointToLayerPoint:function(point){return L.point(point).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(point){return L.point(point).add(this._getMapPanePos())},containerPointToLatLng:function(point){var layerPoint=this.containerPointToLayerPoint(L.point(point));return this.layerPointToLatLng(layerPoint)},
latLngToContainerPoint:function(latlng){return this.layerPointToContainerPoint(this.latLngToLayerPoint(L.latLng(latlng)))},mouseEventToContainerPoint:function(e){return L.DomEvent.getMousePosition(e,this._container)},mouseEventToLayerPoint:function(e){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e))},mouseEventToLatLng:function(e){return this.layerPointToLatLng(this.mouseEventToLayerPoint(e))},_initContainer:function(id){var container=this._container=L.DomUtil.get(id);if(!container)throw new Error("Map container not found.");
else if(container._leaflet)throw new Error("Map container is already initialized.");container._leaflet=true},_initLayout:function(){var container=this._container;L.DomUtil.addClass(container,"leaflet-container"+(L.Browser.touch?" leaflet-touch":"")+(L.Browser.retina?" leaflet-retina":"")+(this.options.fadeAnimation?" leaflet-fade-anim":""));var position=L.DomUtil.getStyle(container,"position");if(position!=="absolute"&&position!=="relative"&&position!=="fixed")container.style.position="relative";
this._initPanes();if(this._initControlPos)this._initControlPos()},_initPanes:function(){var panes=this._panes={};this._mapPane=panes.mapPane=this._createPane("leaflet-map-pane",this._container);this._tilePane=panes.tilePane=this._createPane("leaflet-tile-pane",this._mapPane);panes.objectsPane=this._createPane("leaflet-objects-pane",this._mapPane);panes.shadowPane=this._createPane("leaflet-shadow-pane");panes.overlayPane=this._createPane("leaflet-overlay-pane");panes.markerPane=this._createPane("leaflet-marker-pane");
panes.popupPane=this._createPane("leaflet-popup-pane");var zoomHide=" leaflet-zoom-hide";if(!this.options.markerZoomAnimation){L.DomUtil.addClass(panes.markerPane,zoomHide);L.DomUtil.addClass(panes.shadowPane,zoomHide);L.DomUtil.addClass(panes.popupPane,zoomHide)}},_createPane:function(className,container){return L.DomUtil.create("div",className,container||this._panes.objectsPane)},_clearPanes:function(){this._container.removeChild(this._mapPane)},_addLayers:function(layers){layers=layers?L.Util.isArray(layers)?
layers:[layers]:[];for(var i=0,len=layers.length;i<len;i++)this.addLayer(layers[i])},_resetView:function(center,zoom,preserveMapOffset,afterZoomAnim){var zoomChanged=this._zoom!==zoom;if(!afterZoomAnim){this.fire("movestart");if(zoomChanged)this.fire("zoomstart")}this._zoom=zoom;this._initialCenter=center;this._initialTopLeftPoint=this._getNewTopLeftPoint(center);if(!preserveMapOffset)L.DomUtil.setPosition(this._mapPane,new L.Point(0,0));else this._initialTopLeftPoint._add(this._getMapPanePos());
this._tileLayersToLoad=this._tileLayersNum;var loading=!this._loaded;this._loaded=true;if(loading){this.fire("load");this.eachLayer(this._layerAdd,this)}this.fire("viewreset",{hard:!preserveMapOffset});this.fire("move");if(zoomChanged||afterZoomAnim)this.fire("zoomend");this.fire("moveend",{hard:!preserveMapOffset})},_rawPanBy:function(offset){L.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(offset))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_updateZoomLevels:function(){var i,
minZoom=Infinity,maxZoom=-Infinity,oldZoomSpan=this._getZoomSpan();for(i in this._zoomBoundLayers){var layer=this._zoomBoundLayers[i];if(!isNaN(layer.options.minZoom))minZoom=Math.min(minZoom,layer.options.minZoom);if(!isNaN(layer.options.maxZoom))maxZoom=Math.max(maxZoom,layer.options.maxZoom)}if(i===undefined)this._layersMaxZoom=this._layersMinZoom=undefined;else{this._layersMaxZoom=maxZoom;this._layersMinZoom=minZoom}if(oldZoomSpan!==this._getZoomSpan())this.fire("zoomlevelschange")},_panInsideMaxBounds:function(){this.panInsideBounds(this.options.maxBounds)},
_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.");},_initEvents:function(onOff){if(!L.DomEvent)return;onOff=onOff||"on";L.DomEvent[onOff](this._container,"click",this._onMouseClick,this);var events=["dblclick","mousedown","mouseup","mouseenter","mouseleave","mousemove","contextmenu"],i,len;for(i=0,len=events.length;i<len;i++)L.DomEvent[onOff](this._container,events[i],this._fireMouseEvent,this);if(this.options.trackResize)L.DomEvent[onOff](window,"resize",
this._onResize,this)},_onResize:function(){L.Util.cancelAnimFrame(this._resizeRequest);this._resizeRequest=L.Util.requestAnimFrame(this.invalidateSize,this,false,this._container)},_onMouseClick:function(e){if(!this._loaded||!e._simulated&&this.dragging&&this.dragging.moved()||L.DomEvent._skipped(e))return;this.fire("preclick");this._fireMouseEvent(e)},_fireMouseEvent:function(e){if(!this._loaded||L.DomEvent._skipped(e))return;var type=e.type;type=type==="mouseenter"?"mouseover":type==="mouseleave"?
"mouseout":type;if(!this.hasEventListeners(type))return;if(type==="contextmenu")L.DomEvent.preventDefault(e);var containerPoint=this.mouseEventToContainerPoint(e),layerPoint=this.containerPointToLayerPoint(containerPoint),latlng=this.layerPointToLatLng(layerPoint);this.fire(type,{latlng:latlng,layerPoint:layerPoint,containerPoint:containerPoint,originalEvent:e})},_onTileLayerLoad:function(){this._tileLayersToLoad--;if(this._tileLayersNum&&!this._tileLayersToLoad)this.fire("tilelayersload")},_clearHandlers:function(){for(var i=
0,len=this._handlers.length;i<len;i++)this._handlers[i].disable()},whenReady:function(callback,context){if(this._loaded)callback.call(context||this,this);else this.on("load",callback,context);return this},_layerAdd:function(layer){layer.onAdd(this);this.fire("layeradd",{layer:layer})},_getMapPanePos:function(){return L.DomUtil.getPosition(this._mapPane)},_moved:function(){var pos=this._getMapPanePos();return pos&&!pos.equals([0,0])},_getTopLeftPoint:function(){return this.getPixelOrigin().subtract(this._getMapPanePos())},
_getNewTopLeftPoint:function(center,zoom){var viewHalf=this.getSize()._divideBy(2);return this.project(center,zoom)._subtract(viewHalf)._round()},_latLngToNewLayerPoint:function(latlng,newZoom,newCenter){var topLeft=this._getNewTopLeftPoint(newCenter,newZoom).add(this._getMapPanePos());return this.project(latlng,newZoom)._subtract(topLeft)},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(latlng){return this.latLngToLayerPoint(latlng).subtract(this._getCenterLayerPoint())},
_limitZoom:function(zoom){var min=this.getMinZoom(),max=this.getMaxZoom();return Math.max(min,Math.min(max,zoom))}});L.map=function(id,options){return new L.Map(id,options)};L.Projection.Mercator={MAX_LATITUDE:85.0840591556,R_MINOR:6356752.314245179,R_MAJOR:6378137,project:function(latlng){var d=L.LatLng.DEG_TO_RAD,max=this.MAX_LATITUDE,lat=Math.max(Math.min(max,latlng.lat),-max),r=this.R_MAJOR,r2=this.R_MINOR,x=latlng.lng*d*r,y=lat*d,tmp=r2/r,eccent=Math.sqrt(1-tmp*tmp),con=eccent*Math.sin(y);con=
Math.pow((1-con)/(1+con),eccent*0.5);var ts=Math.tan(0.5*(Math.PI*0.5-y))/con;y=-r*Math.log(ts);return new L.Point(x,y)},unproject:function(point){var d=L.LatLng.RAD_TO_DEG,r=this.R_MAJOR,r2=this.R_MINOR,lng=point.x*d/r,tmp=r2/r,eccent=Math.sqrt(1-tmp*tmp),ts=Math.exp(-point.y/r),phi=Math.PI/2-2*Math.atan(ts),numIter=15,tol=1.0E-7,i=numIter,dphi=0.1,con;while(Math.abs(dphi)>tol&&--i>0){con=eccent*Math.sin(phi);dphi=Math.PI/2-2*Math.atan(ts*Math.pow((1-con)/(1+con),0.5*eccent))-phi;phi+=dphi}return new L.LatLng(phi*
d,lng)}};L.CRS.EPSG3395=L.extend({},L.CRS,{code:"EPSG:3395",projection:L.Projection.Mercator,transformation:function(){var m=L.Projection.Mercator,r=m.R_MAJOR,r2=m.R_MINOR;return new L.Transformation(0.5/(Math.PI*r),0.5,-0.5/(Math.PI*r2),0.5)}()});L.TileLayer=L.Class.extend({includes:L.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",zoomOffset:0,opacity:1,unloadInvisibleTiles:L.Browser.mobile,updateWhenIdle:L.Browser.mobile},initialize:function(url,
options){options=L.setOptions(this,options);if(options.detectRetina&&L.Browser.retina&&options.maxZoom>0){options.tileSize=Math.floor(options.tileSize/2);options.zoomOffset++;if(options.minZoom>0)options.minZoom--;this.options.maxZoom--}if(options.bounds)options.bounds=L.latLngBounds(options.bounds);this._url=url;var subdomains=this.options.subdomains;if(typeof subdomains==="string")this.options.subdomains=subdomains.split("")},onAdd:function(map){this._map=map;this._animated=map._zoomAnimated;this._initContainer();
this._createTileProto();map.on({"viewreset":this._reset,"moveend":this._update},this);if(this._animated)map.on({"zoomanim":this._animateZoom,"zoomend":this._endZoomAnim},this);if(!this.options.updateWhenIdle){this._limitedUpdate=L.Util.limitExecByInterval(this._update,150,this);map.on("move",this._limitedUpdate,this)}this._reset();this._update()},addTo:function(map){map.addLayer(this);return this},onRemove:function(map){this._container.parentNode.removeChild(this._container);map.off({"viewreset":this._reset,
"moveend":this._update},this);if(this._animated)map.off({"zoomanim":this._animateZoom,"zoomend":this._endZoomAnim},this);if(!this.options.updateWhenIdle)map.off("move",this._limitedUpdate,this);this._container=null;this._map=null},bringToFront:function(){var pane=this._map._panes.tilePane;if(this._container){pane.appendChild(this._container);this._setAutoZIndex(pane,Math.max)}return this},bringToBack:function(){var pane=this._map._panes.tilePane;if(this._container){pane.insertBefore(this._container,
pane.firstChild);this._setAutoZIndex(pane,Math.min)}return this},getAttribution:function(){return this.options.attribution},getContainer:function(){return this._container},setOpacity:function(opacity){this.options.opacity=opacity;if(this._map)this._updateOpacity();return this},setZIndex:function(zIndex){this.options.zIndex=zIndex;this._updateZIndex();return this},setUrl:function(url,noRedraw){this._url=url;if(!noRedraw)this.redraw();return this},redraw:function(){if(this._map){this._reset({hard:true});
this._update()}return this},_updateZIndex:function(){if(this._container&&this.options.zIndex!==undefined)this._container.style.zIndex=this.options.zIndex},_setAutoZIndex:function(pane,compare){var layers=pane.children,edgeZIndex=-compare(Infinity,-Infinity),zIndex,i,len;for(i=0,len=layers.length;i<len;i++)if(layers[i]!==this._container){zIndex=parseInt(layers[i].style.zIndex,10);if(!isNaN(zIndex))edgeZIndex=compare(edgeZIndex,zIndex)}this.options.zIndex=this._container.style.zIndex=(isFinite(edgeZIndex)?
edgeZIndex:0)+compare(1,-1)},_updateOpacity:function(){var i,tiles=this._tiles;if(L.Browser.ielt9)for(i in tiles)L.DomUtil.setOpacity(tiles[i],this.options.opacity);else L.DomUtil.setOpacity(this._container,this.options.opacity)},_initContainer:function(){var tilePane=this._map._panes.tilePane;if(!this._container){this._container=L.DomUtil.create("div","leaflet-layer");this._updateZIndex();if(this._animated){var className="leaflet-tile-container leaflet-zoom-animated";this._bgBuffer=L.DomUtil.create("div",
className,this._container);this._tileContainer=L.DomUtil.create("div",className,this._container)}else this._tileContainer=this._container;tilePane.appendChild(this._container);if(this.options.opacity<1)this._updateOpacity()}},_reset:function(e){for(var key in this._tiles)this.fire("tileunload",{tile:this._tiles[key]});this._tiles={};this._tilesToLoad=0;if(this.options.reuseTiles)this._unusedTiles=[];this._tileContainer.innerHTML="";if(this._animated&&e&&e.hard)this._clearBgBuffer();this._initContainer()},
_update:function(){if(!this._map)return;var bounds=this._map.getPixelBounds(),zoom=this._map.getZoom(),tileSize=this.options.tileSize;if(zoom>this.options.maxZoom||zoom<this.options.minZoom)return;var tileBounds=L.bounds(bounds.min.divideBy(tileSize)._floor(),bounds.max.divideBy(tileSize)._floor());this._addTilesFromCenterOut(tileBounds);if(this.options.unloadInvisibleTiles||this.options.reuseTiles)this._removeOtherTiles(tileBounds)},_addTilesFromCenterOut:function(bounds){var queue=[],center=bounds.getCenter();
var j,i,point;for(j=bounds.min.y;j<=bounds.max.y;j++)for(i=bounds.min.x;i<=bounds.max.x;i++){point=new L.Point(i,j);if(this._tileShouldBeLoaded(point))queue.push(point)}var tilesToLoad=queue.length;if(tilesToLoad===0)return;queue.sort(function(a,b){return a.distanceTo(center)-b.distanceTo(center)});var fragment=document.createDocumentFragment();if(!this._tilesToLoad)this.fire("loading");this._tilesToLoad+=tilesToLoad;for(i=0;i<tilesToLoad;i++)this._addTile(queue[i],fragment);this._tileContainer.appendChild(fragment)},
_tileShouldBeLoaded:function(tilePoint){if(tilePoint.x+":"+tilePoint.y in this._tiles)return false;var options=this.options;if(!options.continuousWorld){var limit=this._getWrapTileNum();if(options.noWrap&&(tilePoint.x<0||tilePoint.x>=limit)||tilePoint.y<0||tilePoint.y>=limit)return false}if(options.bounds){var tileSize=options.tileSize,nwPoint=tilePoint.multiplyBy(tileSize),sePoint=nwPoint.add([tileSize,tileSize]),nw=this._map.unproject(nwPoint),se=this._map.unproject(sePoint);if(!options.continuousWorld&&
!options.noWrap){nw=nw.wrap();se=se.wrap()}if(!options.bounds.intersects([nw,se]))return false}return true},_removeOtherTiles:function(bounds){var kArr,x,y,key;for(key in this._tiles){kArr=key.split(":");x=parseInt(kArr[0],10);y=parseInt(kArr[1],10);if(x<bounds.min.x||x>bounds.max.x||y<bounds.min.y||y>bounds.max.y)this._removeTile(key)}},_removeTile:function(key){var tile=this._tiles[key];this.fire("tileunload",{tile:tile,url:tile.src});if(this.options.reuseTiles){L.DomUtil.removeClass(tile,"leaflet-tile-loaded");
this._unusedTiles.push(tile)}else if(tile.parentNode===this._tileContainer)this._tileContainer.removeChild(tile);if(!L.Browser.android){tile.onload=null;tile.src=L.Util.emptyImageUrl}delete this._tiles[key]},_addTile:function(tilePoint,container){var tilePos=this._getTilePos(tilePoint);var tile=this._getTile();L.DomUtil.setPosition(tile,tilePos,L.Browser.chrome||L.Browser.android23);this._tiles[tilePoint.x+":"+tilePoint.y]=tile;this._loadTile(tile,tilePoint);if(tile.parentNode!==this._tileContainer)container.appendChild(tile)},
_getZoomForUrl:function(){var options=this.options,zoom=this._map.getZoom();if(options.zoomReverse)zoom=options.maxZoom-zoom;return zoom+options.zoomOffset},_getTilePos:function(tilePoint){var origin=this._map.getPixelOrigin(),tileSize=this.options.tileSize;return tilePoint.multiplyBy(tileSize).subtract(origin)},getTileUrl:function(tilePoint){return L.Util.template(this._url,L.extend({s:this._getSubdomain(tilePoint),z:tilePoint.z,x:tilePoint.x,y:tilePoint.y},this.options))},_getWrapTileNum:function(){return Math.pow(2,
this._getZoomForUrl())},_adjustTilePoint:function(tilePoint){var limit=this._getWrapTileNum();if(!this.options.continuousWorld&&!this.options.noWrap)tilePoint.x=(tilePoint.x%limit+limit)%limit;if(this.options.tms)tilePoint.y=limit-tilePoint.y-1;tilePoint.z=this._getZoomForUrl()},_getSubdomain:function(tilePoint){var index=Math.abs(tilePoint.x+tilePoint.y)%this.options.subdomains.length;return this.options.subdomains[index]},_createTileProto:function(){var img=this._tileImg=L.DomUtil.create("img",
"leaflet-tile");img.style.width=img.style.height=this.options.tileSize+"px";img.galleryimg="no"},_getTile:function(){if(this.options.reuseTiles&&this._unusedTiles.length>0){var tile=this._unusedTiles.pop();this._resetTile(tile);return tile}return this._createTile()},_resetTile:function(){},_createTile:function(){var tile=this._tileImg.cloneNode(false);tile.onselectstart=tile.onmousemove=L.Util.falseFn;if(L.Browser.ielt9&&this.options.opacity!==undefined)L.DomUtil.setOpacity(tile,this.options.opacity);
return tile},_loadTile:function(tile,tilePoint){tile._layer=this;tile.onload=this._tileOnLoad;tile.onerror=this._tileOnError;this._adjustTilePoint(tilePoint);tile.src=this.getTileUrl(tilePoint)},_tileLoaded:function(){this._tilesToLoad--;if(!this._tilesToLoad){this.fire("load");if(this._animated){clearTimeout(this._clearBgBufferTimer);this._clearBgBufferTimer=setTimeout(L.bind(this._clearBgBuffer,this),500)}}},_tileOnLoad:function(){var layer=this._layer;if(this.src!==L.Util.emptyImageUrl){L.DomUtil.addClass(this,
"leaflet-tile-loaded");layer.fire("tileload",{tile:this,url:this.src})}layer._tileLoaded()},_tileOnError:function(){var layer=this._layer;layer.fire("tileerror",{tile:this,url:this.src});var newUrl=layer.options.errorTileUrl;if(newUrl)this.src=newUrl;layer._tileLoaded()}});L.tileLayer=function(url,options){return new L.TileLayer(url,options)};L.TileLayer.WMS=L.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:false},
initialize:function(url,options){this._url=url;var wmsParams=L.extend({},this.defaultWmsParams),tileSize=options.tileSize||this.options.tileSize;if(options.detectRetina&&L.Browser.retina)wmsParams.width=wmsParams.height=tileSize*2;else wmsParams.width=wmsParams.height=tileSize;for(var i in options)if(!this.options.hasOwnProperty(i)&&i!=="crs")wmsParams[i]=options[i];this.wmsParams=wmsParams;L.setOptions(this,options)},onAdd:function(map){this._crs=this.options.crs||map.options.crs;var projectionKey=
parseFloat(this.wmsParams.version)>=1.3?"crs":"srs";this.wmsParams[projectionKey]=this._crs.code;L.TileLayer.prototype.onAdd.call(this,map)},getTileUrl:function(tilePoint,zoom){var map=this._map,tileSize=this.options.tileSize,nwPoint=tilePoint.multiplyBy(tileSize),sePoint=nwPoint.add([tileSize,tileSize]),nw=this._crs.project(map.unproject(nwPoint,zoom)),se=this._crs.project(map.unproject(sePoint,zoom)),bbox=[nw.x,se.y,se.x,nw.y].join(","),url=L.Util.template(this._url,{s:this._getSubdomain(tilePoint)});
return url+L.Util.getParamString(this.wmsParams,url,true)+"&BBOX="+bbox},setParams:function(params,noRedraw){L.extend(this.wmsParams,params);if(!noRedraw)this.redraw();return this}});L.tileLayer.wms=function(url,options){return new L.TileLayer.WMS(url,options)};L.TileLayer.Canvas=L.TileLayer.extend({options:{async:false},initialize:function(options){L.setOptions(this,options)},redraw:function(){if(this._map){this._reset({hard:true});this._update()}for(var i in this._tiles)this._redrawTile(this._tiles[i]);
return this},_redrawTile:function(tile){this.drawTile(tile,tile._tilePoint,this._map._zoom)},_createTileProto:function(){var proto=this._canvasProto=L.DomUtil.create("canvas","leaflet-tile");proto.width=proto.height=this.options.tileSize},_createTile:function(){var tile=this._canvasProto.cloneNode(false);tile.onselectstart=tile.onmousemove=L.Util.falseFn;return tile},_loadTile:function(tile,tilePoint){tile._layer=this;tile._tilePoint=tilePoint;this._redrawTile(tile);if(!this.options.async)this.tileDrawn(tile)},
drawTile:function(){},tileDrawn:function(tile){this._tileOnLoad.call(tile)}});L.tileLayer.canvas=function(options){return new L.TileLayer.Canvas(options)};L.ImageOverlay=L.Class.extend({includes:L.Mixin.Events,options:{opacity:1},initialize:function(url,bounds,options){this._url=url;this._bounds=L.latLngBounds(bounds);this._mybounds=bounds;L.setOptions(this,options)},onAdd:function(map){this._map=map;if(!this._image)this._initImage();map._panes.overlayPane.appendChild(this._image);map.on("viewreset",
this._reset,this);if(map.options.zoomAnimation&&L.Browser.any3d)map.on("zoomanim",this._animateZoom,this);this._reset()},onRemove:function(map){map.getPanes().overlayPane.removeChild(this._image);map.off("viewreset",this._reset,this);if(map.options.zoomAnimation)map.off("zoomanim",this._animateZoom,this)},addTo:function(map){map.addLayer(this);return this},setOpacity:function(opacity){this.options.opacity=opacity;this._updateOpacity();return this},bringToFront:function(){if(this._image)this._map._panes.overlayPane.appendChild(this._image);
return this},bringToBack:function(){var pane=this._map._panes.overlayPane;if(this._image)pane.insertBefore(this._image,pane.firstChild);return this},_initImage:function(){this._image=L.DomUtil.create("img","leaflet-image-layer");if(this._map.options.zoomAnimation&&L.Browser.any3d)L.DomUtil.addClass(this._image,"leaflet-zoom-animated");else L.DomUtil.addClass(this._image,"leaflet-zoom-hide");this._updateOpacity();L.extend(this._image,{galleryimg:"no",onselectstart:L.Util.falseFn,onmousemove:L.Util.falseFn,
onload:L.bind(this._onImageLoad,this),src:this._url})},_animateZoom:function(e){var map=this._map,image=this._image,scale=map.getZoomScale(e.zoom),nw=new L.LatLng(this._mybounds[0][0],this._mybounds[0][1]),se=new L.LatLng(this._mybounds[1][0],this._mybounds[1][1]);topLeft=map._latLngToNewLayerPoint(nw,e.zoom,e.center),size=map._latLngToNewLayerPoint(se,e.zoom,e.center)._subtract(topLeft),origin=topLeft._add(size._multiplyBy(1/2*(1-1/scale)));image.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(origin)+
" scale("+scale+") "},_reset:function(){var image=this._image,topLeft=this._map.latLngToLayerPoint(new L.LatLng(this._mybounds[0][0],this._mybounds[0][1])),downRight=this._map.latLngToLayerPoint(new L.LatLng(this._mybounds[1][0],this._mybounds[1][1])),size=this._map.latLngToLayerPoint(new L.LatLng(this._mybounds[1][0],this._mybounds[1][1]))._subtract(topLeft);L.DomUtil.setPosition(image,topLeft);image.style.width=size.x+"px";image.style.height=size.y+"px"},_onImageLoad:function(){this.fire("load")},
_updateOpacity:function(){L.DomUtil.setOpacity(this._image,this.options.opacity)}});L.imageOverlay=function(url,bounds,options){return new L.ImageOverlay(url,bounds,options)};L.Icon=L.Class.extend({options:{className:""},initialize:function(options){L.setOptions(this,options)},createIcon:function(oldIcon){return this._createIcon("icon",oldIcon)},createShadow:function(oldIcon){return this._createIcon("shadow",oldIcon)},_createIcon:function(name,oldIcon){var src=this._getIconUrl(name);if(!src){if(name===
"icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var img;if(!oldIcon||oldIcon.tagName!=="IMG")img=this._createImg(src);else img=this._createImg(src,oldIcon);this._setIconStyles(img,name);return img},_setIconStyles:function(img,name){var options=this.options,size=L.point(options[name+"Size"]),anchor;if(name==="shadow")anchor=L.point(options.shadowAnchor||options.iconAnchor);else anchor=L.point(options.iconAnchor);if(!anchor&&size)anchor=size.divideBy(2,true);img.className=
"leaflet-marker-"+name+" "+options.className;if(anchor){img.style.marginLeft=-anchor.x+"px";img.style.marginTop=-anchor.y+"px"}if(size){img.style.width=size.x+"px";img.style.height=size.y+"px"}},_createImg:function(src,el){if(!L.Browser.ie6){if(!el)el=document.createElement("img");el.src=src}else{if(!el)el=document.createElement("div");el.style.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+src+'")'}return el},_getIconUrl:function(name){if(L.Browser.retina&&this.options[name+"RetinaUrl"])return this.options[name+
"RetinaUrl"];return this.options[name+"Url"]}});L.icon=function(options){return new L.Icon(options)};L.Icon.Default=L.Icon.extend({options:{iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]},_getIconUrl:function(name){var key=name+"Url";if(this.options[key])return this.options[key];if(L.Browser.retina&&name==="icon")name+="-2x";var path=L.Icon.Default.imagePath;if(!path)throw new Error("Couldn't autodetect L.Icon.Default.imagePath, set it manually.");return path+"/marker-"+
name+".png"}});L.Icon.Default.imagePath=function(){var scripts=document.getElementsByTagName("script"),leafletRe=/[\/^]leaflet[\-\._]?([\w\-\._]*)\.js\??/;var i,len,src,matches,path;for(i=0,len=scripts.length;i<len;i++){src=scripts[i].src;matches=src.match(leafletRe);if(matches){path=src.split(leafletRe)[0];return(path?path+"/":"")+"images"}}}();L.Marker=L.Class.extend({includes:L.Mixin.Events,options:{icon:new L.Icon.Default,title:"",clickable:true,draggable:false,keyboard:true,zIndexOffset:0,opacity:1,
riseOnHover:false,riseOffset:250},initialize:function(latlng,options){L.setOptions(this,options);this._latlng=L.latLng(latlng)},onAdd:function(map){this._map=map;map.on("viewreset",this.update,this);this._initIcon();this.update();if(map.options.zoomAnimation&&map.options.markerZoomAnimation)map.on("zoomanim",this._animateZoom,this)},addTo:function(map){map.addLayer(this);return this},onRemove:function(map){if(this.dragging)this.dragging.disable();this._removeIcon();this._removeShadow();this.fire("remove");
map.off({"viewreset":this.update,"zoomanim":this._animateZoom},this);this._map=null},getLatLng:function(){return this._latlng},setLatLng:function(latlng){this._latlng=L.latLng(latlng);this.update();return this.fire("move",{latlng:this._latlng})},setZIndexOffset:function(offset){this.options.zIndexOffset=offset;this.update();return this},setIcon:function(icon){this.options.icon=icon;if(this._map){this._initIcon();this.update()}return this},update:function(){if(this._icon){var pos=this._map.latLngToLayerPoint(this._latlng).round();
this._setPos(pos)}return this},_initIcon:function(){var options=this.options,map=this._map,animation=map.options.zoomAnimation&&map.options.markerZoomAnimation,classToAdd=animation?"leaflet-zoom-animated":"leaflet-zoom-hide";var icon=options.icon.createIcon(this._icon),addIcon=false;if(icon!==this._icon){if(this._icon)this._removeIcon();addIcon=true;if(options.title)icon.title=options.title}L.DomUtil.addClass(icon,classToAdd);if(options.keyboard)icon.tabIndex="0";this._icon=icon;this._initInteraction();
if(options.riseOnHover)L.DomEvent.on(icon,"mouseover",this._bringToFront,this).on(icon,"mouseout",this._resetZIndex,this);var newShadow=options.icon.createShadow(this._shadow),addShadow=false;if(newShadow!==this._shadow){this._removeShadow();addShadow=true}if(newShadow)L.DomUtil.addClass(newShadow,classToAdd);this._shadow=newShadow;if(options.opacity<1)this._updateOpacity();var panes=this._map._panes;if(addIcon)panes.markerPane.appendChild(this._icon);if(newShadow&&addShadow)panes.shadowPane.appendChild(this._shadow)},
_removeIcon:function(){if(this.options.riseOnHover)L.DomEvent.off(this._icon,"mouseover",this._bringToFront).off(this._icon,"mouseout",this._resetZIndex);this._map._panes.markerPane.removeChild(this._icon);this._icon=null},_removeShadow:function(){if(this._shadow)this._map._panes.shadowPane.removeChild(this._shadow);this._shadow=null},_setPos:function(pos){L.DomUtil.setPosition(this._icon,pos);if(this._shadow)L.DomUtil.setPosition(this._shadow,pos);this._zIndex=pos.y+this.options.zIndexOffset;this._resetZIndex()},
_updateZIndex:function(offset){this._icon.style.zIndex=this._zIndex+offset},_animateZoom:function(opt){var pos=this._map._latLngToNewLayerPoint(this._latlng,opt.zoom,opt.center);this._setPos(pos)},_initInteraction:function(){if(!this.options.clickable)return;var icon=this._icon,events=["dblclick","mousedown","mouseover","mouseout","contextmenu"];L.DomUtil.addClass(icon,"leaflet-clickable");L.DomEvent.on(icon,"click",this._onMouseClick,this);L.DomEvent.on(icon,"keypress",this._onKeyPress,this);for(var i=
0;i<events.length;i++)L.DomEvent.on(icon,events[i],this._fireMouseEvent,this);if(L.Handler.MarkerDrag){this.dragging=new L.Handler.MarkerDrag(this);if(this.options.draggable)this.dragging.enable()}},_onMouseClick:function(e){var wasDragged=this.dragging&&this.dragging.moved();if(this.hasEventListeners(e.type)||wasDragged)L.DomEvent.stopPropagation(e);if(wasDragged)return;if((!this.dragging||!this.dragging._enabled)&&this._map.dragging&&this._map.dragging.moved())return;this.fire(e.type,{originalEvent:e,
latlng:this._latlng})},_onKeyPress:function(e){if(e.keyCode===13)this.fire("click",{originalEvent:e,latlng:this._latlng})},_fireMouseEvent:function(e){this.fire(e.type,{originalEvent:e,latlng:this._latlng});if(e.type==="contextmenu"&&this.hasEventListeners(e.type))L.DomEvent.preventDefault(e);if(e.type!=="mousedown")L.DomEvent.stopPropagation(e);else L.DomEvent.preventDefault(e)},setOpacity:function(opacity){this.options.opacity=opacity;if(this._map)this._updateOpacity();return this},_updateOpacity:function(){L.DomUtil.setOpacity(this._icon,
this.options.opacity);if(this._shadow)L.DomUtil.setOpacity(this._shadow,this.options.opacity)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)}});L.marker=function(latlng,options){return new L.Marker(latlng,options)};L.DivIcon=L.Icon.extend({options:{iconSize:[12,12],className:"leaflet-div-icon",html:false},createIcon:function(oldIcon){var div=oldIcon&&oldIcon.tagName==="DIV"?oldIcon:document.createElement("div"),options=this.options;
if(options.html!==false)div.innerHTML=options.html;else div.innerHTML="";if(options.bgPos)div.style.backgroundPosition=-options.bgPos.x+"px "+-options.bgPos.y+"px";this._setIconStyles(div,"icon");return div},createShadow:function(){return null}});L.divIcon=function(options){return new L.DivIcon(options)};L.Map.mergeOptions({closePopupOnClick:true});L.Popup=L.Class.extend({includes:L.Mixin.Events,options:{minWidth:50,maxWidth:300,maxHeight:null,autoPan:true,closeButton:true,offset:[0,7],autoPanPadding:[5,
5],keepInView:false,className:"",zoomAnimation:true},initialize:function(options,source){L.setOptions(this,options);this._source=source;this._animated=L.Browser.any3d&&this.options.zoomAnimation;this._isOpen=false},onAdd:function(map){this._map=map;if(!this._container)this._initLayout();this._updateContent();var animFade=map.options.fadeAnimation;if(animFade)L.DomUtil.setOpacity(this._container,0);map._panes.popupPane.appendChild(this._container);map.on(this._getEvents(),this);this._update();if(animFade)L.DomUtil.setOpacity(this._container,
1);this.fire("open");map.fire("popupopen",{popup:this});if(this._source)this._source.fire("popupopen",{popup:this})},addTo:function(map){map.addLayer(this);return this},openOn:function(map){map.openPopup(this);return this},onRemove:function(map){map._panes.popupPane.removeChild(this._container);L.Util.falseFn(this._container.offsetWidth);map.off(this._getEvents(),this);if(map.options.fadeAnimation)L.DomUtil.setOpacity(this._container,0);this._map=null;this.fire("close");map.fire("popupclose",{popup:this});
if(this._source)this._source.fire("popupclose",{popup:this})},setLatLng:function(latlng){this._latlng=L.latLng(latlng);this._update();return this},setContent:function(content){this._content=content;this._update();return this},_getEvents:function(){var events={viewreset:this._updatePosition};if(this._animated)events.zoomanim=this._zoomAnimation;if("closeOnClick"in this.options?this.options.closeOnClick:this._map.options.closePopupOnClick)events.preclick=this._close;if(this.options.keepInView)events.moveend=
this._adjustPan;return events},_close:function(){if(this._map)this._map.closePopup(this)},_initLayout:function(){var prefix="leaflet-popup",containerClass=prefix+" "+this.options.className+" leaflet-zoom-"+(this._animated?"animated":"hide"),container=this._container=L.DomUtil.create("div",containerClass),closeButton;if(this.options.closeButton){closeButton=this._closeButton=L.DomUtil.create("a",prefix+"-close-button",container);closeButton.href="#close";closeButton.innerHTML="&#215;";L.DomEvent.disableClickPropagation(closeButton);
L.DomEvent.on(closeButton,"click",this._onCloseButtonClick,this)}var wrapper=this._wrapper=L.DomUtil.create("div",prefix+"-content-wrapper",container);L.DomEvent.disableClickPropagation(wrapper);this._contentNode=L.DomUtil.create("div",prefix+"-content",wrapper);L.DomEvent.on(this._contentNode,"mousewheel",L.DomEvent.stopPropagation);L.DomEvent.on(this._contentNode,"MozMousePixelScroll",L.DomEvent.stopPropagation);L.DomEvent.on(wrapper,"contextmenu",L.DomEvent.stopPropagation);this._tipContainer=
L.DomUtil.create("div",prefix+"-tip-container",container);this._tip=L.DomUtil.create("div",prefix+"-tip",this._tipContainer)},_update:function(){if(!this._map)return;this._container.style.visibility="hidden";this._updateContent();this._updateLayout();this._updatePosition();this._container.style.visibility="";this._adjustPan()},_updateContent:function(){if(!this._content)return;if(typeof this._content==="string")this._contentNode.innerHTML=this._content;else{while(this._contentNode.hasChildNodes())this._contentNode.removeChild(this._contentNode.firstChild);
this._contentNode.appendChild(this._content)}this.fire("contentupdate")},_updateLayout:function(){var container=this._contentNode,style=container.style;style.width="";style.whiteSpace="nowrap";var width=container.offsetWidth;width=Math.min(width,this.options.maxWidth);width=Math.max(width,this.options.minWidth);style.width=width+1+"px";style.whiteSpace="";style.height="";var height=container.offsetHeight,maxHeight=this.options.maxHeight,scrolledClass="leaflet-popup-scrolled";if(maxHeight&&height>
maxHeight){style.height=maxHeight+"px";L.DomUtil.addClass(container,scrolledClass)}else L.DomUtil.removeClass(container,scrolledClass);this._containerWidth=this._container.offsetWidth},_updatePosition:function(){if(!this._map)return;var pos=this._map.latLngToLayerPoint(this._latlng),animated=this._animated,offset=L.point(this.options.offset);if(animated)L.DomUtil.setPosition(this._container,pos);this._containerBottom=-offset.y-(animated?0:pos.y);this._containerLeft=-Math.round(this._containerWidth/
2)+offset.x+(animated?0:pos.x);this._container.style.bottom=this._containerBottom+"px";this._container.style.left=this._containerLeft+"px"},_zoomAnimation:function(opt){var pos=this._map._latLngToNewLayerPoint(this._latlng,opt.zoom,opt.center);L.DomUtil.setPosition(this._container,pos)},_adjustPan:function(){if(!this.options.autoPan)return;var map=this._map,containerHeight=this._container.offsetHeight,containerWidth=this._containerWidth,layerPos=new L.Point(this._containerLeft,-containerHeight-this._containerBottom);
if(this._animated)layerPos._add(L.DomUtil.getPosition(this._container));var containerPos=map.layerPointToContainerPoint(layerPos),padding=L.point(this.options.autoPanPadding),size=map.getSize(),dx=0,dy=0;if(containerPos.x+containerWidth>size.x)dx=containerPos.x+containerWidth-size.x+padding.x;if(containerPos.x-dx<0)dx=containerPos.x-padding.x;if(containerPos.y+containerHeight>size.y)dy=containerPos.y+containerHeight-size.y+padding.y;if(containerPos.y-dy<0)dy=containerPos.y-padding.y;if(dx||dy)map.fire("autopanstart").panBy([dx,
dy])},_onCloseButtonClick:function(e){this._close();L.DomEvent.stop(e)}});L.popup=function(options,source){return new L.Popup(options,source)};L.Map.include({openPopup:function(popup,latlng,options){this.closePopup();if(!(popup instanceof L.Popup)){var content=popup;popup=(new L.Popup(options)).setLatLng(latlng).setContent(content)}popup._isOpen=true;this._popup=popup;return this.addLayer(popup)},closePopup:function(popup){if(!popup||popup===this._popup){popup=this._popup;this._popup=null}if(popup){this.removeLayer(popup);
popup._isOpen=false}return this}});L.Marker.include({openPopup:function(){if(this._popup&&this._map&&!this._map.hasLayer(this._popup)){this._popup.setLatLng(this._latlng);this._map.openPopup(this._popup)}return this},closePopup:function(){if(this._popup)this._popup._close();return this},togglePopup:function(){if(this._popup)if(this._popup._isOpen)this.closePopup();else this.openPopup();return this},bindPopup:function(content,options){var anchor=L.point(this.options.icon.options.popupAnchor||[0,0]);
anchor=anchor.add(L.Popup.prototype.options.offset);if(options&&options.offset)anchor=anchor.add(options.offset);options=L.extend({offset:anchor},options);if(!this._popup)this.on("click",this.togglePopup,this).on("remove",this.closePopup,this).on("move",this._movePopup,this);if(content instanceof L.Popup){L.setOptions(content,options);this._popup=content}else this._popup=(new L.Popup(options,this)).setContent(content);return this},setPopupContent:function(content){if(this._popup)this._popup.setContent(content);
return this},unbindPopup:function(){if(this._popup){this._popup=null;this.off("click",this.togglePopup).off("remove",this.closePopup).off("move",this._movePopup)}return this},_movePopup:function(e){this._popup.setLatLng(e.latlng)}});L.LayerGroup=L.Class.extend({initialize:function(layers){this._layers={};var i,len;if(layers)for(i=0,len=layers.length;i<len;i++)this.addLayer(layers[i])},addLayer:function(layer){var id=this.getLayerId(layer);this._layers[id]=layer;if(this._map)this._map.addLayer(layer);
return this},removeLayer:function(layer){var id=layer in this._layers?layer:this.getLayerId(layer);if(this._map&&this._layers[id])this._map.removeLayer(this._layers[id]);delete this._layers[id];return this},hasLayer:function(layer){if(!layer)return false;return layer in this._layers||this.getLayerId(layer)in this._layers},clearLayers:function(){this.eachLayer(this.removeLayer,this);return this},invoke:function(methodName){var args=Array.prototype.slice.call(arguments,1),i,layer;for(i in this._layers){layer=
this._layers[i];if(layer[methodName])layer[methodName].apply(layer,args)}return this},onAdd:function(map){this._map=map;this.eachLayer(map.addLayer,map)},onRemove:function(map){this.eachLayer(map.removeLayer,map);this._map=null},addTo:function(map){map.addLayer(this);return this},eachLayer:function(method,context){for(var i in this._layers)method.call(context,this._layers[i]);return this},getLayer:function(id){return this._layers[id]},getLayers:function(){var layers=[];for(var i in this._layers)layers.push(this._layers[i]);
return layers},setZIndex:function(zIndex){return this.invoke("setZIndex",zIndex)},getLayerId:function(layer){return L.stamp(layer)}});L.layerGroup=function(layers){return new L.LayerGroup(layers)};L.FeatureGroup=L.LayerGroup.extend({includes:L.Mixin.Events,statics:{EVENTS:"click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose"},addLayer:function(layer){if(this.hasLayer(layer))return this;layer.on(L.FeatureGroup.EVENTS,this._propagateEvent,this);L.LayerGroup.prototype.addLayer.call(this,
layer);if(this._popupContent&&layer.bindPopup)layer.bindPopup(this._popupContent,this._popupOptions);return this.fire("layeradd",{layer:layer})},removeLayer:function(layer){if(!this.hasLayer(layer))return this;if(layer in this._layers)layer=this._layers[layer];layer.off(L.FeatureGroup.EVENTS,this._propagateEvent,this);L.LayerGroup.prototype.removeLayer.call(this,layer);if(this._popupContent)this.invoke("unbindPopup");return this.fire("layerremove",{layer:layer})},bindPopup:function(content,options){this._popupContent=
content;this._popupOptions=options;return this.invoke("bindPopup",content,options)},setStyle:function(style){return this.invoke("setStyle",style)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var bounds=new L.LatLngBounds;this.eachLayer(function(layer){bounds.extend(layer instanceof L.Marker?layer.getLatLng():layer.getBounds())});return bounds},_propagateEvent:function(e){if(!e.layer)e.layer=e.target;e.target=
this;this.fire(e.type,e)}});L.featureGroup=function(layers){return new L.FeatureGroup(layers)};L.Path=L.Class.extend({includes:[L.Mixin.Events],statics:{CLIP_PADDING:function(){var max=L.Browser.mobile?1280:2E3,target=(max/Math.max(window.outerWidth,window.outerHeight)-1)/2;return Math.max(0,Math.min(0.5,target))}()},options:{stroke:true,color:"#0033ff",dashArray:null,weight:5,opacity:0.5,fill:false,fillColor:null,fillOpacity:0.2,clickable:true},initialize:function(options){L.setOptions(this,options)},
onAdd:function(map){this._map=map;if(!this._container){this._initElements();this._initEvents()}this.projectLatlngs();this._updatePath();if(this._container)this._map._pathRoot.appendChild(this._container);this.fire("add");map.on({"viewreset":this.projectLatlngs,"moveend":this._updatePath},this)},addTo:function(map){map.addLayer(this);return this},onRemove:function(map){map._pathRoot.removeChild(this._container);this.fire("remove");this._map=null;if(L.Browser.vml){this._container=null;this._stroke=
null;this._fill=null}map.off({"viewreset":this.projectLatlngs,"moveend":this._updatePath},this)},projectLatlngs:function(){},setStyle:function(style){L.setOptions(this,style);if(this._container)this._updateStyle();return this},redraw:function(){if(this._map){this.projectLatlngs();this._updatePath()}return this}});L.Map.include({_updatePathViewport:function(){var p=L.Path.CLIP_PADDING,size=this.getSize(),panePos=L.DomUtil.getPosition(this._mapPane),min=panePos.multiplyBy(-1)._subtract(size.multiplyBy(p)._round()),
max=min.add(size.multiplyBy(1+p*2)._round());this._pathViewport=new L.Bounds(min,max)}});L.Path.SVG_NS="http://www.w3.org/2000/svg";L.Browser.svg=!!(document.createElementNS&&document.createElementNS(L.Path.SVG_NS,"svg").createSVGRect);L.Path=L.Path.extend({statics:{SVG:L.Browser.svg},bringToFront:function(){var root=this._map._pathRoot,path=this._container;if(path&&root.lastChild!==path)root.appendChild(path);return this},bringToBack:function(){var root=this._map._pathRoot,path=this._container,first=
root.firstChild;if(path&&first!==path)root.insertBefore(path,first);return this},getPathString:function(){},_createElement:function(name){return document.createElementNS(L.Path.SVG_NS,name)},_initElements:function(){this._map._initPathRoot();this._initPath();this._initStyle()},_initPath:function(){this._container=this._createElement("g");this._path=this._createElement("path");this._container.appendChild(this._path)},_initStyle:function(){if(this.options.stroke){this._path.setAttribute("stroke-linejoin",
"round");this._path.setAttribute("stroke-linecap","round")}if(this.options.fill)this._path.setAttribute("fill-rule","evenodd");if(this.options.pointerEvents)this._path.setAttribute("pointer-events",this.options.pointerEvents);if(!this.options.clickable&&!this.options.pointerEvents)this._path.setAttribute("pointer-events","none");this._updateStyle()},_updateStyle:function(){if(this.options.stroke){this._path.setAttribute("stroke",this.options.color);this._path.setAttribute("stroke-opacity",this.options.opacity);
this._path.setAttribute("stroke-width",this.options.weight);if(this.options.dashArray)this._path.setAttribute("stroke-dasharray",this.options.dashArray);else this._path.removeAttribute("stroke-dasharray")}else this._path.setAttribute("stroke","none");if(this.options.fill){this._path.setAttribute("fill",this.options.fillColor||this.options.color);this._path.setAttribute("fill-opacity",this.options.fillOpacity)}else this._path.setAttribute("fill","none")},_updatePath:function(){var str=this.getPathString();
if(!str)str="M0 0";this._path.setAttribute("d",str)},_initEvents:function(){if(this.options.clickable){if(L.Browser.svg||!L.Browser.vml)this._path.setAttribute("class","leaflet-clickable");L.DomEvent.on(this._container,"click",this._onMouseClick,this);var events=["dblclick","mousedown","mouseover","mouseout","mousemove","contextmenu"];for(var i=0;i<events.length;i++)L.DomEvent.on(this._container,events[i],this._fireMouseEvent,this)}},_onMouseClick:function(e){if(this._map.dragging&&this._map.dragging.moved())return;
this._fireMouseEvent(e)},_fireMouseEvent:function(e){if(!this.hasEventListeners(e.type))return;var map=this._map,containerPoint=map.mouseEventToContainerPoint(e),layerPoint=map.containerPointToLayerPoint(containerPoint),latlng=map.layerPointToLatLng(layerPoint);this.fire(e.type,{latlng:latlng,layerPoint:layerPoint,containerPoint:containerPoint,originalEvent:e});if(e.type==="contextmenu")L.DomEvent.preventDefault(e);if(e.type!=="mousemove")L.DomEvent.stopPropagation(e)}});L.Map.include({_initPathRoot:function(){if(!this._pathRoot){this._pathRoot=
L.Path.prototype._createElement("svg");this._panes.overlayPane.appendChild(this._pathRoot);if(this.options.zoomAnimation&&L.Browser.any3d){this._pathRoot.setAttribute("class"," leaflet-zoom-animated");this.on({"zoomanim":this._animatePathZoom,"zoomend":this._endPathZoom})}else this._pathRoot.setAttribute("class"," leaflet-zoom-hide");this.on("moveend",this._updateSvgViewport);this._updateSvgViewport()}},_animatePathZoom:function(e){var scale=this.getZoomScale(e.zoom),offset=this._getCenterOffset(e.center)._multiplyBy(-scale)._add(this._pathViewport.min);
this._pathRoot.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(offset)+" scale("+scale+") ";this._pathZooming=true},_endPathZoom:function(){this._pathZooming=false},_updateSvgViewport:function(){if(this._pathZooming)return;this._updatePathViewport();var vp=this._pathViewport,min=vp.min,max=vp.max,width=max.x-min.x,height=max.y-min.y,root=this._pathRoot,pane=this._panes.overlayPane;if(L.Browser.mobileWebkit)pane.removeChild(root);L.DomUtil.setPosition(root,min);root.setAttribute("width",width);
root.setAttribute("height",height);root.setAttribute("viewBox",[min.x,min.y,width,height].join(" "));if(L.Browser.mobileWebkit)pane.appendChild(root)}});L.Path.include({bindPopup:function(content,options){if(content instanceof L.Popup)this._popup=content;else{if(!this._popup||options)this._popup=new L.Popup(options,this);this._popup.setContent(content)}if(!this._popupHandlersAdded){this.on("click",this._openPopup,this).on("remove",this.closePopup,this);this._popupHandlersAdded=true}return this},unbindPopup:function(){if(this._popup){this._popup=
null;this.off("click",this._openPopup).off("remove",this.closePopup);this._popupHandlersAdded=false}return this},openPopup:function(latlng){if(this._popup){latlng=latlng||this._latlng||this._latlngs[Math.floor(this._latlngs.length/2)];this._openPopup({latlng:latlng})}return this},closePopup:function(){if(this._popup)this._popup._close();return this},_openPopup:function(e){this._popup.setLatLng(e.latlng);this._map.openPopup(this._popup)}});L.Browser.vml=!L.Browser.svg&&function(){try{var div=document.createElement("div");
div.innerHTML='<v:shape adj="1"/>';var shape=div.firstChild;shape.style.behavior="url(#default#VML)";return shape&&typeof shape.adj==="object"}catch(e){return false}}();L.Path=L.Browser.svg||!L.Browser.vml?L.Path:L.Path.extend({statics:{VML:true,CLIP_PADDING:0.02},_createElement:function(){try{document.namespaces.add("lvml","urn:schemas-microsoft-com:vml");return function(name){return document.createElement("<lvml:"+name+' class="lvml">')}}catch(e){return function(name){return document.createElement("<"+
name+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}(),_initPath:function(){var container=this._container=this._createElement("shape");L.DomUtil.addClass(container,"leaflet-vml-shape");if(this.options.clickable)L.DomUtil.addClass(container,"leaflet-clickable");container.coordsize="1 1";this._path=this._createElement("path");container.appendChild(this._path);this._map._pathRoot.appendChild(container)},_initStyle:function(){this._updateStyle()},_updateStyle:function(){var stroke=this._stroke,
fill=this._fill,options=this.options,container=this._container;container.stroked=options.stroke;container.filled=options.fill;if(options.stroke){if(!stroke){stroke=this._stroke=this._createElement("stroke");stroke.endcap="round";container.appendChild(stroke)}stroke.weight=options.weight+"px";stroke.color=options.color;stroke.opacity=options.opacity;if(options.dashArray)stroke.dashStyle=options.dashArray instanceof Array?options.dashArray.join(" "):options.dashArray.replace(/( *, *)/g," ");else stroke.dashStyle=
""}else if(stroke){container.removeChild(stroke);this._stroke=null}if(options.fill){if(!fill){fill=this._fill=this._createElement("fill");container.appendChild(fill)}fill.color=options.fillColor||options.color;fill.opacity=options.fillOpacity}else if(fill){container.removeChild(fill);this._fill=null}},_updatePath:function(){var style=this._container.style;style.display="none";this._path.v=this.getPathString()+" ";style.display=""}});L.Map.include(L.Browser.svg||!L.Browser.vml?{}:{_initPathRoot:function(){if(this._pathRoot)return;
var root=this._pathRoot=document.createElement("div");root.className="leaflet-vml-container";this._panes.overlayPane.appendChild(root);this.on("moveend",this._updatePathViewport);this._updatePathViewport()}});L.Browser.canvas=function(){return!!document.createElement("canvas").getContext}();L.Path=L.Path.SVG&&!window.L_PREFER_CANVAS||!L.Browser.canvas?L.Path:L.Path.extend({statics:{CANVAS:true,SVG:false},redraw:function(){if(this._map){this.projectLatlngs();this._requestUpdate()}return this},setStyle:function(style){L.setOptions(this,
style);if(this._map){this._updateStyle();this._requestUpdate()}return this},onRemove:function(map){map.off("viewreset",this.projectLatlngs,this).off("moveend",this._updatePath,this);if(this.options.clickable){this._map.off("click",this._onClick,this);this._map.off("mousemove",this._onMouseMove,this)}this._requestUpdate();this._map=null},_requestUpdate:function(){if(this._map&&!L.Path._updateRequest)L.Path._updateRequest=L.Util.requestAnimFrame(this._fireMapMoveEnd,this._map)},_fireMapMoveEnd:function(){L.Path._updateRequest=
null;this.fire("moveend")},_initElements:function(){this._map._initPathRoot();this._ctx=this._map._canvasCtx},_updateStyle:function(){var options=this.options;if(options.stroke){this._ctx.lineWidth=options.weight;this._ctx.strokeStyle=options.color}if(options.fill)this._ctx.fillStyle=options.fillColor||options.color},_drawPath:function(){var i,j,len,len2,point,drawMethod;this._ctx.beginPath();for(i=0,len=this._parts.length;i<len;i++){for(j=0,len2=this._parts[i].length;j<len2;j++){point=this._parts[i][j];
drawMethod=(j===0?"move":"line")+"To";this._ctx[drawMethod](point.x,point.y)}if(this instanceof L.Polygon)this._ctx.closePath()}},_checkIfEmpty:function(){return!this._parts.length},_updatePath:function(){if(this._checkIfEmpty())return;var ctx=this._ctx,options=this.options;this._drawPath();ctx.save();this._updateStyle();if(options.fill){ctx.globalAlpha=options.fillOpacity;ctx.fill()}if(options.stroke){ctx.globalAlpha=options.opacity;ctx.stroke()}ctx.restore()},_initEvents:function(){if(this.options.clickable){this._map.on("mousemove",
this._onMouseMove,this);this._map.on("click",this._onClick,this)}},_onClick:function(e){if(this._containsPoint(e.layerPoint))this.fire("click",e)},_onMouseMove:function(e){if(!this._map||this._map._animatingZoom)return;if(this._containsPoint(e.layerPoint)){this._ctx.canvas.style.cursor="pointer";this._mouseInside=true;this.fire("mouseover",e)}else if(this._mouseInside){this._ctx.canvas.style.cursor="";this._mouseInside=false;this.fire("mouseout",e)}}});L.Map.include(L.Path.SVG&&!window.L_PREFER_CANVAS||
!L.Browser.canvas?{}:{_initPathRoot:function(){var root=this._pathRoot,ctx;if(!root){root=this._pathRoot=document.createElement("canvas");root.style.position="absolute";ctx=this._canvasCtx=root.getContext("2d");ctx.lineCap="round";ctx.lineJoin="round";this._panes.overlayPane.appendChild(root);if(this.options.zoomAnimation){this._pathRoot.className="leaflet-zoom-animated";this.on("zoomanim",this._animatePathZoom);this.on("zoomend",this._endPathZoom)}this.on("moveend",this._updateCanvasViewport);this._updateCanvasViewport()}},
_updateCanvasViewport:function(){if(this._pathZooming)return;this._updatePathViewport();var vp=this._pathViewport,min=vp.min,size=vp.max.subtract(min),root=this._pathRoot;L.DomUtil.setPosition(root,min);root.width=size.x;root.height=size.y;root.getContext("2d").translate(-min.x,-min.y)}});L.LineUtil={simplify:function(points,tolerance){if(!tolerance||!points.length)return points.slice();var sqTolerance=tolerance*tolerance;points=this._reducePoints(points,sqTolerance);points=this._simplifyDP(points,
sqTolerance);return points},pointToSegmentDistance:function(p,p1,p2){return Math.sqrt(this._sqClosestPointOnSegment(p,p1,p2,true))},closestPointOnSegment:function(p,p1,p2){return this._sqClosestPointOnSegment(p,p1,p2)},_simplifyDP:function(points,sqTolerance){var len=points.length,ArrayConstructor=typeof Uint8Array!==undefined+""?Uint8Array:Array,markers=new ArrayConstructor(len);markers[0]=markers[len-1]=1;this._simplifyDPStep(points,markers,sqTolerance,0,len-1);var i,newPoints=[];for(i=0;i<len;i++)if(markers[i])newPoints.push(points[i]);
return newPoints},_simplifyDPStep:function(points,markers,sqTolerance,first,last){var maxSqDist=0,index,i,sqDist;for(i=first+1;i<=last-1;i++){sqDist=this._sqClosestPointOnSegment(points[i],points[first],points[last],true);if(sqDist>maxSqDist){index=i;maxSqDist=sqDist}}if(maxSqDist>sqTolerance){markers[index]=1;this._simplifyDPStep(points,markers,sqTolerance,first,index);this._simplifyDPStep(points,markers,sqTolerance,index,last)}},_reducePoints:function(points,sqTolerance){var reducedPoints=[points[0]];
for(var i=1,prev=0,len=points.length;i<len;i++)if(this._sqDist(points[i],points[prev])>sqTolerance){reducedPoints.push(points[i]);prev=i}if(prev<len-1)reducedPoints.push(points[len-1]);return reducedPoints},clipSegment:function(a,b,bounds,useLastCode){var codeA=useLastCode?this._lastCode:this._getBitCode(a,bounds),codeB=this._getBitCode(b,bounds),codeOut,p,newCode;this._lastCode=codeB;while(true)if(!(codeA|codeB))return[a,b];else if(codeA&codeB)return false;else{codeOut=codeA||codeB;p=this._getEdgeIntersection(a,
b,codeOut,bounds);newCode=this._getBitCode(p,bounds);if(codeOut===codeA){a=p;codeA=newCode}else{b=p;codeB=newCode}}},_getEdgeIntersection:function(a,b,code,bounds){var dx=b.x-a.x,dy=b.y-a.y,min=bounds.min,max=bounds.max;if(code&8)return new L.Point(a.x+dx*(max.y-a.y)/dy,max.y);else if(code&4)return new L.Point(a.x+dx*(min.y-a.y)/dy,min.y);else if(code&2)return new L.Point(max.x,a.y+dy*(max.x-a.x)/dx);else if(code&1)return new L.Point(min.x,a.y+dy*(min.x-a.x)/dx)},_getBitCode:function(p,bounds){var code=
0;if(p.x<bounds.min.x)code|=1;else if(p.x>bounds.max.x)code|=2;if(p.y<bounds.min.y)code|=4;else if(p.y>bounds.max.y)code|=8;return code},_sqDist:function(p1,p2){var dx=p2.x-p1.x,dy=p2.y-p1.y;return dx*dx+dy*dy},_sqClosestPointOnSegment:function(p,p1,p2,sqDist){var x=p1.x,y=p1.y,dx=p2.x-x,dy=p2.y-y,dot=dx*dx+dy*dy,t;if(dot>0){t=((p.x-x)*dx+(p.y-y)*dy)/dot;if(t>1){x=p2.x;y=p2.y}else if(t>0){x+=dx*t;y+=dy*t}}dx=p.x-x;dy=p.y-y;return sqDist?dx*dx+dy*dy:new L.Point(x,y)}};L.Polyline=L.Path.extend({initialize:function(latlngs,
options){L.Path.prototype.initialize.call(this,options);this._latlngs=this._convertLatLngs(latlngs)},options:{smoothFactor:1,noClip:false},projectLatlngs:function(){this._originalPoints=[];for(var i=0,len=this._latlngs.length;i<len;i++)this._originalPoints[i]=this._map.latLngToLayerPoint(this._latlngs[i])},getPathString:function(){for(var i=0,len=this._parts.length,str="";i<len;i++)str+=this._getPathPartStr(this._parts[i]);return str},getLatLngs:function(){return this._latlngs},setLatLngs:function(latlngs){this._latlngs=
this._convertLatLngs(latlngs);return this.redraw()},addLatLng:function(latlng){this._latlngs.push(L.latLng(latlng));return this.redraw()},spliceLatLngs:function(){var removed=[].splice.apply(this._latlngs,arguments);this._convertLatLngs(this._latlngs,true);this.redraw();return removed},closestLayerPoint:function(p){var minDistance=Infinity,parts=this._parts,p1,p2,minPoint=null;for(var j=0,jLen=parts.length;j<jLen;j++){var points=parts[j];for(var i=1,len=points.length;i<len;i++){p1=points[i-1];p2=
points[i];var sqDist=L.LineUtil._sqClosestPointOnSegment(p,p1,p2,true);if(sqDist<minDistance){minDistance=sqDist;minPoint=L.LineUtil._sqClosestPointOnSegment(p,p1,p2)}}}if(minPoint)minPoint.distance=Math.sqrt(minDistance);return minPoint},getBounds:function(){return new L.LatLngBounds(this.getLatLngs())},_convertLatLngs:function(latlngs,overwrite){var i,len,target=overwrite?latlngs:[];for(i=0,len=latlngs.length;i<len;i++){if(L.Util.isArray(latlngs[i])&&typeof latlngs[i][0]!=="number")return;target[i]=
L.latLng(latlngs[i])}return target},_initEvents:function(){L.Path.prototype._initEvents.call(this)},_getPathPartStr:function(points){var round=L.Path.VML;for(var j=0,len2=points.length,str="",p;j<len2;j++){p=points[j];if(round)p._round();str+=(j?"L":"M")+p.x+" "+p.y}return str},_clipPoints:function(){var points=this._originalPoints,len=points.length,i,k,segment;if(this.options.noClip){this._parts=[points];return}this._parts=[];var parts=this._parts,vp=this._map._pathViewport,lu=L.LineUtil;for(i=0,
k=0;i<len-1;i++){segment=lu.clipSegment(points[i],points[i+1],vp,i);if(!segment)continue;parts[k]=parts[k]||[];parts[k].push(segment[0]);if(segment[1]!==points[i+1]||i===len-2){parts[k].push(segment[1]);k++}}},_simplifyPoints:function(){var parts=this._parts,lu=L.LineUtil;for(var i=0,len=parts.length;i<len;i++)parts[i]=lu.simplify(parts[i],this.options.smoothFactor)},_updatePath:function(){if(!this._map)return;this._clipPoints();this._simplifyPoints();L.Path.prototype._updatePath.call(this)}});L.polyline=
function(latlngs,options){return new L.Polyline(latlngs,options)};L.PolyUtil={};L.PolyUtil.clipPolygon=function(points,bounds){var clippedPoints,edges=[1,4,2,8],i,j,k,a,b,len,edge,p,lu=L.LineUtil;for(i=0,len=points.length;i<len;i++)points[i]._code=lu._getBitCode(points[i],bounds);for(k=0;k<4;k++){edge=edges[k];clippedPoints=[];for(i=0,len=points.length,j=len-1;i<len;j=i++){a=points[i];b=points[j];if(!(a._code&edge)){if(b._code&edge){p=lu._getEdgeIntersection(b,a,edge,bounds);p._code=lu._getBitCode(p,
bounds);clippedPoints.push(p)}clippedPoints.push(a)}else if(!(b._code&edge)){p=lu._getEdgeIntersection(b,a,edge,bounds);p._code=lu._getBitCode(p,bounds);clippedPoints.push(p)}}points=clippedPoints}return points};L.Polygon=L.Polyline.extend({options:{fill:true},initialize:function(latlngs,options){var i,len,hole;L.Polyline.prototype.initialize.call(this,latlngs,options);if(latlngs&&L.Util.isArray(latlngs[0])&&typeof latlngs[0][0]!=="number"){this._latlngs=this._convertLatLngs(latlngs[0]);this._holes=
latlngs.slice(1);for(i=0,len=this._holes.length;i<len;i++){hole=this._holes[i]=this._convertLatLngs(this._holes[i]);if(hole[0].equals(hole[hole.length-1]))hole.pop()}}latlngs=this._latlngs;if(latlngs.length>=2&&latlngs[0].equals(latlngs[latlngs.length-1]))latlngs.pop()},projectLatlngs:function(){L.Polyline.prototype.projectLatlngs.call(this);this._holePoints=[];if(!this._holes)return;var i,j,len,len2;for(i=0,len=this._holes.length;i<len;i++){this._holePoints[i]=[];for(j=0,len2=this._holes[i].length;j<
len2;j++)this._holePoints[i][j]=this._map.latLngToLayerPoint(this._holes[i][j])}},_clipPoints:function(){var points=this._originalPoints,newParts=[];this._parts=[points].concat(this._holePoints);if(this.options.noClip)return;for(var i=0,len=this._parts.length;i<len;i++){var clipped=L.PolyUtil.clipPolygon(this._parts[i],this._map._pathViewport);if(clipped.length)newParts.push(clipped)}this._parts=newParts},_getPathPartStr:function(points){var str=L.Polyline.prototype._getPathPartStr.call(this,points);
return str+(L.Browser.svg?"z":"x")}});L.polygon=function(latlngs,options){return new L.Polygon(latlngs,options)};(function(){function createMulti(Klass){return L.FeatureGroup.extend({initialize:function(latlngs,options){this._layers={};this._options=options;this.setLatLngs(latlngs)},setLatLngs:function(latlngs){var i=0,len=latlngs.length;this.eachLayer(function(layer){if(i<len)layer.setLatLngs(latlngs[i++]);else this.removeLayer(layer)},this);while(i<len)this.addLayer(new Klass(latlngs[i++],this._options));
return this},getLatLngs:function(){var latlngs=[];this.eachLayer(function(layer){latlngs.push(layer.getLatLngs())});return latlngs}})}L.MultiPolyline=createMulti(L.Polyline);L.MultiPolygon=createMulti(L.Polygon);L.multiPolyline=function(latlngs,options){return new L.MultiPolyline(latlngs,options)};L.multiPolygon=function(latlngs,options){return new L.MultiPolygon(latlngs,options)}})();L.Rectangle=L.Polygon.extend({initialize:function(latLngBounds,options){L.Polygon.prototype.initialize.call(this,
this._boundsToLatLngs(latLngBounds),options)},setBounds:function(latLngBounds){this.setLatLngs(this._boundsToLatLngs(latLngBounds))},_boundsToLatLngs:function(latLngBounds){latLngBounds=L.latLngBounds(latLngBounds);return[latLngBounds.getSouthWest(),latLngBounds.getNorthWest(),latLngBounds.getNorthEast(),latLngBounds.getSouthEast()]}});L.rectangle=function(latLngBounds,options){return new L.Rectangle(latLngBounds,options)};L.Circle=L.Path.extend({initialize:function(latlng,radius,options){L.Path.prototype.initialize.call(this,
options);this._latlng=L.latLng(latlng);this._mRadius=radius},options:{fill:true},setLatLng:function(latlng){this._latlng=L.latLng(latlng);return this.redraw()},setRadius:function(radius){this._mRadius=radius;return this.redraw()},projectLatlngs:function(){var lngRadius=this._getLngRadius(),latlng=this._latlng,pointLeft=this._map.latLngToLayerPoint([latlng.lat,latlng.lng-lngRadius]);this._point=this._map.latLngToLayerPoint(latlng);this._radius=Math.max(this._point.x-pointLeft.x,1)},getBounds:function(){var lngRadius=
this._getLngRadius(),latRadius=this._mRadius/40075017*360,latlng=this._latlng;return new L.LatLngBounds([latlng.lat-latRadius,latlng.lng-lngRadius],[latlng.lat+latRadius,latlng.lng+lngRadius])},getLatLng:function(){return this._latlng},getPathString:function(){var p=this._point,r=this._radius;if(this._checkIfEmpty())return"";if(L.Browser.svg)return"M"+p.x+","+(p.y-r)+"A"+r+","+r+",0,1,1,"+(p.x-0.1)+","+(p.y-r)+" z";else{p._round();r=Math.round(r);return"AL "+p.x+","+p.y+" "+r+","+r+" 0,"+65535*360}},
getRadius:function(){return this._mRadius},_getLatRadius:function(){return this._mRadius/40075017*360},_getLngRadius:function(){return this._getLatRadius()/Math.cos(L.LatLng.DEG_TO_RAD*this._latlng.lat)},_checkIfEmpty:function(){if(!this._map)return false;var vp=this._map._pathViewport,r=this._radius,p=this._point;return p.x-r>vp.max.x||p.y-r>vp.max.y||p.x+r<vp.min.x||p.y+r<vp.min.y}});L.circle=function(latlng,radius,options){return new L.Circle(latlng,radius,options)};L.CircleMarker=L.Circle.extend({options:{radius:10,
weight:2},initialize:function(latlng,options){L.Circle.prototype.initialize.call(this,latlng,null,options);this._radius=this.options.radius},projectLatlngs:function(){this._point=this._map.latLngToLayerPoint(this._latlng)},_updateStyle:function(){L.Circle.prototype._updateStyle.call(this);this.setRadius(this.options.radius)},setRadius:function(radius){this.options.radius=this._radius=radius;return this.redraw()}});L.circleMarker=function(latlng,options){return new L.CircleMarker(latlng,options)};
L.Polyline.include(!L.Path.CANVAS?{}:{_containsPoint:function(p,closed){var i,j,k,len,len2,dist,part,w=this.options.weight/2;if(L.Browser.touch)w+=10;for(i=0,len=this._parts.length;i<len;i++){part=this._parts[i];for(j=0,len2=part.length,k=len2-1;j<len2;k=j++){if(!closed&&j===0)continue;dist=L.LineUtil.pointToSegmentDistance(p,part[k],part[j]);if(dist<=w)return true}}return false}});L.Polygon.include(!L.Path.CANVAS?{}:{_containsPoint:function(p){var inside=false,part,p1,p2,i,j,k,len,len2;if(L.Polyline.prototype._containsPoint.call(this,
p,true))return true;for(i=0,len=this._parts.length;i<len;i++){part=this._parts[i];for(j=0,len2=part.length,k=len2-1;j<len2;k=j++){p1=part[j];p2=part[k];if(p1.y>p.y!==p2.y>p.y&&p.x<(p2.x-p1.x)*(p.y-p1.y)/(p2.y-p1.y)+p1.x)inside=!inside}}return inside}});L.Circle.include(!L.Path.CANVAS?{}:{_drawPath:function(){var p=this._point;this._ctx.beginPath();this._ctx.arc(p.x,p.y,this._radius,0,Math.PI*2,false)},_containsPoint:function(p){var center=this._point,w2=this.options.stroke?this.options.weight/2:0;
return p.distanceTo(center)<=this._radius+w2}});L.CircleMarker.include(!L.Path.CANVAS?{}:{_updateStyle:function(){L.Path.prototype._updateStyle.call(this)}});L.GeoJSON=L.FeatureGroup.extend({initialize:function(geojson,options){L.setOptions(this,options);this._layers={};if(geojson)this.addData(geojson)},addData:function(geojson){var features=L.Util.isArray(geojson)?geojson:geojson.features,i,len,feature;if(features){for(i=0,len=features.length;i<len;i++){feature=features[i];if(feature.geometries||
feature.geometry||feature.features||feature.coordinates)this.addData(features[i])}return this}var options=this.options;if(options.filter&&!options.filter(geojson))return;var layer=L.GeoJSON.geometryToLayer(geojson,options.pointToLayer,options.coordsToLatLng);layer.feature=L.GeoJSON.asFeature(geojson);layer.defaultOptions=layer.options;this.resetStyle(layer);if(options.onEachFeature)options.onEachFeature(geojson,layer);return this.addLayer(layer)},resetStyle:function(layer){var style=this.options.style;
if(style){L.Util.extend(layer.options,layer.defaultOptions);this._setLayerStyle(layer,style)}},setStyle:function(style){this.eachLayer(function(layer){this._setLayerStyle(layer,style)},this)},_setLayerStyle:function(layer,style){if(typeof style==="function")style=style(layer.feature);if(layer.setStyle)layer.setStyle(style)}});L.extend(L.GeoJSON,{geometryToLayer:function(geojson,pointToLayer,coordsToLatLng){var geometry=geojson.type==="Feature"?geojson.geometry:geojson,coords=geometry.coordinates,
layers=[],latlng,latlngs,i,len,layer;coordsToLatLng=coordsToLatLng||this.coordsToLatLng;switch(geometry.type){case "Point":latlng=coordsToLatLng(coords);return pointToLayer?pointToLayer(geojson,latlng):new L.Marker(latlng);case "MultiPoint":for(i=0,len=coords.length;i<len;i++){latlng=coordsToLatLng(coords[i]);layer=pointToLayer?pointToLayer(geojson,latlng):new L.Marker(latlng);layers.push(layer)}return new L.FeatureGroup(layers);case "LineString":latlngs=this.coordsToLatLngs(coords,0,coordsToLatLng);
return new L.Polyline(latlngs);case "Polygon":latlngs=this.coordsToLatLngs(coords,1,coordsToLatLng);return new L.Polygon(latlngs);case "MultiLineString":latlngs=this.coordsToLatLngs(coords,1,coordsToLatLng);return new L.MultiPolyline(latlngs);case "MultiPolygon":latlngs=this.coordsToLatLngs(coords,2,coordsToLatLng);return new L.MultiPolygon(latlngs);case "GeometryCollection":for(i=0,len=geometry.geometries.length;i<len;i++){layer=this.geometryToLayer({geometry:geometry.geometries[i],type:"Feature",
properties:geojson.properties},pointToLayer,coordsToLatLng);layers.push(layer)}return new L.FeatureGroup(layers);default:throw new Error("Invalid GeoJSON object.");}},coordsToLatLng:function(coords){return new L.LatLng(coords[1],coords[0])},coordsToLatLngs:function(coords,levelsDeep,coordsToLatLng){var latlng,i,len,latlngs=[];for(i=0,len=coords.length;i<len;i++){latlng=levelsDeep?this.coordsToLatLngs(coords[i],levelsDeep-1,coordsToLatLng):(coordsToLatLng||this.coordsToLatLng)(coords[i]);latlngs.push(latlng)}return latlngs},
latLngToCoords:function(latLng){return[latLng.lng,latLng.lat]},latLngsToCoords:function(latLngs){var coords=[];for(var i=0,len=latLngs.length;i<len;i++)coords.push(L.GeoJSON.latLngToCoords(latLngs[i]));return coords},getFeature:function(layer,newGeometry){return layer.feature?L.extend({},layer.feature,{geometry:newGeometry}):L.GeoJSON.asFeature(newGeometry)},asFeature:function(geoJSON){if(geoJSON.type==="Feature")return geoJSON;return{type:"Feature",properties:{},geometry:geoJSON}}});var PointToGeoJSON=
{toGeoJSON:function(){return L.GeoJSON.getFeature(this,{type:"Point",coordinates:L.GeoJSON.latLngToCoords(this.getLatLng())})}};L.Marker.include(PointToGeoJSON);L.Circle.include(PointToGeoJSON);L.CircleMarker.include(PointToGeoJSON);L.Polyline.include({toGeoJSON:function(){return L.GeoJSON.getFeature(this,{type:"LineString",coordinates:L.GeoJSON.latLngsToCoords(this.getLatLngs())})}});L.Polygon.include({toGeoJSON:function(){var coords=[L.GeoJSON.latLngsToCoords(this.getLatLngs())],i,len,hole;coords[0].push(coords[0][0]);
if(this._holes)for(i=0,len=this._holes.length;i<len;i++){hole=L.GeoJSON.latLngsToCoords(this._holes[i]);hole.push(hole[0]);coords.push(hole)}return L.GeoJSON.getFeature(this,{type:"Polygon",coordinates:coords})}});(function(){function includeMulti(Klass,type){Klass.include({toGeoJSON:function(){var coords=[];this.eachLayer(function(layer){coords.push(layer.toGeoJSON().geometry.coordinates)});return L.GeoJSON.getFeature(this,{type:type,coordinates:coords})}})}includeMulti(L.MultiPolyline,"MultiLineString");
includeMulti(L.MultiPolygon,"MultiPolygon")})();L.LayerGroup.include({toGeoJSON:function(){var features=[];this.eachLayer(function(layer){if(layer.toGeoJSON)features.push(L.GeoJSON.asFeature(layer.toGeoJSON()))});return{type:"FeatureCollection",features:features}}});L.geoJson=function(geojson,options){return new L.GeoJSON(geojson,options)};L.DomEvent={addListener:function(obj,type,fn,context){var id=L.stamp(fn),key="_leaflet_"+type+id,handler,originalHandler,newType;if(obj[key])return this;handler=
function(e){return fn.call(context||obj,e||L.DomEvent._getEvent())};if(L.Browser.msTouch&&type.indexOf("touch")===0)return this.addMsTouchListener(obj,type,handler,id);if(L.Browser.touch&&type==="dblclick"&&this.addDoubleTapListener)this.addDoubleTapListener(obj,handler,id);if("addEventListener"in obj)if(type==="mousewheel"){obj.addEventListener("DOMMouseScroll",handler,false);obj.addEventListener(type,handler,false)}else if(type==="mouseenter"||type==="mouseleave"){originalHandler=handler;newType=
type==="mouseenter"?"mouseover":"mouseout";handler=function(e){if(!L.DomEvent._checkMouse(obj,e))return;return originalHandler(e)};obj.addEventListener(newType,handler,false)}else if(type==="click"&&L.Browser.android){originalHandler=handler;handler=function(e){return L.DomEvent._filterClick(e,originalHandler)};obj.addEventListener(type,handler,false)}else obj.addEventListener(type,handler,false);else if("attachEvent"in obj)obj.attachEvent("on"+type,handler);obj[key]=handler;return this},removeListener:function(obj,
type,fn){var id=L.stamp(fn),key="_leaflet_"+type+id,handler=obj[key];if(!handler)return this;if(L.Browser.msTouch&&type.indexOf("touch")===0)this.removeMsTouchListener(obj,type,id);else if(L.Browser.touch&&type==="dblclick"&&this.removeDoubleTapListener)this.removeDoubleTapListener(obj,id);else if("removeEventListener"in obj)if(type==="mousewheel"){obj.removeEventListener("DOMMouseScroll",handler,false);obj.removeEventListener(type,handler,false)}else if(type==="mouseenter"||type==="mouseleave")obj.removeEventListener(type===
"mouseenter"?"mouseover":"mouseout",handler,false);else obj.removeEventListener(type,handler,false);else if("detachEvent"in obj)obj.detachEvent("on"+type,handler);obj[key]=null;return this},stopPropagation:function(e){if(e.stopPropagation)e.stopPropagation();else e.cancelBubble=true;return this},disableClickPropagation:function(el){var stop=L.DomEvent.stopPropagation;for(var i=L.Draggable.START.length-1;i>=0;i--)L.DomEvent.addListener(el,L.Draggable.START[i],stop);return L.DomEvent.addListener(el,
"click",L.DomEvent._fakeStop).addListener(el,"dblclick",stop)},preventDefault:function(e){if(e.preventDefault)e.preventDefault();else e.returnValue=false;return this},stop:function(e){return L.DomEvent.preventDefault(e).stopPropagation(e)},getMousePosition:function(e,container){var ie7=L.Browser.ie7,body=document.body,docEl=document.documentElement,x=e.pageX?e.pageX-body.scrollLeft-docEl.scrollLeft:e.clientX,y=e.pageY?e.pageY-body.scrollTop-docEl.scrollTop:e.clientY,pos=new L.Point(x,y),rect=container.getBoundingClientRect(),
left=rect.left-container.clientLeft,top=rect.top-container.clientTop;if(!L.DomUtil.documentIsLtr()&&(L.Browser.webkit||ie7)){left+=container.scrollWidth-container.clientWidth;if(ie7&&L.DomUtil.getStyle(container,"overflow-y")!=="hidden"&&L.DomUtil.getStyle(container,"overflow")!=="hidden")left+=17}return pos._subtract(new L.Point(left,top))},getWheelDelta:function(e){var delta=0;if(e.wheelDelta)delta=e.wheelDelta/120;if(e.detail)delta=-e.detail/3;return delta},_skipEvents:{},_fakeStop:function(e){L.DomEvent._skipEvents[e.type]=
true},_skipped:function(e){var skipped=this._skipEvents[e.type];this._skipEvents[e.type]=false;return skipped},_checkMouse:function(el,e){var related=e.relatedTarget;if(!related)return true;try{while(related&&related!==el)related=related.parentNode}catch(err){return false}return related!==el},_getEvent:function(){var e=window.event;if(!e){var caller=arguments.callee.caller;while(caller){e=caller["arguments"][0];if(e&&window.Event===e.constructor)break;caller=caller.caller}}return e},_filterClick:function(e,
handler){var timeStamp=e.timeStamp||e.originalEvent.timeStamp,elapsed=L.DomEvent._lastClick&&timeStamp-L.DomEvent._lastClick;if(elapsed&&elapsed>100&&elapsed<1E3||e.target._simulatedClick&&!e._simulated){L.DomEvent.stop(e);return}L.DomEvent._lastClick=timeStamp;return handler(e)}};L.DomEvent.on=L.DomEvent.addListener;L.DomEvent.off=L.DomEvent.removeListener;L.Draggable=L.Class.extend({includes:L.Mixin.Events,statics:{START:L.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",
touchstart:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",MSPointerDown:"touchmove"}},initialize:function(element,dragStartTarget){this._element=element;this._dragStartTarget=dragStartTarget||element},enable:function(){if(this._enabled)return;for(var i=L.Draggable.START.length-1;i>=0;i--)L.DomEvent.on(this._dragStartTarget,L.Draggable.START[i],this._onDown,this);this._enabled=true},disable:function(){if(!this._enabled)return;for(var i=L.Draggable.START.length-
1;i>=0;i--)L.DomEvent.off(this._dragStartTarget,L.Draggable.START[i],this._onDown,this);this._enabled=false;this._moved=false},_onDown:function(e){if(e.shiftKey||e.which!==1&&e.button!==1&&!e.touches)return;L.DomEvent.stopPropagation(e);if(L.Draggable._disabled)return;L.DomUtil.disableImageDrag();L.DomUtil.disableTextSelection();var first=e.touches?e.touches[0]:e,el=first.target;if(L.Browser.touch&&el.tagName.toLowerCase()==="a")L.DomUtil.addClass(el,"leaflet-active");this._moved=false;if(this._moving)return;
this._startPoint=new L.Point(first.clientX,first.clientY);this._startPos=this._newPos=L.DomUtil.getPosition(this._element);L.DomEvent.on(document,L.Draggable.MOVE[e.type],this._onMove,this).on(document,L.Draggable.END[e.type],this._onUp,this)},_onMove:function(e){if(e.touches&&e.touches.length>1)return;var first=e.touches&&e.touches.length===1?e.touches[0]:e,newPoint=new L.Point(first.clientX,first.clientY),offset=newPoint.subtract(this._startPoint);if(!offset.x&&!offset.y)return;L.DomEvent.preventDefault(e);
if(!this._moved){this.fire("dragstart");this._moved=true;this._startPos=L.DomUtil.getPosition(this._element).subtract(offset);if(!L.Browser.touch)L.DomUtil.addClass(document.body,"leaflet-dragging")}this._newPos=this._startPos.add(offset);this._moving=true;L.Util.cancelAnimFrame(this._animRequest);this._animRequest=L.Util.requestAnimFrame(this._updatePosition,this,true,this._dragStartTarget)},_updatePosition:function(){this.fire("predrag");L.DomUtil.setPosition(this._element,this._newPos);this.fire("drag")},
_onUp:function(){if(!L.Browser.touch)L.DomUtil.removeClass(document.body,"leaflet-dragging");for(var i in L.Draggable.MOVE)L.DomEvent.off(document,L.Draggable.MOVE[i],this._onMove).off(document,L.Draggable.END[i],this._onUp);L.DomUtil.enableImageDrag();L.DomUtil.enableTextSelection();if(this._moved){L.Util.cancelAnimFrame(this._animRequest);this.fire("dragend")}this._moving=false}});L.Handler=L.Class.extend({initialize:function(map){this._map=map},enable:function(){if(this._enabled)return;this._enabled=
true;this.addHooks()},disable:function(){if(!this._enabled)return;this._enabled=false;this.removeHooks()},enabled:function(){return!!this._enabled}});L.Map.mergeOptions({dragging:true,inertia:!L.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:Infinity,inertiaThreshold:L.Browser.touch?32:18,easeLinearity:0.25,worldCopyJump:false});L.Map.Drag=L.Handler.extend({addHooks:function(){if(!this._draggable){var map=this._map;this._draggable=new L.Draggable(map._mapPane,map._container);this._draggable.on({"dragstart":this._onDragStart,
"drag":this._onDrag,"dragend":this._onDragEnd},this);if(map.options.worldCopyJump){this._draggable.on("predrag",this._onPreDrag,this);map.on("viewreset",this._onViewReset,this);this._onViewReset()}}this._draggable.enable()},removeHooks:function(){this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){var map=this._map;if(map._panAnim)map._panAnim.stop();map.fire("movestart").fire("dragstart");if(map.options.inertia){this._positions=[];this._times=
[]}},_onDrag:function(){if(this._map.options.inertia){var time=this._lastTime=+new Date,pos=this._lastPos=this._draggable._newPos;this._positions.push(pos);this._times.push(time);if(time-this._times[0]>200){this._positions.shift();this._times.shift()}}this._map.fire("move").fire("drag")},_onViewReset:function(){var pxCenter=this._map.getSize()._divideBy(2),pxWorldCenter=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=pxWorldCenter.subtract(pxCenter).x;this._worldWidth=this._map.project([0,
180]).x},_onPreDrag:function(){var worldWidth=this._worldWidth,halfWidth=Math.round(worldWidth/2),dx=this._initialWorldOffset,x=this._draggable._newPos.x,newX1=(x-halfWidth+dx)%worldWidth+halfWidth-dx,newX2=(x+halfWidth+dx)%worldWidth-halfWidth-dx,newX=Math.abs(newX1+dx)<Math.abs(newX2+dx)?newX1:newX2;this._draggable._newPos.x=newX},_onDragEnd:function(){var map=this._map,options=map.options,delay=+new Date-this._lastTime,noInertia=!options.inertia||delay>options.inertiaThreshold||!this._positions[0];
map.fire("dragend");if(noInertia)map.fire("moveend");else{var direction=this._lastPos.subtract(this._positions[0]),duration=(this._lastTime+delay-this._times[0])/1E3,ease=options.easeLinearity,speedVector=direction.multiplyBy(ease/duration),speed=speedVector.distanceTo([0,0]),limitedSpeed=Math.min(options.inertiaMaxSpeed,speed),limitedSpeedVector=speedVector.multiplyBy(limitedSpeed/speed),decelerationDuration=limitedSpeed/(options.inertiaDeceleration*ease),offset=limitedSpeedVector.multiplyBy(-decelerationDuration/
2).round();if(!offset.x||!offset.y)map.fire("moveend");else L.Util.requestAnimFrame(function(){map.panBy(offset,{duration:decelerationDuration,easeLinearity:ease,noMoveStart:true})})}}});L.Map.addInitHook("addHandler","dragging",L.Map.Drag);L.Map.mergeOptions({doubleClickZoom:true});L.Map.DoubleClickZoom=L.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick)},_onDoubleClick:function(e){this.setZoomAround(e.containerPoint,
this._zoom+1)}});L.Map.addInitHook("addHandler","doubleClickZoom",L.Map.DoubleClickZoom);L.Map.mergeOptions({scrollWheelZoom:true});L.Map.ScrollWheelZoom=L.Handler.extend({addHooks:function(){L.DomEvent.on(this._map._container,"mousewheel",this._onWheelScroll,this);L.DomEvent.on(this._map._container,"MozMousePixelScroll",L.DomEvent.preventDefault);this._delta=0},removeHooks:function(){L.DomEvent.off(this._map._container,"mousewheel",this._onWheelScroll);L.DomEvent.off(this._map._container,"MozMousePixelScroll",
L.DomEvent.preventDefault)},_onWheelScroll:function(e){var delta=L.DomEvent.getWheelDelta(e);this._delta+=delta;this._lastMousePos=this._map.mouseEventToContainerPoint(e);if(!this._startTime)this._startTime=+new Date;var left=Math.max(40-(+new Date-this._startTime),0);clearTimeout(this._timer);this._timer=setTimeout(L.bind(this._performZoom,this),left);L.DomEvent.preventDefault(e);L.DomEvent.stopPropagation(e)},_performZoom:function(){var map=this._map,delta=this._delta,zoom=map.getZoom();delta=delta>
0?Math.ceil(delta):Math.floor(delta);delta=Math.max(Math.min(delta,4),-4);delta=map._limitZoom(zoom+delta)-zoom;this._delta=0;this._startTime=null;if(!delta)return;map.setZoomAround(this._lastMousePos,zoom+delta)}});L.Map.addInitHook("addHandler","scrollWheelZoom",L.Map.ScrollWheelZoom);L.extend(L.DomEvent,{_touchstart:L.Browser.msTouch?"MSPointerDown":"touchstart",_touchend:L.Browser.msTouch?"MSPointerUp":"touchend",addDoubleTapListener:function(obj,handler,id){var last,doubleTap=false,delay=250,
touch,pre="_leaflet_",touchstart=this._touchstart,touchend=this._touchend,trackedTouches=[];function onTouchStart(e){var count;if(L.Browser.msTouch){trackedTouches.push(e.pointerId);count=trackedTouches.length}else count=e.touches.length;if(count>1)return;var now=Date.now(),delta=now-(last||now);touch=e.touches?e.touches[0]:e;doubleTap=delta>0&&delta<=delay;last=now}function onTouchEnd(e){if(L.Browser.msTouch){var idx=trackedTouches.indexOf(e.pointerId);if(idx===-1)return;trackedTouches.splice(idx,
1)}if(doubleTap){if(L.Browser.msTouch){var newTouch={},prop;for(var i in touch){prop=touch[i];if(typeof prop==="function")newTouch[i]=prop.bind(touch);else newTouch[i]=prop}touch=newTouch}touch.type="dblclick";handler(touch);last=null}}obj[pre+touchstart+id]=onTouchStart;obj[pre+touchend+id]=onTouchEnd;var endElement=L.Browser.msTouch?document.documentElement:obj;obj.addEventListener(touchstart,onTouchStart,false);endElement.addEventListener(touchend,onTouchEnd,false);if(L.Browser.msTouch)endElement.addEventListener("MSPointerCancel",
onTouchEnd,false);return this},removeDoubleTapListener:function(obj,id){var pre="_leaflet_";obj.removeEventListener(this._touchstart,obj[pre+this._touchstart+id],false);(L.Browser.msTouch?document.documentElement:obj).removeEventListener(this._touchend,obj[pre+this._touchend+id],false);if(L.Browser.msTouch)document.documentElement.removeEventListener("MSPointerCancel",obj[pre+this._touchend+id],false);return this}});L.extend(L.DomEvent,{_msTouches:[],_msDocumentListener:false,addMsTouchListener:function(obj,
type,handler,id){switch(type){case "touchstart":return this.addMsTouchListenerStart(obj,type,handler,id);case "touchend":return this.addMsTouchListenerEnd(obj,type,handler,id);case "touchmove":return this.addMsTouchListenerMove(obj,type,handler,id);default:throw"Unknown touch event type";}},addMsTouchListenerStart:function(obj,type,handler,id){var pre="_leaflet_",touches=this._msTouches;var cb=function(e){var alreadyInArray=false;for(var i=0;i<touches.length;i++)if(touches[i].pointerId===e.pointerId){alreadyInArray=
true;break}if(!alreadyInArray)touches.push(e);e.touches=touches.slice();e.changedTouches=[e];handler(e)};obj[pre+"touchstart"+id]=cb;obj.addEventListener("MSPointerDown",cb,false);if(!this._msDocumentListener){var internalCb=function(e){for(var i=0;i<touches.length;i++)if(touches[i].pointerId===e.pointerId){touches.splice(i,1);break}};document.documentElement.addEventListener("MSPointerUp",internalCb,false);document.documentElement.addEventListener("MSPointerCancel",internalCb,false);this._msDocumentListener=
true}return this},addMsTouchListenerMove:function(obj,type,handler,id){var pre="_leaflet_",touches=this._msTouches;function cb(e){if(e.pointerType===e.MSPOINTER_TYPE_MOUSE&&e.buttons===0)return;for(var i=0;i<touches.length;i++)if(touches[i].pointerId===e.pointerId){touches[i]=e;break}e.touches=touches.slice();e.changedTouches=[e];handler(e)}obj[pre+"touchmove"+id]=cb;obj.addEventListener("MSPointerMove",cb,false);return this},addMsTouchListenerEnd:function(obj,type,handler,id){var pre="_leaflet_",
touches=this._msTouches;var cb=function(e){for(var i=0;i<touches.length;i++)if(touches[i].pointerId===e.pointerId){touches.splice(i,1);break}e.touches=touches.slice();e.changedTouches=[e];handler(e)};obj[pre+"touchend"+id]=cb;obj.addEventListener("MSPointerUp",cb,false);obj.addEventListener("MSPointerCancel",cb,false);return this},removeMsTouchListener:function(obj,type,id){var pre="_leaflet_",cb=obj[pre+type+id];switch(type){case "touchstart":obj.removeEventListener("MSPointerDown",cb,false);break;
case "touchmove":obj.removeEventListener("MSPointerMove",cb,false);break;case "touchend":obj.removeEventListener("MSPointerUp",cb,false);obj.removeEventListener("MSPointerCancel",cb,false);break}return this}});L.Map.mergeOptions({touchZoom:L.Browser.touch&&!L.Browser.android23});L.Map.TouchZoom=L.Handler.extend({addHooks:function(){L.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){L.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},
_onTouchStart:function(e){var map=this._map;if(!e.touches||e.touches.length!==2||map._animatingZoom||this._zooming)return;var p1=map.mouseEventToLayerPoint(e.touches[0]),p2=map.mouseEventToLayerPoint(e.touches[1]),viewCenter=map._getCenterLayerPoint();this._startCenter=p1.add(p2)._divideBy(2);this._startDist=p1.distanceTo(p2);this._moved=false;this._zooming=true;this._centerOffset=viewCenter.subtract(this._startCenter);if(map._panAnim)map._panAnim.stop();L.DomEvent.on(document,"touchmove",this._onTouchMove,
this).on(document,"touchend",this._onTouchEnd,this);L.DomEvent.preventDefault(e)},_onTouchMove:function(e){var map=this._map;if(!e.touches||e.touches.length!==2||!this._zooming)return;var p1=map.mouseEventToLayerPoint(e.touches[0]),p2=map.mouseEventToLayerPoint(e.touches[1]);this._scale=p1.distanceTo(p2)/this._startDist;this._delta=p1._add(p2)._divideBy(2)._subtract(this._startCenter);if(this._scale===1)return;if(!this._moved){L.DomUtil.addClass(map._mapPane,"leaflet-touching");map.fire("movestart").fire("zoomstart");
this._moved=true}L.Util.cancelAnimFrame(this._animRequest);this._animRequest=L.Util.requestAnimFrame(this._updateOnMove,this,true,this._map._container);L.DomEvent.preventDefault(e)},_updateOnMove:function(){var map=this._map,origin=this._getScaleOrigin(),center=map.layerPointToLatLng(origin),zoom=map.getScaleZoom(this._scale);map._animateZoom(center,zoom,this._startCenter,this._scale,this._delta)},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=false;return}var map=this._map;
this._zooming=false;L.DomUtil.removeClass(map._mapPane,"leaflet-touching");L.Util.cancelAnimFrame(this._animRequest);L.DomEvent.off(document,"touchmove",this._onTouchMove).off(document,"touchend",this._onTouchEnd);var origin=this._getScaleOrigin(),center=map.layerPointToLatLng(origin),oldZoom=map.getZoom(),floatZoomDelta=map.getScaleZoom(this._scale)-oldZoom,roundZoomDelta=floatZoomDelta>0?Math.ceil(floatZoomDelta):Math.floor(floatZoomDelta),zoom=map._limitZoom(oldZoom+roundZoomDelta),scale=map.getZoomScale(zoom)/
this._scale;map._animateZoom(center,zoom,origin,scale)},_getScaleOrigin:function(){var centerOffset=this._centerOffset.subtract(this._delta).divideBy(this._scale);return this._startCenter.add(centerOffset)}});L.Map.addInitHook("addHandler","touchZoom",L.Map.TouchZoom);L.Map.mergeOptions({tap:true,tapTolerance:15});L.Map.Tap=L.Handler.extend({addHooks:function(){L.DomEvent.on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){L.DomEvent.off(this._map._container,"touchstart",
this._onDown,this)},_onDown:function(e){if(!e.touches)return;L.DomEvent.preventDefault(e);this._fireClick=true;if(e.touches.length>1){this._fireClick=false;clearTimeout(this._holdTimeout);return}var first=e.touches[0],el=first.target;this._startPos=this._newPos=new L.Point(first.clientX,first.clientY);if(el.tagName.toLowerCase()==="a")L.DomUtil.addClass(el,"leaflet-active");this._holdTimeout=setTimeout(L.bind(function(){if(this._isTapValid()){this._fireClick=false;this._onUp();this._simulateEvent("contextmenu",
first)}},this),1E3);L.DomEvent.on(document,"touchmove",this._onMove,this).on(document,"touchend",this._onUp,this)},_onUp:function(e){clearTimeout(this._holdTimeout);L.DomEvent.off(document,"touchmove",this._onMove,this).off(document,"touchend",this._onUp,this);if(this._fireClick&&e&&e.changedTouches){var first=e.changedTouches[0],el=first.target;if(el.tagName.toLowerCase()==="a")L.DomUtil.removeClass(el,"leaflet-active");if(this._isTapValid())this._simulateEvent("click",first)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=
this._map.options.tapTolerance},_onMove:function(e){var first=e.touches[0];this._newPos=new L.Point(first.clientX,first.clientY)},_simulateEvent:function(type,e){var simulatedEvent=document.createEvent("MouseEvents");simulatedEvent._simulated=true;e.target._simulatedClick=true;simulatedEvent.initMouseEvent(type,true,true,window,1,e.screenX,e.screenY,e.clientX,e.clientY,false,false,false,false,0,null);e.target.dispatchEvent(simulatedEvent)}});if(L.Browser.touch&&!L.Browser.msTouch)L.Map.addInitHook("addHandler",
"tap",L.Map.Tap);L.Map.mergeOptions({boxZoom:true});L.Map.BoxZoom=L.Handler.extend({initialize:function(map){this._map=map;this._container=map._container;this._pane=map._panes.overlayPane},addHooks:function(){L.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){L.DomEvent.off(this._container,"mousedown",this._onMouseDown)},_onMouseDown:function(e){if(!e.shiftKey||e.which!==1&&e.button!==1)return false;L.DomUtil.disableTextSelection();L.DomUtil.disableImageDrag();
this._startLayerPoint=this._map.mouseEventToLayerPoint(e);this._box=L.DomUtil.create("div","leaflet-zoom-box",this._pane);L.DomUtil.setPosition(this._box,this._startLayerPoint);this._container.style.cursor="crosshair";L.DomEvent.on(document,"mousemove",this._onMouseMove,this).on(document,"mouseup",this._onMouseUp,this).on(document,"keydown",this._onKeyDown,this);this._map.fire("boxzoomstart")},_onMouseMove:function(e){var startPoint=this._startLayerPoint,box=this._box,layerPoint=this._map.mouseEventToLayerPoint(e),
offset=layerPoint.subtract(startPoint),newPos=new L.Point(Math.min(layerPoint.x,startPoint.x),Math.min(layerPoint.y,startPoint.y));L.DomUtil.setPosition(box,newPos);box.style.width=Math.max(0,Math.abs(offset.x)-4)+"px";box.style.height=Math.max(0,Math.abs(offset.y)-4)+"px"},_finish:function(){this._pane.removeChild(this._box);this._container.style.cursor="";L.DomUtil.enableTextSelection();L.DomUtil.enableImageDrag();L.DomEvent.off(document,"mousemove",this._onMouseMove).off(document,"mouseup",this._onMouseUp).off(document,
"keydown",this._onKeyDown)},_onMouseUp:function(e){this._finish();var map=this._map,layerPoint=map.mouseEventToLayerPoint(e);if(this._startLayerPoint.equals(layerPoint))return;var bounds=new L.LatLngBounds(map.layerPointToLatLng(this._startLayerPoint),map.layerPointToLatLng(layerPoint));map.fitBounds(bounds);map.fire("boxzoomend",{boxZoomBounds:bounds})},_onKeyDown:function(e){if(e.keyCode===27)this._finish()}});L.Map.addInitHook("addHandler","boxZoom",L.Map.BoxZoom);L.Map.mergeOptions({keyboard:true,
keyboardPanOffset:80,keyboardZoomOffset:1});L.Map.Keyboard=L.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61],zoomOut:[189,109,173]},initialize:function(map){this._map=map;this._setPanOffset(map.options.keyboardPanOffset);this._setZoomOffset(map.options.keyboardZoomOffset)},addHooks:function(){var container=this._map._container;if(container.tabIndex===-1)container.tabIndex="0";L.DomEvent.on(container,"focus",this._onFocus,this).on(container,"blur",this._onBlur,
this).on(container,"mousedown",this._onMouseDown,this);this._map.on("focus",this._addHooks,this).on("blur",this._removeHooks,this)},removeHooks:function(){this._removeHooks();var container=this._map._container;L.DomEvent.off(container,"focus",this._onFocus,this).off(container,"blur",this._onBlur,this).off(container,"mousedown",this._onMouseDown,this);this._map.off("focus",this._addHooks,this).off("blur",this._removeHooks,this)},_onMouseDown:function(){if(this._focused)return;var body=document.body,
docEl=document.documentElement,top=body.scrollTop||docEl.scrollTop,left=body.scrollLeft||docEl.scrollLeft;this._map._container.focus();window.scrollTo(left,top)},_onFocus:function(){this._focused=true;this._map.fire("focus")},_onBlur:function(){this._focused=false;this._map.fire("blur")},_setPanOffset:function(pan){var keys=this._panKeys={},codes=this.keyCodes,i,len;for(i=0,len=codes.left.length;i<len;i++)keys[codes.left[i]]=[-1*pan,0];for(i=0,len=codes.right.length;i<len;i++)keys[codes.right[i]]=
[pan,0];for(i=0,len=codes.down.length;i<len;i++)keys[codes.down[i]]=[0,pan];for(i=0,len=codes.up.length;i<len;i++)keys[codes.up[i]]=[0,-1*pan]},_setZoomOffset:function(zoom){var keys=this._zoomKeys={},codes=this.keyCodes,i,len;for(i=0,len=codes.zoomIn.length;i<len;i++)keys[codes.zoomIn[i]]=zoom;for(i=0,len=codes.zoomOut.length;i<len;i++)keys[codes.zoomOut[i]]=-zoom},_addHooks:function(){L.DomEvent.on(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){L.DomEvent.off(document,"keydown",
this._onKeyDown,this)},_onKeyDown:function(e){var key=e.keyCode,map=this._map;if(key in this._panKeys){if(map._panAnim&&map._panAnim._inProgress)return;map.panBy(this._panKeys[key]);if(map.options.maxBounds)map.panInsideBounds(map.options.maxBounds)}else if(key in this._zoomKeys)map.setZoom(map.getZoom()+this._zoomKeys[key]);else return;L.DomEvent.stop(e)}});L.Map.addInitHook("addHandler","keyboard",L.Map.Keyboard);L.Handler.MarkerDrag=L.Handler.extend({initialize:function(marker){this._marker=marker},
addHooks:function(){var icon=this._marker._icon;if(!this._draggable)this._draggable=new L.Draggable(icon,icon);this._draggable.on("dragstart",this._onDragStart,this).on("drag",this._onDrag,this).on("dragend",this._onDragEnd,this);this._draggable.enable()},removeHooks:function(){this._draggable.off("dragstart",this._onDragStart,this).off("drag",this._onDrag,this).off("dragend",this._onDragEnd,this);this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._marker.closePopup().fire("movestart").fire("dragstart")},
_onDrag:function(){var marker=this._marker,shadow=marker._shadow,iconPos=L.DomUtil.getPosition(marker._icon),latlng=marker._map.layerPointToLatLng(iconPos);if(shadow)L.DomUtil.setPosition(shadow,iconPos);marker._latlng=latlng;marker.fire("move",{latlng:latlng}).fire("drag")},_onDragEnd:function(){this._marker.fire("moveend").fire("dragend")}});L.Control=L.Class.extend({options:{position:"topright"},initialize:function(options){L.setOptions(this,options)},getPosition:function(){return this.options.position},
setPosition:function(position){var map=this._map;if(map)map.removeControl(this);this.options.position=position;if(map)map.addControl(this);return this},getContainer:function(){return this._container},addTo:function(map){this._map=map;var container=this._container=this.onAdd(map),pos=this.getPosition(),corner=map._controlCorners[pos];L.DomUtil.addClass(container,"leaflet-control");if(pos.indexOf("bottom")!==-1)corner.insertBefore(container,corner.firstChild);else corner.appendChild(container);return this},
removeFrom:function(map){var pos=this.getPosition(),corner=map._controlCorners[pos];corner.removeChild(this._container);this._map=null;if(this.onRemove)this.onRemove(map);return this}});L.control=function(options){return new L.Control(options)};L.Map.include({addControl:function(control){control.addTo(this);return this},removeControl:function(control){control.removeFrom(this);return this},_initControlPos:function(){var corners=this._controlCorners={},l="leaflet-",container=this._controlContainer=
L.DomUtil.create("div",l+"control-container",this._container);function createCorner(vSide,hSide){var className=l+vSide+" "+l+hSide;corners[vSide+hSide]=L.DomUtil.create("div",className,container)}createCorner("top","left");createCorner("top","right");createCorner("bottom","left");createCorner("bottom","right")},_clearControlPos:function(){this._container.removeChild(this._controlContainer)}});L.Control.Zoom=L.Control.extend({options:{position:"topleft"},onAdd:function(map){var zoomName="leaflet-control-zoom",
container=L.DomUtil.create("div",zoomName+" leaflet-bar");this._map=map;this._zoomInButton=this._createButton("+","Zoom in",zoomName+"-in",container,this._zoomIn,this);this._zoomOutButton=this._createButton("-","Zoom out",zoomName+"-out",container,this._zoomOut,this);map.on("zoomend zoomlevelschange",this._updateDisabled,this);return container},onRemove:function(map){map.off("zoomend zoomlevelschange",this._updateDisabled,this)},_zoomIn:function(e){this._map.zoomIn(e.shiftKey?3:1)},_zoomOut:function(e){this._map.zoomOut(e.shiftKey?
3:1)},_createButton:function(html,title,className,container,fn,context){var link=L.DomUtil.create("a",className,container);link.innerHTML=html;link.href="#";link.title=title;var stop=L.DomEvent.stopPropagation;L.DomEvent.on(link,"click",stop).on(link,"mousedown",stop).on(link,"dblclick",stop).on(link,"click",L.DomEvent.preventDefault).on(link,"click",fn,context);return link},_updateDisabled:function(){var map=this._map,className="leaflet-disabled";L.DomUtil.removeClass(this._zoomInButton,className);
L.DomUtil.removeClass(this._zoomOutButton,className);if(map._zoom===map.getMinZoom())L.DomUtil.addClass(this._zoomOutButton,className);if(map._zoom===map.getMaxZoom())L.DomUtil.addClass(this._zoomInButton,className)}});L.Map.mergeOptions({zoomControl:true});L.Map.addInitHook(function(){if(this.options.zoomControl){this.zoomControl=new L.Control.Zoom;this.addControl(this.zoomControl)}});L.control.zoom=function(options){return new L.Control.Zoom(options)};L.Control.Attribution=L.Control.extend({options:{position:"bottomright",
prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(options){L.setOptions(this,options);this._attributions={}},onAdd:function(map){this._container=L.DomUtil.create("div","leaflet-control-attribution");L.DomEvent.disableClickPropagation(this._container);map.on("layeradd",this._onLayerAdd,this).on("layerremove",this._onLayerRemove,this);this._update();return this._container},onRemove:function(map){map.off("layeradd",this._onLayerAdd).off("layerremove",
this._onLayerRemove)},setPrefix:function(prefix){this.options.prefix=prefix;this._update();return this},addAttribution:function(text){if(!text)return;if(!this._attributions[text])this._attributions[text]=0;this._attributions[text]++;this._update();return this},removeAttribution:function(text){if(!text)return;if(this._attributions[text]){this._attributions[text]--;this._update()}return this},_update:function(){if(!this._map)return;var attribs=[];for(var i in this._attributions)if(this._attributions[i])attribs.push(i);
var prefixAndAttribs=[];if(this.options.prefix)prefixAndAttribs.push(this.options.prefix);if(attribs.length)prefixAndAttribs.push(attribs.join(", "));this._container.innerHTML=prefixAndAttribs.join(" | ")},_onLayerAdd:function(e){if(e.layer.getAttribution)this.addAttribution(e.layer.getAttribution())},_onLayerRemove:function(e){if(e.layer.getAttribution)this.removeAttribution(e.layer.getAttribution())}});L.Map.mergeOptions({attributionControl:true});L.Map.addInitHook(function(){if(this.options.attributionControl)this.attributionControl=
(new L.Control.Attribution).addTo(this)});L.control.attribution=function(options){return new L.Control.Attribution(options)};L.Control.Scale=L.Control.extend({options:{position:"bottomleft",maxWidth:100,metric:true,imperial:true,updateWhenIdle:false},onAdd:function(map){this._map=map;var className="leaflet-control-scale",container=L.DomUtil.create("div",className),options=this.options;this._addScales(options,className,container);map.on(options.updateWhenIdle?"moveend":"move",this._update,this);map.whenReady(this._update,
this);return container},onRemove:function(map){map.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(options,className,container){if(options.metric)this._mScale=L.DomUtil.create("div",className+"-line",container);if(options.imperial)this._iScale=L.DomUtil.create("div",className+"-line",container)},_update:function(){var bounds=this._map.getBounds(),centerLat=bounds.getCenter().lat,halfWorldMeters=6378137*Math.PI*Math.cos(centerLat*Math.PI/180),dist=halfWorldMeters*
(bounds.getNorthEast().lng-bounds.getSouthWest().lng)/180,size=this._map.getSize(),options=this.options,maxMeters=0;if(size.x>0)maxMeters=dist*(options.maxWidth/size.x);this._updateScales(options,maxMeters)},_updateScales:function(options,maxMeters){if(options.metric&&maxMeters)this._updateMetric(maxMeters);if(options.imperial&&maxMeters)this._updateImperial(maxMeters)},_updateMetric:function(maxMeters){var meters=this._getRoundNum(maxMeters);this._mScale.style.width=this._getScaleWidth(meters/maxMeters)+
"px";this._mScale.innerHTML=meters<1E3?meters+" m":meters/1E3+" km"},_updateImperial:function(maxMeters){var maxFeet=maxMeters*3.2808399,scale=this._iScale,maxMiles,miles,feet;if(maxFeet>5280){maxMiles=maxFeet/5280;miles=this._getRoundNum(maxMiles);scale.style.width=this._getScaleWidth(miles/maxMiles)+"px";scale.innerHTML=miles+" mi"}else{feet=this._getRoundNum(maxFeet);scale.style.width=this._getScaleWidth(feet/maxFeet)+"px";scale.innerHTML=feet+" ft"}},_getScaleWidth:function(ratio){return Math.round(this.options.maxWidth*
ratio)-10},_getRoundNum:function(num){var pow10=Math.pow(10,(Math.floor(num)+"").length-1),d=num/pow10;d=d>=10?10:d>=5?5:d>=3?3:d>=2?2:1;return pow10*d}});L.control.scale=function(options){return new L.Control.Scale(options)};L.Control.Layers=L.Control.extend({options:{collapsed:true,position:"topright",autoZIndex:true},initialize:function(baseLayers,overlays,options){L.setOptions(this,options);this._layers={};this._lastZIndex=0;this._handlingClick=false;for(var i in baseLayers)this._addLayer(baseLayers[i],
i);for(i in overlays)this._addLayer(overlays[i],i,true)},onAdd:function(map){this._initLayout();this._update();map.on("layeradd",this._onLayerChange,this).on("layerremove",this._onLayerChange,this);return this._container},onRemove:function(map){map.off("layeradd",this._onLayerChange).off("layerremove",this._onLayerChange)},addBaseLayer:function(layer,name){this._addLayer(layer,name);this._update();return this},addOverlay:function(layer,name){this._addLayer(layer,name,true);this._update();return this},
removeLayer:function(layer){var id=L.stamp(layer);delete this._layers[id];this._update();return this},_initLayout:function(){var className="leaflet-control-layers",container=this._container=L.DomUtil.create("div",className);container.setAttribute("aria-haspopup",true);if(!L.Browser.touch){L.DomEvent.disableClickPropagation(container);L.DomEvent.on(container,"mousewheel",L.DomEvent.stopPropagation)}else L.DomEvent.on(container,"click",L.DomEvent.stopPropagation);var form=this._form=L.DomUtil.create("form",
className+"-list");if(this.options.collapsed){if(!L.Browser.android)L.DomEvent.on(container,"mouseover",this._expand,this).on(container,"mouseout",this._collapse,this);var link=this._layersLink=L.DomUtil.create("a",className+"-toggle",container);link.href="#";link.title="Layers";if(L.Browser.touch)L.DomEvent.on(link,"click",L.DomEvent.stop).on(link,"click",this._expand,this);else L.DomEvent.on(link,"focus",this._expand,this);this._map.on("click",this._collapse,this)}else this._expand();this._baseLayersList=
L.DomUtil.create("div",className+"-base",form);this._separator=L.DomUtil.create("div",className+"-separator",form);this._overlaysList=L.DomUtil.create("div",className+"-overlays",form);container.appendChild(form)},_addLayer:function(layer,name,overlay){var id=L.stamp(layer);this._layers[id]={layer:layer,name:name,overlay:overlay};if(this.options.autoZIndex&&layer.setZIndex){this._lastZIndex++;layer.setZIndex(this._lastZIndex)}},_update:function(){if(!this._container)return;this._baseLayersList.innerHTML=
"";this._overlaysList.innerHTML="";var baseLayersPresent=false,overlaysPresent=false,i,obj;for(i in this._layers){obj=this._layers[i];this._addItem(obj);overlaysPresent=overlaysPresent||obj.overlay;baseLayersPresent=baseLayersPresent||!obj.overlay}this._separator.style.display=overlaysPresent&&baseLayersPresent?"":"none"},_onLayerChange:function(e){var obj=this._layers[L.stamp(e.layer)];if(!obj)return;if(!this._handlingClick)this._update();var type=obj.overlay?e.type==="layeradd"?"overlayadd":"overlayremove":
e.type==="layeradd"?"baselayerchange":null;if(type)this._map.fire(type,obj)},_createRadioElement:function(name,checked){var radioHtml='<input type="radio" class="leaflet-control-layers-selector" name="'+name+'"';if(checked)radioHtml+=' checked="checked"';radioHtml+="/>";var radioFragment=document.createElement("div");radioFragment.innerHTML=radioHtml;return radioFragment.firstChild},_addItem:function(obj){var label=document.createElement("label"),input,checked=this._map.hasLayer(obj.layer);if(obj.overlay){input=
document.createElement("input");input.type="checkbox";input.className="leaflet-control-layers-selector";input.defaultChecked=checked}else input=this._createRadioElement("leaflet-base-layers",checked);input.layerId=L.stamp(obj.layer);L.DomEvent.on(input,"click",this._onInputClick,this);var name=document.createElement("span");name.innerHTML=" "+obj.name;label.appendChild(input);label.appendChild(name);var container=obj.overlay?this._overlaysList:this._baseLayersList;container.appendChild(label);return label},
_onInputClick:function(){var i,input,obj,inputs=this._form.getElementsByTagName("input"),inputsLen=inputs.length;this._handlingClick=true;for(i=0;i<inputsLen;i++){input=inputs[i];obj=this._layers[input.layerId];if(input.checked&&!this._map.hasLayer(obj.layer))this._map.addLayer(obj.layer);else if(!input.checked&&this._map.hasLayer(obj.layer))this._map.removeLayer(obj.layer)}this._handlingClick=false},_expand:function(){L.DomUtil.addClass(this._container,"leaflet-control-layers-expanded")},_collapse:function(){this._container.className=
this._container.className.replace(" leaflet-control-layers-expanded","")}});L.control.layers=function(baseLayers,overlays,options){return new L.Control.Layers(baseLayers,overlays,options)};L.PosAnimation=L.Class.extend({includes:L.Mixin.Events,run:function(el,newPos,duration,easeLinearity){this.stop();this._el=el;this._inProgress=true;this._newPos=newPos;this.fire("start");el.style[L.DomUtil.TRANSITION]="all "+(duration||0.25)+"s cubic-bezier(0,0,"+(easeLinearity||0.5)+",1)";L.DomEvent.on(el,L.DomUtil.TRANSITION_END,
this._onTransitionEnd,this);L.DomUtil.setPosition(el,newPos);L.Util.falseFn(el.offsetWidth);this._stepTimer=setInterval(L.bind(this._onStep,this),50)},stop:function(){if(!this._inProgress)return;L.DomUtil.setPosition(this._el,this._getPos());this._onTransitionEnd();L.Util.falseFn(this._el.offsetWidth)},_onStep:function(){var stepPos=this._getPos();if(!stepPos){this._onTransitionEnd();return}this._el._leaflet_pos=stepPos;this.fire("step")},_transformRe:/([-+]?(?:\d*\.)?\d+)\D*, ([-+]?(?:\d*\.)?\d+)\D*\)/,
_getPos:function(){var left,top,matches,el=this._el,style=window.getComputedStyle(el);if(L.Browser.any3d){matches=style[L.DomUtil.TRANSFORM].match(this._transformRe);if(!matches)return;left=parseFloat(matches[1]);top=parseFloat(matches[2])}else{left=parseFloat(style.left);top=parseFloat(style.top)}return new L.Point(left,top,true)},_onTransitionEnd:function(){L.DomEvent.off(this._el,L.DomUtil.TRANSITION_END,this._onTransitionEnd,this);if(!this._inProgress)return;this._inProgress=false;this._el.style[L.DomUtil.TRANSITION]=
"";this._el._leaflet_pos=this._newPos;clearInterval(this._stepTimer);this.fire("step").fire("end")}});L.Map.include({setView:function(center,zoom,options){zoom=this._limitZoom(zoom);center=L.latLng(center);options=options||{};if(this._panAnim)this._panAnim.stop();if(this._loaded&&!options.reset&&options!==true){if(options.animate!==undefined){options.zoom=L.extend({animate:options.animate},options.zoom);options.pan=L.extend({animate:options.animate},options.pan)}var animated=this._zoom!==zoom?this._tryAnimatedZoom&&
this._tryAnimatedZoom(center,zoom,options.zoom):this._tryAnimatedPan(center,options.pan);if(animated){clearTimeout(this._sizeTimer);return this}}this._resetView(center,zoom);return this},panBy:function(offset,options){offset=L.point(offset).round();options=options||{};if(!offset.x&&!offset.y)return this;if(!this._panAnim){this._panAnim=new L.PosAnimation;this._panAnim.on({"step":this._onPanTransitionStep,"end":this._onPanTransitionEnd},this)}if(!options.noMoveStart)this.fire("movestart");if(options.animate!==
false){L.DomUtil.addClass(this._mapPane,"leaflet-pan-anim");var newPos=this._getMapPanePos().subtract(offset);this._panAnim.run(this._mapPane,newPos,options.duration||0.25,options.easeLinearity)}else{this._rawPanBy(offset);this.fire("move").fire("moveend")}return this},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){L.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim");this.fire("moveend")},_tryAnimatedPan:function(center,options){var offset=this._getCenterOffset(center)._floor();
if((options&&options.animate)!==true&&!this.getSize().contains(offset))return false;this.panBy(offset,options);return true}});L.PosAnimation=L.DomUtil.TRANSITION?L.PosAnimation:L.PosAnimation.extend({run:function(el,newPos,duration,easeLinearity){this.stop();this._el=el;this._inProgress=true;this._duration=duration||0.25;this._easeOutPower=1/Math.max(easeLinearity||0.5,0.2);this._startPos=L.DomUtil.getPosition(el);this._offset=newPos.subtract(this._startPos);this._startTime=+new Date;this.fire("start");
this._animate()},stop:function(){if(!this._inProgress)return;this._step();this._complete()},_animate:function(){this._animId=L.Util.requestAnimFrame(this._animate,this);this._step()},_step:function(){var elapsed=+new Date-this._startTime,duration=this._duration*1E3;if(elapsed<duration)this._runFrame(this._easeOut(elapsed/duration));else{this._runFrame(1);this._complete()}},_runFrame:function(progress){var pos=this._startPos.add(this._offset.multiplyBy(progress));L.DomUtil.setPosition(this._el,pos);
this.fire("step")},_complete:function(){L.Util.cancelAnimFrame(this._animId);this._inProgress=false;this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}});L.Map.mergeOptions({zoomAnimation:true,zoomAnimationThreshold:4});if(L.DomUtil.TRANSITION)L.Map.addInitHook(function(){this._zoomAnimated=this.options.zoomAnimation&&L.DomUtil.TRANSITION&&L.Browser.any3d&&!L.Browser.android23&&!L.Browser.mobileOpera;if(this._zoomAnimated)L.DomEvent.on(this._mapPane,L.DomUtil.TRANSITION_END,
this._catchTransitionEnd,this)});L.Map.include(!L.DomUtil.TRANSITION?{}:{_catchTransitionEnd:function(){if(this._animatingZoom)this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(center,zoom,options){if(this._animatingZoom)return true;options=options||{};if(!this._zoomAnimated||options.animate===false||this._nothingToAnimate()||Math.abs(zoom-this._zoom)>this.options.zoomAnimationThreshold)return false;
var scale=this.getZoomScale(zoom),offset=this._getCenterOffset(center)._divideBy(1-1/scale),origin=this._getCenterLayerPoint()._add(offset);if(options.animate!==true&&!this.getSize().contains(offset))return false;this.fire("movestart").fire("zoomstart");this._animateZoom(center,zoom,origin,scale,null,true);return true},_animateZoom:function(center,zoom,origin,scale,delta,backwards){this._animatingZoom=true;L.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim");this._animateToCenter=center;this._animateToZoom=
zoom;if(L.Draggable)L.Draggable._disabled=true;this.fire("zoomanim",{center:center,zoom:zoom,origin:origin,scale:scale,delta:delta,backwards:backwards})},_onZoomTransitionEnd:function(){this._animatingZoom=false;L.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim");this._resetView(this._animateToCenter,this._animateToZoom,true,true);if(L.Draggable)L.Draggable._disabled=false}});L.TileLayer.include({_animateZoom:function(e){if(!this._animating){this._animating=true;this._prepareBgBuffer()}var bg=
this._bgBuffer,transform=L.DomUtil.TRANSFORM,initialTransform=e.delta?L.DomUtil.getTranslateString(e.delta):bg.style[transform],scaleStr=L.DomUtil.getScaleString(e.scale,e.origin);bg.style[transform]=e.backwards?scaleStr+" "+initialTransform:initialTransform+" "+scaleStr},_endZoomAnim:function(){var front=this._tileContainer,bg=this._bgBuffer;front.style.visibility="";front.parentNode.appendChild(front);L.Util.falseFn(bg.offsetWidth);this._animating=false},_clearBgBuffer:function(){var map=this._map;
if(map&&!map._animatingZoom&&!map.touchZoom._zooming){this._bgBuffer.innerHTML="";this._bgBuffer.style[L.DomUtil.TRANSFORM]=""}},_prepareBgBuffer:function(){var front=this._tileContainer,bg=this._bgBuffer;var bgLoaded=this._getLoadedTilesPercentage(bg),frontLoaded=this._getLoadedTilesPercentage(front);if(bg&&bgLoaded>0.5&&frontLoaded<0.5){front.style.visibility="hidden";this._stopLoadingImages(front);return}bg.style.visibility="hidden";bg.style[L.DomUtil.TRANSFORM]="";this._tileContainer=bg;bg=this._bgBuffer=
front;this._stopLoadingImages(bg);clearTimeout(this._clearBgBufferTimer)},_getLoadedTilesPercentage:function(container){var tiles=container.getElementsByTagName("img"),i,len,count=0;for(i=0,len=tiles.length;i<len;i++)if(tiles[i].complete)count++;return count/len},_stopLoadingImages:function(container){var tiles=Array.prototype.slice.call(container.getElementsByTagName("img")),i,len,tile;for(i=0,len=tiles.length;i<len;i++){tile=tiles[i];if(!tile.complete){tile.onload=L.Util.falseFn;tile.onerror=L.Util.falseFn;
tile.src=L.Util.emptyImageUrl;tile.parentNode.removeChild(tile)}}}});L.Map.include({_defaultLocateOptions:{watch:false,setView:false,maxZoom:Infinity,timeout:1E4,maximumAge:0,enableHighAccuracy:false},locate:function(options){options=this._locateOptions=L.extend(this._defaultLocateOptions,options);if(!navigator.geolocation){this._handleGeolocationError({code:0,message:"Geolocation not supported."});return this}var onResponse=L.bind(this._handleGeolocationResponse,this),onError=L.bind(this._handleGeolocationError,
this);if(options.watch)this._locationWatchId=navigator.geolocation.watchPosition(onResponse,onError,options);else navigator.geolocation.getCurrentPosition(onResponse,onError,options);return this},stopLocate:function(){if(navigator.geolocation)navigator.geolocation.clearWatch(this._locationWatchId);if(this._locateOptions)this._locateOptions.setView=false;return this},_handleGeolocationError:function(error){var c=error.code,message=error.message||(c===1?"permission denied":c===2?"position unavailable":
"timeout");if(this._locateOptions.setView&&!this._loaded)this.fitWorld();this.fire("locationerror",{code:c,message:"Geolocation error: "+message+"."})},_handleGeolocationResponse:function(pos){var lat=pos.coords.latitude,lng=pos.coords.longitude,latlng=new L.LatLng(lat,lng),latAccuracy=180*pos.coords.accuracy/40075017,lngAccuracy=latAccuracy/Math.cos(L.LatLng.DEG_TO_RAD*lat),bounds=L.latLngBounds([lat-latAccuracy,lng-lngAccuracy],[lat+latAccuracy,lng+lngAccuracy]),options=this._locateOptions;if(options.setView){var zoom=
Math.min(this.getBoundsZoom(bounds),options.maxZoom);this.setView(latlng,zoom)}var data={latlng:latlng,bounds:bounds};for(var i in pos.coords)if(typeof pos.coords[i]==="number")data[i]=pos.coords[i];this.fire("locationfound",data)}})})(window,document);
(function(factory){var L,proj4;if(typeof define==="function"&&define.amd)define(["leaflet","proj4"],factory);else if(typeof module!=="undefined"){L=require("leaflet");proj4=require("proj4");module.exports=factory(L,proj4)}else{if(typeof window.L==="undefined"||typeof window.proj4==="undefined")throw"Leaflet and proj4 must be loaded first";factory(window.L,window.proj4)}})(function(L,proj4){L.Proj={};L.Proj._isProj4Obj=function(a){return typeof a["inverse"]!=="undefined"&&typeof a["forward"]!=="undefined"};
L.Proj.ScaleDependantTransformation=function(scaleTransforms){this.scaleTransforms=scaleTransforms};L.Proj.ScaleDependantTransformation.prototype.transform=function(point,scale){return this.scaleTransforms[scale].transform(point,scale)};L.Proj.ScaleDependantTransformation.prototype.untransform=function(point,scale){return this.scaleTransforms[scale].untransform(point,scale)};L.Proj.Projection=L.Class.extend({initialize:function(a,def){if(L.Proj._isProj4Obj(a))this._proj=a;else{var code=a;if(def)proj4.defs(code,
def);else if(proj4.defs[code]===undefined){var urn=code.split(":");if(urn.length>3)code=urn[urn.length-3]+":"+urn[urn.length-1];if(proj4.defs[code]===undefined)throw"No projection definition for code "+code;}this._proj=proj4(code)}},project:function(latlng){var point=this._proj.forward([latlng.lng,latlng.lat]);return new L.Point(point[0],point[1])},unproject:function(point,unbounded){var point2=this._proj.inverse([point.x,point.y]);return new L.LatLng(point2[1],point2[0],unbounded)}});L.Proj.CRS=
L.Class.extend({includes:L.CRS,options:{transformation:new L.Transformation(1,0,-1,0)},initialize:function(a,b,c){var code,proj,def,options;if(L.Proj._isProj4Obj(a)){proj=a;code=proj.srsCode;options=b||{};this.projection=new L.Proj.Projection(proj)}else{code=a;def=b;options=c||{};this.projection=new L.Proj.Projection(code,def)}L.Util.setOptions(this,options);this.code=code;this.transformation=this.options.transformation;if(this.options.origin)this.transformation=new L.Transformation(1,-this.options.origin[0],
-1,this.options.origin[1]);if(this.options.scales)this.scale=function(zoom){return this.options.scales[zoom]};else if(this.options.resolutions)this.scale=function(zoom){return 1/this.options.resolutions[zoom+this.options.zoomInfo.min]}}});L.Proj.CRS.TMS=L.Proj.CRS.extend({initialize:function(a,b,c,d){if(L.Proj._isProj4Obj(a)){var proj=a,projectedBounds=b,options=c||{};options.origin=[projectedBounds[0],projectedBounds[3]];L.Proj.CRS.prototype.initialize(proj,options)}else{var code=a,def=b,projectedBounds=
c,options=d||{};options.origin=[projectedBounds[0],projectedBounds[3]];L.Proj.CRS.prototype.initialize(code,def,options);L.setOptions(this,options)}this.projectedBounds=projectedBounds}});L.Proj.TileLayer={};L.Proj.TileLayer.TMSX=L.TileLayer.extend({options:{tms:true,continuousWorld:true},initialize:function(urlTemplate,crs,options){var boundsMatchesGrid=true,scaleTransforms,upperY,crsBounds,key;if(!(crs instanceof L.Proj.CRS.TMS))throw new Error("CRS is not L.Proj.CRS.TMS.");L.TileLayer.prototype.initialize.call(this,
urlTemplate,options);this.key=this.options.key;this.crs=crs;crsBounds=this.crs.projectedBounds;for(var i=this.options.minZoom;i<this.options.maxZoom&&boundsMatchesGrid;i++){var gridHeight=(crsBounds[3]-crsBounds[1])/this._projectedTileSize(i);boundsMatchesGrid=Math.abs(gridHeight-Math.round(gridHeight))>0.001}if(!boundsMatchesGrid){console.warn(this.key,"boundsMatchesGrid = false");scaleTransforms={};for(var i=this.options.minZoom;i<this.options.maxZoom;i++){upperY=crsBounds[1]+Math.ceil((crsBounds[3]-
crsBounds[1])/this._projectedTileSize(i))*this._projectedTileSize(i);scaleTransforms[this.crs.scale(i)]=new L.Transformation(1,-crsBounds[0],-1,upperY)}this.crs=new L.Proj.CRS.TMS(this.crs.projection._proj,crsBounds,this.crs.options);this.crs.transformation=new L.Proj.ScaleDependantTransformation(scaleTransforms)}},getTileUrl:function(tilePoint){var z=this._getZoomForUrl(),gridHeight=Math.ceil((this.crs.projectedBounds[3]-this.crs.projectedBounds[1])/this._projectedTileSize(z));console.log(this.key,
JSON.stringify(tilePoint));return L.Util.template(this._url,L.Util.extend({s:this._getSubdomain(tilePoint),z:z,x:tilePoint.x,y:tilePoint.y},this.options))},_projectedTileSize:function(zoom){return this.options.tileSize/this.crs.scale(zoom)}});L.Proj.GeoJSON=L.GeoJSON.extend({initialize:function(geojson,options){if(geojson.crs&&geojson.crs.type=="name"){var crs=new L.Proj.CRS(geojson.crs.properties.name);options=options||{};options.coordsToLatLng=function(coords){var point=L.point(coords[0],coords[1]);
return crs.projection.unproject(point)}}L.GeoJSON.prototype.initialize.call(this,geojson,options)}});L.Proj.geoJson=function(geojson,options){return new L.Proj.GeoJSON(geojson,options)};if(typeof L.CRS!=="undefined")L.CRS.proj4js=function(){return function(code,def,transformation,options){options=options||{};if(transformation)options.transformation=transformation;return new L.Proj.CRS(code,def,options)}}();return L.Proj});
L.Control.Zoomslider=function(){var Knob=L.Draggable.extend({initialize:function(element,stepHeight,knobHeight){L.Draggable.prototype.initialize.call(this,element,element);this._element=element;this._stepHeight=stepHeight;this._knobHeight=knobHeight;this.on("predrag",function(){this._newPos.x=0;this._newPos.y=this._adjust(this._newPos.y)},this)},_adjust:function(y){var value=Math.round(this._toValue(y));value=Math.max(0,Math.min(this._maxValue,value));return this._toY(value)},_toY:function(value){return this._k*
value+this._m},_toValue:function(y){return(y-this._m)/this._k},setSteps:function(steps){var sliderHeight=steps*this._stepHeight;this._maxValue=steps-1;this._k=-this._stepHeight;this._m=sliderHeight-(this._stepHeight+this._knobHeight)/2},setPosition:function(y){L.DomUtil.setPosition(this._element,L.point(0,this._adjust(y)))},setValue:function(v){this.setPosition(this._toY(v))},getValue:function(){return this._toValue(L.DomUtil.getPosition(this._element).y)}});var Zoomslider=L.Control.extend({options:{position:"topleft",
stepHeight:8,knobHeight:6,styleNS:"leaflet-control-zoomslider"},onAdd:function(map){this._map=map;this._ui=this._createUI();this._knob=new Knob(this._ui.knob,this.options.stepHeight,this.options.knobHeight);map.whenReady(this._initKnob,this).whenReady(this._initEvents,this).whenReady(this._updateSize,this).whenReady(this._updateKnobValue,this).whenReady(this._updateDisabled,this);return this._ui.bar},onRemove:function(map){map.off("zoomlevelschange",this._updateSize,this).off("zoomend zoomlevelschange",
this._updateKnobValue,this).off("zoomend zoomlevelschange",this._updateDisabled,this)},_createUI:function(){var ui={},ns=this.options.styleNS;ui.bar=L.DomUtil.create("div",ns+" leaflet-bar"),ui.zoomIn=this._createZoomBtn("in","top",ui.bar),ui.wrap=L.DomUtil.create("div",ns+"-wrap leaflet-bar-part",ui.bar),ui.zoomOut=this._createZoomBtn("out","bottom",ui.bar),ui.body=L.DomUtil.create("div",ns+"-body",ui.wrap),ui.knob=L.DomUtil.create("div",ns+"-knob");L.DomEvent.disableClickPropagation(ui.bar);L.DomEvent.disableClickPropagation(ui.knob);
return ui},_createZoomBtn:function(zoomDir,end,container){var classDef=this.options.styleNS+"-"+zoomDir+" leaflet-bar-part"+" leaflet-bar-part-"+end,link=L.DomUtil.create("a",classDef,container);link.href="#";link.title="Zoom "+zoomDir;L.DomEvent.on(link,"click",L.DomEvent.preventDefault);return link},_initKnob:function(){this._knob.enable();this._ui.body.appendChild(this._ui.knob)},_initEvents:function(map){this._map.on("zoomlevelschange",this._updateSize,this).on("zoomend zoomlevelschange",this._updateKnobValue,
this).on("zoomend zoomlevelschange",this._updateDisabled,this);L.DomEvent.on(this._ui.body,"click",this._onSliderClick,this);L.DomEvent.on(this._ui.zoomIn,"click",this._zoomIn,this);L.DomEvent.on(this._ui.zoomOut,"click",this._zoomOut,this);this._knob.on("dragend",this._updateMapZoom,this)},_onSliderClick:function(e){var first=e.touches&&e.touches.length===1?e.touches[0]:e,y=L.DomEvent.getMousePosition(first).y-L.DomUtil.getViewportOffset(this._ui.body).y;this._knob.setPosition(y);this._updateMapZoom()},
_zoomIn:function(e){this._map.zoomIn(e.shiftKey?3:1)},_zoomOut:function(e){this._map.zoomOut(e.shiftKey?3:1)},_zoomLevels:function(){var zoomLevels=this._map.getMaxZoom()-this._map.getMinZoom()+1;return zoomLevels<Infinity?zoomLevels:0},_toZoomLevel:function(value){return value+this._map.getMinZoom()},_toValue:function(zoomLevel){return zoomLevel-this._map.getMinZoom()},_updateSize:function(){var steps=this._zoomLevels();this._ui.body.style.height=this.options.stepHeight*steps+"px";this._knob.setSteps(steps)},
_updateMapZoom:function(){this._map.setZoom(this._toZoomLevel(this._knob.getValue()))},_updateKnobValue:function(){this._knob.setValue(this._toValue(this._map.getZoom()))},_updateDisabled:function(){var zoomLevel=this._map.getZoom(),className=this.options.styleNS+"-disabled";L.DomUtil.removeClass(this._ui.zoomIn,className);L.DomUtil.removeClass(this._ui.zoomOut,className);if(zoomLevel===this._map.getMinZoom())L.DomUtil.addClass(this._ui.zoomOut,className);if(zoomLevel===this._map.getMaxZoom())L.DomUtil.addClass(this._ui.zoomIn,
className)}});return Zoomslider}();L.Map.mergeOptions({zoomControl:false,zoomsliderControl:true});L.Map.addInitHook(function(){if(this.options.zoomsliderControl){this.zoomsliderControl=new L.Control.Zoomslider;this.addControl(this.zoomsliderControl)}});L.control.zoomslider=function(options){return new L.Control.Zoomslider(options)};
L.Control.Coordinates=L.Control.extend({options:{position:"bottomleft",decimals:5,decimalSeperator:".",labelTemplateLat:"Lat: {y}",labelTemplateLng:"Lng: {x}",labelFormatterLat:undefined,labelFormatterLng:undefined,enableUserInput:true,useDMS:false,useLatLngOrder:false,centerUserCoordinates:true},onAdd:function(map){this._map=map;var className="leaflet-control-coordinates",container=this._container=L.DomUtil.create("div",className),options=this.options;this._labelcontainer=L.DomUtil.create("div",
"uiElement label",container);var link=L.DomUtil.create("a",className+"-image",this._labelcontainer);link.href="#";link.title="Add Marker";this._label=L.DomUtil.create("span","labelFirst",this._labelcontainer);this._inputcontainer=L.DomUtil.create("div","uiElement input uiHidden",container);var xSpan,ySpan,mSpan;if(options.useLatLngOrder){ySpan=L.DomUtil.create("span","",this._inputcontainer);this._inputY=this._createInput("inputY",this._inputcontainer);xSpan=L.DomUtil.create("span","",this._inputcontainer);
this._inputX=this._createInput("inputX",this._inputcontainer);mSpan=L.DomUtil.create("span","",this._inputcontainer);this._inputM=this._createInput("inputM",this._inputcontainer)}else{xSpan=L.DomUtil.create("span","",this._inputcontainer);this._inputX=this._createInput("inputX",this._inputcontainer);$(this._inputX).attr("size",10);ySpan=L.DomUtil.create("span","",this._inputcontainer);this._inputY=this._createInput("inputY",this._inputcontainer);$(this._inputY).attr("size",10);mSpan=L.DomUtil.create("span",
"",this._inputcontainer);this._inputM=this._createInput("inputM",this._inputcontainer);$(this._inputM).attr("size",10)}xSpan.innerHTML=options.labelTemplateLng.replace(" {x}","");ySpan.innerHTML=options.labelTemplateLat.replace(" {y}","");mSpan.innerHTML=" Feature";L.DomEvent.on(this._inputX,"keyup",this._handleKeypress,this);L.DomEvent.on(this._inputY,"keyup",this._handleKeypress,this);L.DomEvent.on(this._inputM,"keyup",this._handleKeypress,this);map.on("mousemove",this._update,this);map.on("dragstart",
this.collapse,this);map.whenReady(this._update,this);this._showsCoordinates=true;if(options.enableUserInput)L.DomEvent.addListener(this._container,"click",this._switchUI,this);return container},_createInput:function(classname,container){var input=L.DomUtil.create("input",classname,container);input.type="text";L.DomEvent.disableClickPropagation(input);return input},_clearMarker:function(){this._map.removeLayer(this._marker)},_handleKeypress:function(e){switch(e.keyCode){case 27:this.collapse();break;
case 13:this._handleSubmit();this.collapse();break;default:this._handleSubmit();break}},_handleSubmit:function(){var x=L.NumberFormatter.createValidNumber(this._inputX.value,this.options.decimalSeperator);var y=L.NumberFormatter.createValidNumber(this._inputY.value,this.options.decimalSeperator);var m=this._inputM.value;if(x!==undefined&&y!==undefined&&m!==undefined)MAPS.setMarker(this._map,y,x,m)},expand:function(marker){this._showsCoordinates=false;this._map.off("mousemove",this._update,this);L.DomEvent.addListener(this._container,
"mousemove",L.DomEvent.stop);L.DomEvent.removeListener(this._container,"click",this._switchUI,this);L.DomUtil.addClass(this._labelcontainer,"uiHidden");L.DomUtil.removeClass(this._inputcontainer,"uiHidden");if(!marker&&MAPS.markers.length){if(this._map===MAPS.right.map&&MAPS.markers[0])marker=MAPS.markers[0];if(this._map===MAPS.left.map&&MAPS.markers[1])marker=MAPS.markers[1]}if(!marker){var lat=MAPS.getCenter(this._map).lat.toFixed(5);var lng=MAPS.getCenter(this._map).lng.toFixed(5);marker=MAPS.setMarker(this._map,
lat,lng,"name me")}this._inputY.value=marker._latlng.lat;this._inputX.value=marker._latlng.lng;this._inputM.value=marker.options.icon.options.html},_createCoordinateLabel:function(ll){var opts=this.options,x,y;if(opts.labelFormatterLng)x=opts.labelFormatterLng(ll.lng);else x=L.Util.template(opts.labelTemplateLng,{x:this._getNumber(ll.lng,opts)});if(opts.labelFormatterLat)y=opts.labelFormatterLat(ll.lat);else y=L.Util.template(opts.labelTemplateLat,{y:this._getNumber(ll.lat,opts)});if(opts.useLatLngOrder)return y+
" "+x;return x+" "+y},_getNumber:function(n,opts){var res;if(opts.useDMS)res=L.NumberFormatter.toDMS(n);else res=L.NumberFormatter.round(n,opts.decimals,opts.decimalSeperator);return res},collapse:function(){if(!this._showsCoordinates){this._map.on("mousemove",this._update,this);this._showsCoordinates=true;var opts=this.options;L.DomEvent.addListener(this._container,"click",this._switchUI,this);L.DomEvent.removeListener(this._container,"mousemove",L.DomEvent.stop);L.DomUtil.addClass(this._inputcontainer,
"uiHidden");L.DomUtil.removeClass(this._labelcontainer,"uiHidden");if(this._marker){var m=L.marker(),ll=this._marker.getLatLng();m.setLatLng(ll);var container=L.DomUtil.create("div","");var label=L.DomUtil.create("div","",container);label.innerHTML=this._createCoordinateLabel(ll);var close=L.DomUtil.create("a","",container);close.innerHTML="Remove";close.href="#";var stop=L.DomEvent.stopPropagation;L.DomEvent.on(close,"click",stop).on(close,"mousedown",stop).on(close,"dblclick",stop).on(close,"click",
L.DomEvent.preventDefault).on(close,"click",function(){this._map.removeLayer(m)},this);m.bindPopup(container);m.addTo(this._map);this._map.removeLayer(this._marker);this._marker=null}}},_switchUI:function(evt){L.DomEvent.stop(evt);L.DomEvent.stopPropagation(evt);L.DomEvent.preventDefault(evt);if(this._showsCoordinates);else this.collapse()},onRemove:function(map){map.off("mousemove",this._update,this)},_update:function(evt){var pos=evt.latlng,opts=this.options;if(pos){pos=pos.wrap();this._currentPos=
pos;this._inputY.value=L.NumberFormatter.round(pos.lat,opts.decimals,opts.decimalSeperator);this._inputX.value=L.NumberFormatter.round(pos.lng,opts.decimals,opts.decimalSeperator);this._label.innerHTML=this._createCoordinateLabel(pos)}}});L.control.coordinates=function(options){return new L.Control.Coordinates(options)};L.Map.mergeOptions({coordinateControl:false});L.Map.addInitHook(function(){if(this.options.coordinateControl){this.coordinateControl=new L.Control.Coordinates;this.addControl(this.coordinateControl)}});
L.NumberFormatter={round:function(num,dec,sep){var res=L.Util.formatNum(num,dec)+"",numbers=res.split(".");if(numbers[1]){var d=dec-numbers[1].length;for(;d>0;d--)numbers[1]+="0";res=numbers.join(sep||".")}return res},toDMS:function(deg){var d=Math.floor(deg);var minfloat=(deg-d)*60;var m=Math.floor(minfloat);var secfloat=(minfloat-m)*60;var s=Math.round(secfloat);if(s==60){m++;s="00"}if(m==60){d++;m="00"}if(s<10)s="0"+s;if(m<10)m="0"+m;return""+d+"&deg; "+m+"' "+s+"''"},createValidNumber:function(num,
sep){if(num&&num.length>0){var numbers=num.split(sep||".");try{var numRes=Number(numbers.join("."));if(isNaN(numRes))return undefined;return numRes}catch(e){return undefined}}return undefined}};"use strict";
L.Control.Loading=L.Control.extend({options:{position:"topleft",separate:true,zoomControl:null},initialize:function(options){L.setOptions(this,options);this._dataLoaders={};if(this.options.zoomControl!==null)this.zoomControl=this.options.zoomControl},onAdd:function(map){this._addLayerListeners(map);this._addMapListeners(map);if(!this.options.separate&&!this.zoomControl)this.zoomControl=map.zoomControl;var classes="leaflet-control-loading";var container;if(this.zoomControl&&!this.options.separate){container=
this.zoomControl._container;classes+=" leaflet-bar-part-bottom leaflet-bar-part last"}else container=L.DomUtil.create("div","leaflet-control-loader leaflet-bar");this._indicator=L.DomUtil.create("a",classes,container);$(this._indicator.parentNode).css({"box-shadow":"0 0","background-color":"transparent"});return container},onRemove:function(map){this._removeLayerListeners(map);this._removeMapListeners(map)},removeFrom:function(map){if(this.zoomControl&&!this.options.separate){this._container.removeChild(this._indicator);
this._map=null;this.onRemove(map);return this}else return L.Control.prototype.removeFrom.call(this,map)},addLoader:function(id){this._dataLoaders[id]=true;this.updateIndicator()},removeLoader:function(id){delete this._dataLoaders[id];this.updateIndicator()},updateIndicator:function(){if(this.isLoading())this._showIndicator();else this._hideIndicator()},isLoading:function(){return this._countLoaders()>0},_countLoaders:function(){var size=0,key;for(key in this._dataLoaders)if(this._dataLoaders.hasOwnProperty(key))size++;
return size},_showIndicator:function(){$(this._indicator.parentNode).css({"visibility":"visible","background-color":"#EEE","box-shadow":"0 1px 7px rgba(0,0,0,0.65)","-webkit-border-radius":"4px","border-radius":"4px"});L.DomUtil.addClass(this._indicator,"is-loading")},_hideIndicator:function(){setTimeout(L.bind(function(){$(this._indicator.parentNode).css({visibility:"hidden"});L.DomUtil.removeClass(this._indicator,"is-loading")},this),100)},_handleLoading:function(e){this.addLoader(this.getEventId(e))},
_handleLoad:function(e){this.removeLoader(this.getEventId(e))},getEventId:function(e){if(e.id)return e.id;else if(e.layer)return e.layer._leaflet_id;return e.target._leaflet_id},_layerAdd:function(e){if(!e.layer||!e.layer.on)return;e.layer.on({loading:this._handleLoading,load:this._handleLoad},this)},_addLayerListeners:function(map){map.eachLayer(function(layer){if(!layer.on)return;layer.on({loading:this._handleLoading,load:this._handleLoad},this)},this);map.on("layeradd",this._layerAdd,this)},_removeLayerListeners:function(map){map.eachLayer(function(layer){if(!layer.off)return;
layer.off({loading:this._handleLoading,load:this._handleLoad},this)},this);map.off("layeradd",this._layerAdd,this)},_addMapListeners:function(map){map.on({dataloading:this._handleLoading,dataload:this._handleLoad},this)},_removeMapListeners:function(map){map.off({dataloading:this._handleLoading,dataload:this._handleLoad},this)}});L.Map.addInitHook(function(){if(this.options.loadingControl){this.loadingControl=new L.Control.Loading;this.addControl(this.loadingControl)}});L.Control.loading=function(options){return new L.Control.Loading(options)};
L.Control.FullScreen=L.Control.extend({options:{position:"topleft",title:"Toggle Full Screen",forceSeparateButton:false},onAdd:function(map){if(!fullScreenApi.supportsFullScreen)return map.zoomControl?map.zoomControl._container:L.DomUtil.create("div","");var className="leaflet-control-zoom-fullscreen",container;if(map.zoomControl&&!this.options.forceSeparateButton)container=map.zoomControl._container;else container=L.DomUtil.create("div","leaflet-bar");this._createButton(this.options.title,className,
container,this.toogleFullScreen,map);return container},_createButton:function(title,className,container,fn,context){var link=L.DomUtil.create("a",className,container);link.href="#";link.title=title;L.DomEvent.addListener(link,"click",L.DomEvent.stopPropagation).addListener(link,"click",L.DomEvent.preventDefault).addListener(link,"click",fn,context);L.DomEvent.addListener(container,fullScreenApi.fullScreenEventName,L.DomEvent.stopPropagation).addListener(container,fullScreenApi.fullScreenEventName,
L.DomEvent.preventDefault).addListener(container,fullScreenApi.fullScreenEventName,this._handleEscKey,context);L.DomEvent.addListener(document,fullScreenApi.fullScreenEventName,L.DomEvent.stopPropagation).addListener(document,fullScreenApi.fullScreenEventName,L.DomEvent.preventDefault).addListener(document,fullScreenApi.fullScreenEventName,this._handleEscKey,context);return link},toogleFullScreen:function(){this._exitFired=false;if(fullScreenApi.supportsFullScreen){var container=document.getElementById("fullScreen");
if(fullScreenApi.isFullScreen(container)){fullScreenApi.cancelFullScreen(container);this.invalidateSize();this.fire("exitFullscreen");this._exitFired=true}else{fullScreenApi.requestFullScreen(container);this.invalidateSize();this.fire("enterFullscreen")}}},_handleEscKey:function(){if(!fullScreenApi.isFullScreen(this)&&!this._exitFired){this.fire("exitFullscreen");this._exitFired=true}}});
L.Map.addInitHook(function(){if(this.options.fullscreenControl){this.fullscreenControl=L.control.fullscreen(this.options.fullscreenControlOptions);this.addControl(this.fullscreenControl)}});L.control.fullscreen=function(options){return new L.Control.FullScreen(options)};
(function(){var fullScreenApi={supportsFullScreen:false,isFullScreen:function(){return false},requestFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",prefix:""},browserPrefixes="webkit moz o ms khtml".split(" ");if(typeof document.exitFullscreen!="undefined")fullScreenApi.supportsFullScreen=true;else for(var i=0,il=browserPrefixes.length;i<il;i++){fullScreenApi.prefix=browserPrefixes[i];if(typeof document[fullScreenApi.prefix+"CancelFullScreen"]!="undefined"){fullScreenApi.supportsFullScreen=
true;break}}if(fullScreenApi.supportsFullScreen){fullScreenApi.fullScreenEventName=fullScreenApi.prefix+"fullscreenchange";fullScreenApi.isFullScreen=function(){switch(this.prefix){case "":return document.fullScreen;case "webkit":return document.webkitIsFullScreen;default:return document[this.prefix+"FullScreen"]}};fullScreenApi.requestFullScreen=function(el){return this.prefix===""?el.requestFullscreen():el[this.prefix+"RequestFullScreen"]()};fullScreenApi.cancelFullScreen=function(el){return this.prefix===
""?document.exitFullscreen():document[this.prefix+"CancelFullScreen"]()}}if(typeof jQuery!="undefined")jQuery.fn.requestFullScreen=function(){return this.each(function(){var el=jQuery(this);if(fullScreenApi.supportsFullScreen)fullScreenApi.requestFullScreen(el)})};window.fullScreenApi=fullScreenApi})();
if(typeof L!=="undefined")L.FullCanvas=L.Class.extend({options:this.options||{},initialize:function(){this._myCanvas=document.createElement("canvas");this._myCanvas.style.position="absolute";this._myCanvas.style.top=0;this._myCanvas.style.left=0;this._myContext=this._myCanvas.getContext("2d");this.options.filterPointsInBounds=true},setData:function(data){var me=this;var bounds=new L.LatLngBounds([-90,-180],[90,180]);this._myQuad=new QuadTree(this.boundsToQuery(bounds),false,10,10);data.forEach(function(d){me._myQuad.insert({x:d.slat,
y:d.slon,data:d});if(d.ty&&d.tx)me._myQuad.insert({x:d.tlat,y:d.tlon,data:d})})},clickedPoints:function(points,e){},addLayerTo:function(map){map.addLayer(this);return this},addTo:function(map){this.addLayerTo(map);return this},getCanvas:function(){return this._myCanvas},getOptions:function(){return this.options},addData:function(d){this._myQuad.insert({x:d.slat,y:d.slon,data:d});if(d.ty&&d.tx)this._myQuad.insert({x:d.tlat,y:d.tlon,data:d});this.drawCanvas()},boundsToQuery:function(bounds){return{x:bounds.getSouthWest().lat,
y:bounds.getSouthWest().lng,width:bounds.getNorthEast().lat-bounds.getSouthWest().lat,height:bounds.getNorthEast().lng-bounds.getSouthWest().lng}},drawSource:function(point){var ctx=this.getCanvas().getContext("2d");ctx.beginPath();ctx.arc(point.x,point.y,2,0,2*Math.PI,true);ctx.fillStyle="rgba(255,0,0, 0.5)";ctx.fill()},drawTarget:function(point){var ctx=this.getCanvas().getContext("2d");ctx.beginPath();ctx.arc(point.x,point.y,2,0,2*Math.PI,true);ctx.fillStyle="rgba(0,255,0, 0.5)";ctx.fill()},drawCurve:function(startPoint,
endPoint,style){var context=this.getCanvas().getContext("2d");context.strokeStyle=style&&style.strokeStyle?style.strokeStyle:"rgba(0,0,255, 1)";context.lineWidth=style&&style.lineWidth?style.lineWidth:1;var x=(startPoint.x+endPoint.x)/2;var y=(startPoint.y+endPoint.y)/2;var le=(endPoint.y-endPoint.y)/(startPoint.x-endPoint.x);var angle=Math.atan(le);var sx=Math.pow(startPoint.x-endPoint.x,2);var sy=Math.pow(endPoint.y-endPoint.y,2);var d=Math.sqrt(sx+sy)/2;var px=x-d*Math.sin(angle);var py=y+d*Math.cos(angle);
context.moveTo(startPoint.x,startPoint.y);context.quadraticCurveTo(px,py,endPoint.x,endPoint.y);context.stroke()}});
(function(window){function QuadTree(bounds,pointQuad,maxDepth,maxChildren){var node;if(pointQuad)node=new Node(bounds,0,maxDepth,maxChildren);else node=new BoundsNode(bounds,0,maxDepth,maxChildren);this.root=node}QuadTree.prototype.root=null;QuadTree.prototype.insert=function(item){if(item instanceof Array){var len=item.length;for(var i=0;i<len;i++)this.root.insert(item[i])}else this.root.insert(item)};QuadTree.prototype.clear=function(){this.root.clear()};QuadTree.prototype.retrieve=function(item){var out=
this.root.retrieve(item).slice(0);return out};QuadTree.prototype.retrieveInBounds=function(bounds){var treeResult=this.root.retrieveInBounds(bounds);return QuadTree._filterResults(treeResult,bounds)};QuadTree._filterResults=function(treeResult,bounds){var filteredResult=[];if(this.root instanceof BoundsNode)for(var i=0;i<treeResult.length;i++){var node=treeResult[i];if(QuadTree._isBoundOverlappingBound(node,bounds))filteredResult.push(node)}else treeResult.forEach(function(node){if(QuadTree._isPointInsideBounds(node,
bounds))filteredResult.push(node)});return filteredResult};QuadTree._isPointInsideBounds=function(point,bounds){return point.x>=bounds.x&&point.x<=bounds.x+bounds.width&&point.y>=bounds.y&&point.y<=bounds.y+bounds.height};QuadTree._isBoundOverlappingBound=function(b1,b2){return!(b1.x>b2.x+b2.width||b2.x>b1.x+b1.width||b1.y>b2.y+b2.height||b2.y>b1.y+b1.height)};function Node(bounds,depth,maxDepth,maxChildren){this._bounds=bounds;this.children=[];this.nodes=[];if(maxChildren)this._maxChildren=maxChildren;
if(maxDepth)this._maxDepth=maxDepth;if(depth)this._depth=depth}Node.prototype.nodes=null;Node.prototype._classConstructor=Node;Node.prototype.children=null;Node.prototype._bounds=null;Node.prototype._depth=0;Node.prototype._maxChildren=4;Node.prototype._maxDepth=4;Node.TOP_LEFT=0;Node.TOP_RIGHT=1;Node.BOTTOM_LEFT=2;Node.BOTTOM_RIGHT=3;Node.prototype.insert=function(item){if(this.nodes.length){var index=this._findIndex(item);this.nodes[index].insert(item);return}this.children.push(item);var len=this.children.length;
if(!(this._depth>=this._maxDepth)&&len>this._maxChildren){this.subdivide();for(var i=0;i<len;i++)this.insert(this.children[i]);this.children.length=0}};Node.prototype.retrieve=function(item){if(this.nodes.length){var index=this._findIndex(item);return this.nodes[index].retrieve(item)}return this.children};Node.prototype.retrieveInBounds=function(bounds){var result=[];if(this.collidesWith(bounds)){result=result.concat(this._stuckChildren);if(this.children.length)result=result.concat(this.children);
else if(this.nodes.length)for(var i=0;i<this.nodes.length;i++)result=result.concat(this.nodes[i].retrieveInBounds(bounds))}return result};Node.prototype.collidesWith=function(bounds){var b1=this._bounds;var b2=bounds;return!(b1.x>b2.x+b2.width||b2.x>b1.x+b1.width||b1.y>b2.y+b2.height||b2.y>b1.y+b1.height)};Node.prototype._findIndex=function(item){var b=this._bounds;var left=item.x>b.x+b.width/2?false:true;var top=item.y>b.y+b.height/2?false:true;var index=Node.TOP_LEFT;if(left){if(!top)index=Node.BOTTOM_LEFT}else if(top)index=
Node.TOP_RIGHT;else index=Node.BOTTOM_RIGHT;return index};Node.prototype.subdivide=function(){var depth=this._depth+1;var bx=this._bounds.x;var by=this._bounds.y;var b_w_h=this._bounds.width/2|0;var b_h_h=this._bounds.height/2|0;var bx_b_w_h=bx+b_w_h;var by_b_h_h=by+b_h_h;this.nodes[Node.TOP_LEFT]=new this._classConstructor({x:bx,y:by,width:b_w_h,height:b_h_h},depth,this._maxDepth,this._maxChildren);this.nodes[Node.TOP_RIGHT]=new this._classConstructor({x:bx_b_w_h,y:by,width:b_w_h,height:b_h_h},depth,
this._maxDepth,this._maxChildren);this.nodes[Node.BOTTOM_LEFT]=new this._classConstructor({x:bx,y:by_b_h_h,width:b_w_h,height:b_h_h},depth,this._maxDepth,this._maxChildren);this.nodes[Node.BOTTOM_RIGHT]=new this._classConstructor({x:bx_b_w_h,y:by_b_h_h,width:b_w_h,height:b_h_h},depth,this._maxDepth,this._maxChildren)};Node.prototype.clear=function(){this.children.length=0;var len=this.nodes.length;for(var i=0;i<len;i++)this.nodes[i].clear();this.nodes.length=0};function BoundsNode(bounds,depth,maxChildren,
maxDepth){Node.call(this,bounds,depth,maxChildren,maxDepth);this._stuckChildren=[]}BoundsNode.prototype=new Node;BoundsNode.prototype._classConstructor=BoundsNode;BoundsNode.prototype._stuckChildren=null;BoundsNode.prototype._out=[];BoundsNode.prototype.insert=function(item){if(this.nodes.length){var index=this._findIndex(item);var node=this.nodes[index];if(item.x>=node._bounds.x&&item.x+item.width<=node._bounds.x+node._bounds.width&&item.y>=node._bounds.y&&item.y+item.height<=node._bounds.y+node._bounds.height)this.nodes[index].insert(item);
else this._stuckChildren.push(item);return}this.children.push(item);var len=this.children.length;if(this._depth<this._maxDepth&&len>this._maxChildren){this.subdivide();for(var i=0;i<len;i++)this.insert(this.children[i]);this.children.length=0}};BoundsNode.prototype.getChildren=function(){return this.children.concat(this._stuckChildren)};BoundsNode.prototype.retrieve=function(item){var out=this._out;out.length=0;if(this.nodes.length){var index=this._findIndex(item);out.push.apply(out,this.nodes[index].retrieve(item))}out.push.apply(out,
this._stuckChildren);out.push.apply(out,this.children);return out};BoundsNode.prototype.clear=function(){this._stuckChildren.length=0;this.children.length=0;var len=this.nodes.length;if(!len)return;for(var i=0;i<len;i++)this.nodes[i].clear();this.nodes.length=0};window.QuadTree=QuadTree})(this);"use strict";
L.SimOverlay=L.FullCanvas.extend({options:{opacity:0.9},map:{x:NaN,y:NaN,size:NaN},sizes:{"0":512,1:1024,2:2048,3:4096,4:8192},initialize:function(layer,isoh,options){this._layer=layer;this._myCanvas=document.createElement("canvas");this._myCanvas.style.position="absolute";this._myCanvas.style.top=0;this._myCanvas.style.left=0;this._myContext=this._myCanvas.getContext("2d");$(this._myCanvas).attr("GFS",true);console.log("SimOverlay.initialize")},updateTime:function(stamp){},canvasReset:function(){var size=
this._myMap.getSize();this._myCanvas.width=size.x;this._myCanvas.height=size.y;this.drawCanvas()},onRemove:function(map){map._panes.staticPane.removeChild(this._myCanvas);map.off("viewreset",this.canvasReset,this);map.off("move",this.canvasReset,this);map.off("resize",this.canvasReset,this);map.off("click",this.handleClick,this);console.log("SimOverlay.onRemove")},onAdd:function(map){this._myMap=map;if(!map._panes.staticPane)map._panes.staticPane=map._createPane("leaflet-tile-pane",map._container);
this._staticPane=map._panes.staticPane;this._staticPane.appendChild(this._myCanvas);map.on("viewreset",this.canvasReset,this);map.on("move",this.canvasReset,this);map.on("resize",this.canvasReset,this);map.on("click",this.handleClick,this);this.canvasReset();console.log("SimOverlay.onAdd")},handleClick:function(e){var j=e.containerPoint;var bounds=L.latLngBounds(this._myMap.containerPointToLatLng(j.add(L.point(3,3))),this._myMap.containerPointToLatLng(j.subtract(L.point(3,3))));console.log("SimOverlay.click",
j,bounds)},calcMap:function(){var m=this._myMap;var bounds=m.getPixelBounds();this.map.size=this.sizes[m.getZoom()];this.map.x=-bounds.min.x;this.map.y=-bounds.min.y},drawCanvas:function(){this.calcMap();var canvas=this.getCanvas();var ctx=canvas.getContext("2d");if(!this._myMap)return;ctx.clearRect(0,0,canvas.width,canvas.height);ctx.fillStyle="rgba(40, 0, 0, 0.2)";ctx.fillRect(0,0,canvas.width,canvas.height);ctx.strokeStyle="rgba(40, 0, 0, 0.8)";ctx.strokeRect(64,64,canvas.width-128,canvas.height-
128);ctx.fillStyle="rgba(255, 255, 0, 0.3)";ctx.fillRect(this.map.x,this.map.y,this.map.size,this.map.size);console.log("drawCanvas",this.map.x,this.map.y,this.map.size)},drawSource:function(point){var ctx=this._layer.getCanvas().getContext("2d");ctx.globalCompositeOperation="lighter";ctx.beginPath();var grd=ctx.createRadialGradient(point.x,point.y,0,point.x,point.y,10);grd.addColorStop(0.2,"rgba(255, 242, 0, 1)");grd.addColorStop(0.37,"rgba(255, 157, 0, 1)");grd.addColorStop(0.5,"rgba(255,255, 255, 1)");
ctx.fillStyle=grd;ctx.arc(point.x,point.y,2,0,2*Math.PI,true);ctx.fill()},redraw:function(){this.drawCanvas()}});L.simOverlay=function(url,bounds,options){return new L.SimOverlay(url,bounds,options)};
L.Map=L.Map.extend({sync:function(map){var originalMap=this;this._syncMaps=this._syncMaps||[];function onZoomEnd(){originalMap._syncMaps.forEach(function(toSync){toSync.setView(originalMap.getCenter(),originalMap.getZoom(),{reset:false},true)})}function dragUpdate(){L.Draggable.prototype._updatePosition.call(this);var self=this;originalMap._syncMaps.forEach(function(toSync){L.DomUtil.setPosition(toSync.dragging._draggable._element,self._newPos);toSync.fire("move")})}if(!map){this._syncMaps=[];originalMap.off("zoomend",
onZoomEnd)}else{this._syncMaps.push(L.extend(map,{setView:function(center,zoom,options,sync){if(!sync)this._syncMaps.forEach(function(toSync){toSync.setView(center,zoom,options,true)});return L.Map.prototype.setView.call(this,center,zoom,options)},panBy:function(offset,options,sync){if(!sync)this._syncMaps.forEach(function(toSync){toSync.panBy(offset,options,true)});return L.Map.prototype.panBy.call(this,offset,options)},_onResize:function(evt,sync){if(!sync)this._syncMaps.forEach(function(toSync){toSync._onResize(evt,
true)});return L.Map.prototype._onResize.call(this,evt)}}));originalMap.on("zoomend",onZoomEnd,this);originalMap.dragging._draggable._updatePosition=dragUpdate}return originalMap}});
L.Google=L.Class.extend({includes:L.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",opacity:1,continuousWorld:false,noWrap:false},initialize:function(type,options){L.Util.setOptions(this,options);this._ready=google.maps.Map!=undefined;if(!this._ready)L.Google.asyncWait.push(this);this._type=type||"SATELLITE"},onAdd:function(map,insertAtTheBottom){this._map=map;this._insertAtTheBottom=insertAtTheBottom;this._initContainer();this._initMapObject();
map.on("viewreset",this._resetCallback,this);this._limitedUpdate=L.Util.limitExecByInterval(this._update,150,this);map.on("move",this._update,this);map.on("zoomanim",function(e){var center=e.center;var _center=new google.maps.LatLng(center.lat,center.lng);this._google.setCenter(_center);this._google.setZoom(e.zoom)},this);map.on("unload",this._onUnload,this);map._controlCorners["bottomright"].style.marginBottom="1em";this._reset();this._update()},_onUnload:function(){this.onRemove(this._map)},onRemove:function(map){console.log("remove google maps");
try{this._map._container.removeChild(this._container);this._map.off("viewreset",this._resetCallback,this);this._map.off("move",this._update,this);map._controlCorners["bottomright"].style.marginBottom="0em";this._map.off("moveend",this._update);this._map.off("unload",this._onUnload)}catch(e){console.log("goo.onRemove",e.toString())}},getAttribution:function(){return this.options.attribution},setOpacity:function(opacity){this.options.opacity=opacity;if(opacity<1)L.DomUtil.setOpacity(this._container,
opacity)},setElementSize:function(e,size){e.style.width=size.x+"px";e.style.height=size.y+"px"},_initContainer:function(){var tilePane=this._map._container,first=tilePane.firstChild;if(!this._container){this._container=L.DomUtil.create("div","leaflet-google-layer leaflet-top leaflet-left");this._container.id="_GMapContainer_"+L.Util.stamp(this);this._container.style.zIndex="auto"}if(true){tilePane.insertBefore(this._container,first);this.setOpacity(this.options.opacity);this.setElementSize(this._container,
this._map.getSize())}},_initMapObject:function(){if(!this._ready)return;this._google_center=new google.maps.LatLng(0,0);var map=new google.maps.Map(this._container,{center:this._google_center,zoom:0,tilt:0,mapTypeId:google.maps.MapTypeId[this._type],disableDefaultUI:true,keyboardShortcuts:false,draggable:false,disableDoubleClickZoom:true,scrollwheel:false,streetViewControl:false});var _this=this;this._reposition=google.maps.event.addListenerOnce(map,"center_changed",function(){_this.onReposition()});
map.backgroundColor="transparent";this._google=map},_resetCallback:function(e){this._reset(e.hard)},_reset:function(clearOldContainer){this._initContainer()},_update:function(e){if(!this._google)return;this._resize();var center=e&&e.latlng?e.latlng:this._map.getCenter();var _center=new google.maps.LatLng(center.lat,center.lng);this._google.setCenter(_center);this._google.setZoom(this._map.getZoom());if(!MAPS.ignore.events){MAPS.status.lng=center.lng;MAPS.status.lat=center.lat;MAPS.updatePerma()}},
_resize:function(){var size=this._map.getSize();if(this._container.style.width==size.x&&this._container.style.height==size.y)return;this.setElementSize(this._container,size);this.onReposition()},onReposition:function(){if(!this._google)return;google.maps.event.trigger(this._google,"resize")}});L.Google.asyncWait=[];
L.Google.asyncInitialize=function(){var i;for(i=0;i<L.Google.asyncWait.length;i++){var o=L.Google.asyncWait[i];o._ready=true;if(o._container){o._initMapObject();o._update()}}L.Google.asyncWait=[]};var VERSION="1.02/noiv/20-Apr-2016";function utc(a){return new UTC(a)}
function UTC(){var args=Array.prototype.slice.call(arguments,0);if(args.length===1&&typeof args[0]==="string")this.date=this.fromIso(args[0]).toDate();else if(args.length===1&&typeof args[0]==="number")this.date=new Date(args[0]);else if(args.length===1&&typeof args[0]==="object"&&args[0].getTime)this.date=args[0];else if(args.length===1&&args[0]instanceof Array)this.date=new Date((new UTC).fromArray(args[0]).time());else if(args.length===1&&args[0]instanceof UTC)this.date=new Date(args[0].time());
else this.date=new Date}
UTC.prototype={levels:["decade","year","month","day","hour","min","sec"],monthShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],monthLong:["January","February","March","April","May","June","July","August","September","October","November","December"],weekdayShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],weekdayLong:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],year:function(){return this.date.getUTCFullYear()},month:function(){return this.date.getUTCMonth()},day:function(){return this.date.getUTCDate()},
hour:function(){return this.date.getUTCHours()},mins:function(){return this.date.getUTCMinutes()},secs:function(){return this.date.getUTCSeconds()},msecs:function(){return this.date.getUTCMilliseconds()},time:function(){return this.date.getTime()},toString:function(){return this.date.toJSON().toString()},toDate:function(){return this.date},toIso:function(res){return this.toArray().map(function(item){return(item+"").length<2?H.padZero(item):item+""}).slice(0,res||3).join("-")},toArray:function(){return[this.date.getUTCFullYear(),
this.date.getUTCMonth()+1,this.date.getUTCDate(),this.date.getUTCHours(),this.date.getUTCMinutes(),this.date.getUTCSeconds(),this.date.getUTCMilliseconds()]},fromArray:function(a){var d=new Date(0);if(a.length>0)d.setUTCFullYear(a[0]);if(a.length>1)d.setUTCMonth(a[1]-1);if(a.length>2)d.setUTCDate(a[2]);if(a.length>3)d.setUTCHours(a[3]);if(a.length>4)d.setUTCMinutes(a[4]);if(a.length>5)d.setUTCSeconds(a[5]);if(a.length>6)d.setUTCMilliseconds(a[6]);return new UTC(d)},setZone:function(){this.date.setUTCMinutes(this.date.getUTCMinutes()-
this.date.getTimezoneOffset());return this},align:function(what,num){var arr=this.toArray();switch(what){case "hours":arr[3]=arr[3]%24-arr[3]%num;return(new UTC).fromArray(arr);break}},delta:function(what,amount){var msecs=this.date.getTime(),arr=this.toArray(),secs=1E3,mins=60*secs,hours=60*mins;switch(what||"days"){case "years":arr[0]+=amount;return(new UTC).fromArray(arr);break;case "months":arr[1]+=amount;return(new UTC).fromArray(arr);break;case "days":arr[2]+=amount;return(new UTC).fromArray(arr);
break;case "hours":return utc(new Date(msecs+amount*hours));break;case "mins":return utc(new Date(msecs+amount*mins));break;case "secs":return utc(new Date(msecs+amount*secs));break;case "msecs":return utc(new Date(msecs+amount));break;default:throw new Error("Not defined in utc.delta: "+what);}},neighbours:function(what,amount,factor){var i,accu=[];factor=factor||1;for(i=-amount;i<amount+1;i++)accu.push(utc(this.date).delta(what,i*factor));return accu},fromIso:function(iso,len){var date,arr=iso.split("-"),
Y=0,m=0,h=0,M=0,s=0,ms=0,d=1;len=len||3;if(arr.length>0)Y=parseInt(arr[0],10);if(arr.length>1)m=parseInt(arr[1],10)-1;if(arr.length>2)d=parseInt(arr[2],10);if(arr.length>3)h=parseInt(arr[3],10);if(arr.length>4)M=parseInt(arr[4],10);if(arr.length>5)s=parseInt(arr[5],10);if(arr.length>6)ms=parseInt(arr[6],10);date=new Date(Y,m,d,h,M,s,ms);date.setUTCMinutes(date.getUTCMinutes()-date.getTimezoneOffset());return new UTC(date)},centerIn:function(level){var t1=this.lowerIn(level).time(),t2=this.upperIn(level).time();
return new UTC(new Date(t1+(t2-t1)/2+1))},lowerIn:function(level){var d=this.date,date;if(level==="year")date=new Date(d.getUTCFullYear(),0,1,0,0,0,0);else if(level==="month")date=new Date(d.getUTCFullYear(),d.getUTCMonth(),1,0,0,0,0);else if(level==="day")date=new Date(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate(),0,0,0,0);else if(level==="hour")date=new Date(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate(),d.getUTCHours(),0,0,0);else if(level==="min")date=new Date(d.getUTCFullYear(),d.getUTCMonth(),
d.getUTCDate(),d.getUTCHours(),d.getUTCMinutes(),0,0);else if(level==="sec")date=new Date(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate(),d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),0);return(new UTC(date)).setZone()},upperIn:function(level){var d=this.date,date;if(level==="year")date=new Date(d.getUTCFullYear()+1,0,0,23,59,59,999);else if(level==="month")date=new Date(d.getUTCFullYear(),d.getUTCMonth()+1,0,23,59,59,999);else if(level==="day")date=new Date(d.getUTCFullYear(),d.getUTCMonth(),
d.getUTCDate(),23,59,59,999);else if(level==="hour")date=new Date(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate(),d.getUTCHours(),59,59,999);else if(level==="min")date=new Date(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate(),d.getUTCHours(),d.getUTCMinutes(),59,999);else if(level==="sec")date=new Date(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate(),d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),999);return(new UTC(date)).setZone()},format:function(pattern){var d=this.date,tokens={"a":this.weekdayShort[d.getDay()],
"b":this.monthShort[d.getMonth()],"Y":d.getUTCFullYear(),"m":H.padZero(d.getUTCMonth()+1),"d":H.padZero(d.getUTCDate()),"e":d.getUTCDate(),"M":H.padZero(d.getUTCMinutes()),"H":H.padZero(d.getUTCHours())};for(t in tokens)if(tokens.hasOwnProperty(t))pattern=pattern.split("%"+t).join(tokens[t]);return pattern}};function TimeRange(){this.ranges=[];this.className="TimeRange";this.push(Array.prototype.slice.call(arguments,0))}
TimeRange.prototype={levels:["decade","year","month","day","hour","min","sec"],log:function(tail){tail=tail||"";this.ranges.forEach(function(r){})},length:function(){return this.ranges.length},toString:function(trenner){var out="";trenner=trenner||" <> ";this.ranges.forEach(function(r){out+="["+r[0]+trenner+r[1]+"], "});return out?out.substr(0,out.length-2):""},latest:function(){var out="";this.ranges.forEach(function(r){if(r[1]>out)out=r[1]});return out===""?null:out},extend:function(level){var d1,
d2,len={year:1,month:2,day:3,hour:4}[level],tr=new TimeRange;this.ranges.forEach(function(r){d1=utc(r[0]).lowerIn(level).toIso(len);d2=utc(r[1]).upperIn(level).toIso(len);tr.push(d1,d2)});return tr},resolution:function(){var res=0;this.ranges.forEach(function(r){if(r[0].split("-").length>res)res=r[0].split("-").length});return res},push:function(){var self=this,args=Array.prototype.slice.call(arguments,0);if(args.length===2&&typeof args[0]==="string"&&typeof args[1]==="string")this.ranges.push([args[0],
args[1]]);else if(args.length===1&&args[0]instanceof Array&&args[0].length)this.ranges.push(args[0]);else if(args.length===1&&args[0].className&&args[0].className==="TimeRange")args[0].ranges.forEach(function(r){self.ranges.push(r)});return this},_upper:function(iso,len){var l=iso.split("-").length,levels=["year","month","day","hour","min","sec","msec"];if(l<len)return this._upper(utc(iso).upperIn(levels[l-1]).toIso(l+1),len);else return iso},_lower:function(iso,len){var l=iso.split("-").length,levels=
["year","month","day","hour","min"];if(l<len)return this._lower(utc(iso).lowerIn(levels[l-1]).toIso(l+1),len);else return iso},covers:function(stamp){var self=this;return this.ranges.some(function(r){function lev(iso){return self.levels[iso.split("-").length]}var t1=utc(r[0]).lowerIn(lev(r[0])).toIso(7);var t2=utc(r[1]).upperIn(lev(r[1])).toIso(7);return(new TimeRange(t1,t2)).contains("milli",stamp)})},contains:function(level,something){var tr,self=this,msecs=utc(something).time(),test=utc(something).centerIn(level).toDate(),
len={year:1,month:2,day:3,hour:4}[level];switch(level){case "year":case "month":case "day":case "hour":case "min":case "sec":result=this.ranges.some(function(r){var t1=utc(self._lower(r[0],len)).lowerIn(level).toIso(7);var t2=utc(self._upper(r[1],len)).upperIn(level).toIso(7);return(new TimeRange(t1,t2)).contains("milli",test)});break;case "milli":result=this.ranges.some(function(r){var m1=utc(r[0]).time();var m2=utc(r[1]).time();return msecs>=m1&&msecs<=m2});break}return result}};
L.TileLayer.Sentinel=L.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:false},initialize:function(url,options){this._url=url;var wmsParams=L.extend({},this.defaultWmsParams),tileSize=options.tileSize||this.options.tileSize;if(options.detectRetina&&L.Browser.retina)wmsParams.width=wmsParams.height=tileSize*2;else wmsParams.width=wmsParams.height=tileSize;for(var i in options)if(!this.options.hasOwnProperty(i)&&i!==
"crs")wmsParams[i]=options[i];if(options.buildDate)this.buildDate=options.buildDate;this.wmsParams=wmsParams;delete this.wmsParams.zoomdomains;delete this.wmsParams.transpic;delete this.wmsParams.continuousWorld;delete this.wmsParams.noWrap;delete this.wmsParams.buildDate;L.setOptions(this,options)},onAdd:function(map){this._crs=this.options.crs||map.options.crs;var projectionKey=parseFloat(this.wmsParams.version)>=1.3?"crs":"srs";this.wmsParams[projectionKey]=this._crs.code;L.TileLayer.prototype.onAdd.call(this,
map)},buildDate:function(day){return"&TIME="+day+"/"+day},getTileUrl:function(tilePoint,zoom){var url,map=this._map,tileSize=this.options.tileSize,nwPoint=tilePoint.multiplyBy(tileSize),sePoint=nwPoint.add([tileSize,tileSize]),nw=this._crs.project(map.unproject(nwPoint,zoom)),se=this._crs.project(map.unproject(sePoint,zoom)),toZoom=zoom===undefined?map._zoom:zoom,bbox=[nw.x,se.y,se.x,nw.y].join(","),day=this.options.side==="left"?MAPS.status.day2:MAPS.status.day1,url=L.Util.template(this._url,{s:this._getSubdomain(tilePoint)});
if(this.options.timeRange)if(!this.options.timeRange.covers(utc(day)))return this.options.transpic;return url+L.Util.getParamString(this.wmsParams,url,true)+"&BBOX="+bbox+this.buildDate(day)},setParams:function(params,noRedraw){L.extend(this.wmsParams,params);if(!noRedraw)this.redraw();return this}});L.tileLayer.sentinel=function(url,options){return new L.TileLayer.Sentinel(url,options)};L.Proj.TileLayer={};
L.Proj.TileLayer.TMS=L.TileLayer.extend({options:{tms:true,continuousWorld:true,date:L.Util.falseFn},initialize:function(urlTemplate,crs,options){L.setOptions(this,options);this._url=urlTemplate;this.key=this.options.key;this.crs=crs},getTileUrl:function(tilePoint){var z=this._getZoomForUrl(),off=this.crs.options.zoomInfo.off,min=this.crs.options.zoomInfo.min,gridHeight=Math.ceil((this.crs.projectedBounds[3]-this.crs.projectedBounds[1])/this._projectedTileSize(z-this.options.zoomOffset||0)),day=this.options.side===
"left"?MAPS.status.day2:MAPS.status.day1,url;if(tilePoint.y<0||tilePoint.x<0)return this.options.transpic;if(this.options.noBlack)if(tilePoint.x>=gridHeight||tilePoint.y>=gridHeight)return this.options.transpic;if(this.options.timeRange)if(!this.options.timeRange.covers(utc(day)))return this.options.transpic;url=L.Util.template(this._url,L.Util.extend({d:this.options.date,s:this._getSubdomain(tilePoint),z:z+off,x:tilePoint.x,y:tilePoint.y},this.options));return url},_projectedTileSize:function(zoom){return this.options.tileSize/
this.crs.scale(zoom)}});
L.TimeOverlay=L.ImageOverlay.extend({options:{opacity:0.9},initialize:function(layer,isoh,options){this._layer=layer;this._key=layer.key;this._bounds=L.latLngBounds(layer.bounds);this._mybounds=layer.bounds;this.updateTime(isoh);this.options.opacity=layer.opacity},onAdd:function(map){this._map=map;if(!this._image){this._initImage();this._image.onerror=L.bind(function(e){this._map.fire("dataload");this._image.src=MAPS.notavail},this);this._image.onload=L.bind(function(e){this._map.fire("dataload")},this)}map._panes.overlayPane.appendChild(this._image);
map.on("viewreset",this._reset,this);if(map.options.zoomAnimation&&L.Browser.any3d)map.on("zoomanim",this._animateZoom,this);this._reset()},updateTime:function(stamp){var tr=this._layer.timeRange;this._timeStamp=stamp;if(tr.covers(stamp))this._url=stamp.format(this._layer.urlPattern);else{this._url=MAPS.transpic;DEBUG&&console.log("updateTime.not.covered",this._layer.key,this._timeStamp.toIso(4),this._layer.timeRange.toString())}if(this._image){this._map.fire("dataloading");this._image.src=this._url;
if(this._image.complete||this._image.readyState===4)this._map.fire("dataload")}}});L.timeOverlay=function(url,bounds,options){return new L.TimeOverlay(url,bounds,options)};
L.MarkerOverlay=L.LayerGroup.extend({options:{},initialize:function(dataLayer,options){var name,item,label,style=dataLayer.style;L.setOptions(this,options);this._layers={};for(name in dataLayer.data){item=dataLayer.data[name];label=L.marker(item.coords,{icon:new L.Label({className:style+item.style,html:name}),clickable:false,minzoom:item.lvl,riseOnHover:true});this._layers[name]=label}},updateTime:L.Util.falseFn,onAdd:function(map){var label;this._map=map;this._updateZoom();map.on("zoomend zoomlevelschange",
this._updateZoom,this);return this},onRemove:function(map){var label;this._map=map;for(label in this._layers)this.removeLayer(this._layers[label]);map.off("zoomend zoomlevelschange",this._updateZoom,this)},_updateZoom:function(){var lbl,name,zoom=MAPS.status.zoom;for(name in this._layers){lbl=this._layers[name];if(this.hasLayer(lbl)){if(lbl.options.minzoom>MAPS.status.zoom)this.removeLayer(lbl)}else if(lbl.options.minzoom<=MAPS.status.zoom)this.addLayer(lbl)}}});
L.Control.Calendar=L.Control.extend({options:{position:"topcenter",title:"Date Picker",collapsed:true,timeRange:new TimeRange},initialize:function(stamp,options){L.setOptions(this,options);this._stamp=stamp},onAdd:function(map){var className=this._className="leaflet-control-calendar",side=this.side=map.options.side.toLowerCase(),container=this._container=L.DomUtil.create("div",className),link=this._link=L.DomUtil.create("a",className+"-toggle",container),contCal=this._contCal=L.DomUtil.create("div",
className+"-container",container);this._map=map;container.setAttribute("aria-haspopup",true);link.href="#";link.title="Layers";contCal.style.width="160px";this._calendar=jQuery(contCal).calendarPicker({date:this._stamp,parent:this,useWheel:true,years:1,months:2,days:2,hours:2,showDayArrows:true,timeRange:this.options.timeRange,callback:L.bind(this._onCalClick,this)});if(!this.options.collapsed)this._expand();this.activate(true);return container},activate:function(onoff){onoff=onoff||true;var container=
this._container,link=this._link;if(onoff){if(!L.Browser.touch){L.DomEvent.disableClickPropagation(container);L.DomEvent.on(container,"mousewheel",L.DomEvent.stopPropagation)}else L.DomEvent.on(container,"click",L.DomEvent.stopPropagation);if(!L.Browser.android)L.DomEvent.on(container,"mouseover",this._expand,this).on(container,"mouseout",this._collapse,this);if(L.Browser.touch)L.DomEvent.on(link,"click",L.DomEvent.stop).on(link,"click",this._expand,this);else L.DomEvent.on(this._link,"focus",this._expand,
this);this._map.on("click",this._collapse,this)}},onRemove:function(map){console.log("Cal.onremove...");this.activate(false)},updateDisplay:function(iso){this._link.innerHTML=iso},updateTime:function(stamp){this._calendar.changeDate(stamp)},updateRange:function(range,stamp){this._calendar.options.timeRange=range;this._calendar.stamp=stamp;this._calendar.changeDate(stamp)},_onCalClick:function(cal,stamp){MAPS.changeTime(this,stamp)},_expand:function(){L.DomUtil.addClass(this._container,this._className+
"-expanded")},_collapse:function(){this._container.className=this._container.className.replace(this._className+"-expanded","")}});L.control.calendar=function(options){return new L.Control.Calendar(options)};L.Map.addInitHook(function(){if(this.options.calendarControl){this.calendarControl=L.control.calendar(this.options.calendarControlOptions);this.addControl(this.calendarControl)}});
L.Control.SimpleLayers=L.Control.extend({options:{collapsed:true,position:"topright",autoZIndex:true},initialize:function(baseLayers,overlays,options){var i;L.setOptions(this,options);this._layers={};this._lastZIndex=0;this._handlingClick=false;for(i in baseLayers)this._addLayer(baseLayers[i],i);for(i in overlays)this._addLayer(overlays[i],i,true)},onAdd:function(map){this._initLayout();this._update();map.on("layeradd",this._onLayerChange,this).on("layerremove",this._onLayerChange,this);return this._container},
onRemove:function(map){map.off("layeradd",this._onLayerChange).off("layerremove",this._onLayerChange)},addBaseLayer:function(layer,name){this._addLayer(layer,name);this._update();return this},addOverlay:function(layer,name){this._addLayer(layer,name,true);this._update();return this},clear:function(){H.each(this._layers,L.bind(function(layer){var id=L.stamp(layer);delete this._layers[id]},this));this._update()},removeLayer:function(layer){var id=L.stamp(layer);delete this._layers[id];this._update();
return this},_initLayout:function(){var className="leaflet-control-layers",container=this._container=L.DomUtil.create("div",className);container.setAttribute("aria-haspopup",true);if(!L.Browser.touch){L.DomEvent.disableClickPropagation(container);L.DomEvent.on(container,"mousewheel",L.DomEvent.stopPropagation)}else L.DomEvent.on(container,"click",L.DomEvent.stopPropagation);var form=this._form=L.DomUtil.create("form",className+"-list");if(this.options.collapsed){if(!L.Browser.android)L.DomEvent.on(container,
"mouseover",this._expand,this).on(container,"mouseout",this._collapse,this);var link=this._layersLink=L.DomUtil.create("a",className+"-toggle",container);link.href="#";link.title="Layers";if(L.Browser.touch)L.DomEvent.on(link,"click",L.DomEvent.stop).on(link,"click",this._expand,this);else L.DomEvent.on(link,"focus",this._expand,this);this._map.on("click",this._collapse,this)}else this._expand();this._baseLayersList=L.DomUtil.create("div",className+"-base",form);this._separator=L.DomUtil.create("div",
className+"-separator",form);this._overlaysList=L.DomUtil.create("div",className+"-overlays",form);container.appendChild(form)},_addLayer:function(layer,name,overlay){var id=L.stamp(layer);this._layers[id]={layer:layer,name:name,overlay:overlay};if(this.options.autoZIndex&&layer.setZIndex){this._lastZIndex++;layer.setZIndex(this._lastZIndex)}},_update:function(){if(!this._container)return;this._baseLayersList.innerHTML="";this._overlaysList.innerHTML="";var baseLayersPresent=false,overlaysPresent=
false,i,obj;for(i in this._layers){obj=this._layers[i];this._addItem(obj);overlaysPresent=overlaysPresent||obj.overlay;baseLayersPresent=baseLayersPresent||!obj.overlay}this._separator.style.display=overlaysPresent&&baseLayersPresent?"":"none"},_onLayerChange:function(e){var obj=this._layers[L.stamp(e.layer)];if(!obj)return;if(!this._handlingClick)this._update();var type=obj.overlay?e.type==="layeradd"?"overlayadd":"overlayremove":e.type==="layeradd"?"baselayerchange":null;if(type)this._map.fire(type,
obj)},_createRadioElement:function(name,checked){var radioHtml='<input type="radio" class="leaflet-control-layers-selector" name="'+name+'"';if(checked)radioHtml+=' checked="checked"';radioHtml+="/>";var radioFragment=document.createElement("div");radioFragment.innerHTML=radioHtml;return radioFragment.firstChild},_addItem:function(obj){var label=document.createElement("label"),input,checked=this._map.hasLayer(obj.layer);if(obj.overlay){input=document.createElement("input");input.type="checkbox";input.className=
"leaflet-control-layers-selector";input.defaultChecked=checked}else input=this._createRadioElement("leaflet-base-layers",checked);input.layerId=L.stamp(obj.layer);L.DomEvent.on(input,"click",this._onInputClick,this);var name=document.createElement("span");name.innerHTML=" "+obj.name;label.appendChild(input);label.appendChild(name);var container=obj.overlay?this._overlaysList:this._baseLayersList;container.appendChild(label);return label},_onInputClick:function(){var i,input,obj,inputs=this._form.getElementsByTagName("input"),
inputsLen=inputs.length;this._handlingClick=true;for(i=0;i<inputsLen;i++){input=inputs[i];obj=this._layers[input.layerId];if(input.checked&&!this._map.hasLayer(obj.layer))MAPS.changeBase(this._map,obj.layer.options.key)}this._handlingClick=false},_expand:function(){L.DomUtil.addClass(this._container,"leaflet-control-layers-expanded")},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-layers-expanded","")}});
L.control.simplelayers=function(baseLayers,overlays,options){return new L.Control.SimpleLayers(baseLayers,overlays,options)};
L.Control.PrettyLayers=L.Control.Layers.extend({options:{collapsed:true,position:"topright",autoZIndex:true},initialize:function(activeLayer,options){L.setOptions(this,options);this._layers=Layers.filter(function(l){return l.type==="base"});this._activeLayer=activeLayer;this._lastZIndex=0;this._handlingClick=false;this._overlays={}},onAdd:function(map){this._map=map;this._initLayout();map.on("resize",this._onresize,this);return this._container},onRemove:function(map){map.off("resize",this._onresize)},
_onresize:function(e){var d=MAPS.isSplitScreen()?4:2,w=Math.min($(window).width()/d-66,256),h=$(window).height()*0.8;this._list.style.width="256px";this._list.style.height=Math.min($(window).height()-70,this._height||3E3)+"px"},_expand:function(){L.DomUtil.addClass(this._container,"leaflet-control-layers-expanded");var height=0,heights;heights=$("div.leaflet-control-layers-list").children().map(function(i,el){return $(el).height()});heights.each(function(e,t){height+=t});this._height=height;this._list.style.height=
Math.min($(window).height()-70,this._height)+"px"},_collapse:function(){L.DomUtil.removeClass(this._container,"leaflet-control-layers-expanded")},_initLayout:function(){var className="leaflet-control-layers",container=this._container=L.DomUtil.create("div",className),list=this._list=L.DomUtil.create("div",className+"-list",container);container.setAttribute("aria-haspopup",true);list.style.overflowY="scroll";this._onresize();if(!L.Browser.touch){L.DomEvent.disableClickPropagation(container);L.DomEvent.on(container,
"mousewheel",L.DomEvent.stopPropagation)}else L.DomEvent.on(container,"click",L.DomEvent.stopPropagation);if(this.options.collapsed){if(!L.Browser.android)L.DomEvent.on(container,"mouseover",this._expand,this).on(container,"mouseout",this._collapse,this);var link=this._layersLink=L.DomUtil.create("a",className+"-toggle",container);link.href="#";link.title="Layers";if(L.Browser.touch)L.DomEvent.on(link,"click",L.DomEvent.stop).on(link,"click",this._expand,this);else L.DomEvent.on(link,"focus",this._expand,
this);this._map.on("click",this._collapse,this)}else this._expand()},update:function(){var i,self=this,height=0,heights;$(this._list).children().each(function(i,cont){L.DomEvent.off(cont,"click",self._onInputClick)});this._list.innerHTML="";for(i in this._layers)if(this._layers.hasOwnProperty(i))this._addLayer(this._layers[i].key,"base");return this},_addLayer:function(key,type){var self=this,layer=Layers.byKey(key),aDate,divCont,divTrenner,divTrennerD,imgLayer,divTitle,divComment,divDates;if(!layer.enabled)return;
divCont=L.DomUtil.create("div");divTrenner=L.DomUtil.create("div","aio-prettylayers-trenner");divTrennerD=L.DomUtil.create("div","aio-prettylayers-trenner-dates");imgLayer=L.DomUtil.create("img","aio-prettylayers-"+type+"-img");divTitle=L.DomUtil.create("div","aio-prettylayers-"+type+"-title");divComment=L.DomUtil.create("div","aio-prettylayers-"+type+"-comment");divDates=L.DomUtil.create("div","aio-prettylayers-"+type+"-dates");$(divCont).data("key",key);$(divCont).click(L.bind(this._onInputClick,
this));divTitle.innerHTML=layer.name;$(divTitle).attr("title",layer.comment);divComment.innerHTML=layer.comment;imgLayer.src=layer.icon;imgLayer.width=type==="base"?"48":"32";imgLayer.height=type==="base"?"48":"32";divCont.appendChild(imgLayer);divCont.appendChild(divTitle);divCont.appendChild(divComment);if(layer.colorbar)divCont.appendChild($I("IMG",{src:layer.colorbar,width:180,height:24,className:"aio-prettylayers-"+type+"-cbar"}));if(layer.timeRange&&layer.timeRange.ranges.length>0){divCont.appendChild(divTrennerD);
divCont.appendChild(divDates);layer.timeRange.ranges.forEach(function(r){aDate=L.DomUtil.create("a","aio-prettylayers-"+type+"-date",divDates);aDate.innerHTML=r[0]+" > "+r[1];aDate.href="#";aDate.onclick=function(){return function(e){console.log(utc(r[0]).toString());return H.eat(e)}}()})}divCont.appendChild(divTrenner);divCont.className=key===this._activeLayer||this._overlays[key]?"aio-prettylayers-"+type+"-cont-active":"aio-prettylayers-"+type+"-cont";this._list.appendChild(divCont);if(key===this._activeLayer)if(layer.overlays)layer.overlays.forEach(function(key){self._addLayer(key,
"over")})},updateActiveLayer:function(activeLayer){this._activeLayer=activeLayer;this.update()},_onInputClick:function(e){var key=$(e.currentTarget).data("key"),type=Layers.byKey(key).type;if(type==="base"){this._overlays={};MAPS.changeBase(this._map,key)}else MAPS.changeOverlay(this._map,key,!this._overlays[key])}});
L.Citylayer=L.Class.extend({initialize:function(latlng,options){this._latlng=latlng;L.Util.setOptions(this,options)},onAdd:function(map){this._map=map;this._el=L.DomUtil.create("div","my-custom-layer leaflet-zoom-hide");map.getPanes().overlayPane.appendChild(this._el);map.on("viewreset",this._reset,this);this._reset()},onRemove:function(map){map.getPanes().overlayPane.removeChild(this._el);map.off("viewreset",this._reset,this)},_reset:function(){var pos=this._map.latLngToLayerPoint(this._latlng);
L.DomUtil.setPosition(this._el,pos)}});
L.Label=L.Icon.extend({options:{className:"leaflet-div-icon",html:false},createIcon:function(oldIcon){var div=oldIcon&&oldIcon.tagName==="DIV"?oldIcon:document.createElement("div"),options=this.options;if(options.html!==false)div.innerHTML=options.html;else div.innerHTML="";if(options.bgPos)div.style.backgroundPosition=-options.bgPos.x+"px "+-options.bgPos.y+"px";this._setIconStyles(div,"icon");return div},_setIconStyles:function(img,name){var options=this.options,size=null,anchor;if(name==="shadow")anchor=
L.point(options.shadowAnchor||options.iconAnchor);else anchor=L.point(options.iconAnchor);if(!anchor&&size)anchor=size.divideBy(2,true);img.className="leaflet-marker-"+name+" "+options.className;if(anchor){img.style.marginLeft=-anchor.x+"px";img.style.marginTop=-anchor.y+"px"}if(size){img.style.width=size.x+"px";img.style.height=size.y+"px"}},createShadow:function(){return null}});
L.Control.SplitScreen=L.Control.extend({options:{position:"topleft",title:"Toggle Split-Screen",forceSeparateButton:false},onAdd:function(map){var className="leaflet-control-split-screen",container;container=L.DomUtil.create("div","leaflet-bar");this._createButton(this.options.title,className,container,this.toogleSplitScreen,map);return container},_createButton:function(title,className,container,fn,context){var link=L.DomUtil.create("a",className,container);link.href="#";link.title=title;L.DomEvent.addListener(link,
"click",L.DomEvent.stopPropagation).addListener(link,"click",L.DomEvent.preventDefault).addListener(link,"click",fn,context);return link},toogleSplitScreen:function(){MAPS.changeSplitScreen();this.invalidateSize()}});L.Map.addInitHook(function(){if(this.options.splitscreenControl){this.splitscreenControl=L.control.splitscreen(this.options.splitscreenControlOptions);this.addControl(this.splitscreenControl)}});L.control.splitscreen=function(options){return new L.Control.SplitScreen(options)};
L.Control.SplitCursor=L.Control.extend({options:{position:"topleft",title:"Toggle Mousepointer",forceSeparateButton:false},onRemove:function(map){console.log("Cursor.onRemove")},onAdd:function(map){var self=this,className="leaflet-control-split-cursor",container;this._active=false;this._cursor=jQuery("#cursor");this._oldcss=jQuery(".leaflet-container").css("cursor");container=L.DomUtil.create("div","leaflet-bar");this._createButton(this.options.title,className,container,this.toogleSplitCursor,this);
jQuery(window).mousemove(L.bind(function(e){if(self._active){var half=$(window).width()/2,bord=MAPS.layout.borderCenter;if(e.clientX>half)self._cursor.css({left:e.clientX-half-bord+"px",top:e.clientY-2+"px"});else self._cursor.css({left:e.clientX+half+bord-2+"px",top:e.clientY-2+"px"})}},self));jQuery(window).mouseenter(function(e){self._cursor.css({display:self._active?"block":"none"})});jQuery(window).mouseleave(function(e){self._cursor.css({display:"none"})});return container},deactivate:function(){this._active=
false;this._cursor.css({display:"none"});jQuery(".leaflet-container").css("cursor",this._oldcss)},toogleSplitCursor:function(e){this._active=!this._active;this._cursor.css({display:this._active?"block":"none"});jQuery(".leaflet-container").css("cursor",this._active?"default":this._oldcss);console.log("toogleSplitCursor",this._active)},_createButton:function(title,className,container,fn,context){var link=L.DomUtil.create("a",className,container);link.href="#";link.title=title;L.DomEvent.addListener(link,
"click",L.DomEvent.stopPropagation).addListener(link,"click",L.DomEvent.preventDefault).addListener(link,"click",fn,context);return link}});L.Map.addInitHook(function(){if(this.options.splitcursorControl){this.splitcursorControl=L.control.splitcursor(this.options.splitcursorControlOptions);this.addControl(this.splitcursorControl)}});L.control.splitcursor=function(options){return new L.Control.SplitCursor(options)};
L.Control.Recticle=L.Control.extend({options:{position:"topleft",title:"Toggle Recticle",forceSeparateButton:false},onRemove:function(map){console.log("Cursor.onRemove")},onAdd:function(map){var i,container,lats=[38.8947,47.3079,51.5731,52.6123,51.3818,47.3356];this._coords=[];this._active=false;this._map=map;function glat(i){return[i%6]}for(i=-180;i<180;i+=15)this._coords.push([[85,i],[lats[(i+180)/15%6],i]],[[85,i],[85,i+15]]);container=L.DomUtil.create("div","leaflet-bar");this._createButton(this.options.title,
"leaflet-control-recticle",container,this.toggleRecticle,this);return container},deactivate:function(){this._active=false;this._map.removeLayer(this._polygone)},toggleRecticle:function(e){this._active=!this._active;if(this._active)this._polygone=(new L.MultiPolygon(this._coords,{color:"#ffff00",weight:2.5,dashArray:"3, 9"})).addTo(this._map);else this._map.removeLayer(this._polygone)},_createButton:function(title,className,container,fn,context){var link=L.DomUtil.create("a",className,container);link.href=
"#";link.title=title;L.DomEvent.addListener(link,"click",L.DomEvent.stopPropagation).addListener(link,"click",L.DomEvent.preventDefault).addListener(link,"click",fn,context);return link}});L.Map.addInitHook(function(){if(this.options.recticleControl){this.recticleControl=L.control.recticle(this.options.recticleControlOptions);this.addControl(this.recticleControl)}});L.control.recticle=function(options){return new L.Control.Recticle(options)};
jQuery.fn.calendarPicker=function(options){var $=jQuery,doTitle=true,calendar={currentDate:options.date},theDiv=this.eq(0);if(!options.date)options.date=new Date;if(typeof options.timeRange==="undefined")options.years=1;if(typeof options.years==="undefined")options.years=1;if(typeof options.months==="undefined")options.months=3;if(typeof options.days==="undefined")options.days=4;if(typeof options.hours==="undefined")options.hours=5;if(typeof options.showDayArrows==="undefined")options.showDayArrows=
true;if(typeof options.showHourArrows==="undefined")options.showHourArrows=true;if(typeof options.useWheel==="undefined")options.useWheel=true;if(typeof options.callbackDelay==="undefined")options.callbackDelay=500;if(typeof options.monthNames==="undefined")options.monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];if(typeof options.dayNames==="undefined")options.dayNames=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];calendar.options=options;theDiv.addClass("calBox");
theDiv.empty();var divYears=$("<div>").addClass("calYear");var divMonths=$("<div>").addClass("calMonth");var divDays=$("<div>").addClass("calDay");var divHours=$("<div>").addClass("calHour");function isDateAvailable(checkDate,what){var tr=options.timeRange,res=tr.resolution(),lvl=["decade","year","month","day","hour"].indexOf(what);return tr.ranges.some(function(r){var t=new TimeRange(r[0],r[1]);if(t.resolution()<lvl)return false;return t.contains(what,checkDate,false)})}theDiv.append(divYears).append(divMonths).append(divDays).append(divHours);
calendar.changeDate=function(stamp){var check,tr=calendar.options.timeRange;calendar.stamp=stamp||calendar.stamp;var fillYears=function(stamp){var now=utc(),cal=calendar.stamp,nc=options.years*2+1,w=parseInt((theDiv.width()-4-nc*4)/nc,10)+"px";stamp.neighbours("years",options.years).forEach(function(u){var d=u.toDate(),span=$("<span>").addClass("calElement").attr("millis",u.time()).html(u.format("%Y")).css("width",w);if(doTitle)span.attr("title",u.format("%Y"));if(isDateAvailable(d,"year"))span.addClass("available");
if(now.year()===u.year())span.addClass("today");if(u.year()===cal.year())span.addClass("selected");divYears.append(span)})};var fillMonths=function(stamp){var now=utc(),cal=calendar.stamp,nc=options.months*2+1,w=parseInt((theDiv.width()-4-nc*4)/nc,10)+"px";stamp.neighbours("months",options.months).forEach(function(u){var d=u.toDate(),span=$("<span>").addClass("calElement").attr("millis",u.time()).html(u.format("%b")).css("width",w);if(doTitle)span.attr("title",u.format("%Y-%m"));if(isDateAvailable(d,
"month"))span.addClass("available");if(now.toIso(2)===u.toIso(2))span.addClass("today");if(u.toIso(2)===cal.toIso(2))span.addClass("selected");divMonths.append(span)})};var fillDays=function(stamp){var now=utc(),cal=calendar.stamp,nc=options.days*2+1+2,w=parseInt((theDiv.width()-4-nc*4)/nc,10)+2+"px",pre=$("<span>").addClass("calElement").addClass("prev").attr("millis",cal.delta("days",-5).time()),nxt=$("<span>").addClass("calElement").addClass("next").attr("millis",cal.delta("days",+5).time());if(doTitle)pre.attr("title",
cal.delta("days",-5).format("%Y-%m-%d"));if(doTitle)nxt.attr("title",cal.delta("days",5).format("%Y-%m-%d"));divDays.append(pre);stamp.neighbours("days",options.days).forEach(function(u){var d=u.toDate(),span=$("<span>").addClass("calElement").css("width",w).attr("millis",u.time());if(doTitle)span.attr("title",u.format("%Y-%m-%d"));if(isDateAvailable(d,"day")){span.addClass("available");span.html(u.format("<span class=dayNumber>%e</span><br><span class=dayName>%a</span>"))}else span.html(u.format("%e<br><span class=dayName>%a</span>"));
if(now.toIso(3)===u.toIso(3))span.addClass("today");if(u.toIso(3)===cal.toIso(3))span.addClass("selected");divDays.append(span)});divDays.append(nxt)};var fillHours=function(stamp){var now=utc(),cal=calendar.stamp,nc=options.hours*2+1,w=parseInt((theDiv.width()-4-nc*4)/nc,10)-4+"px";stamp.align("hours",6).neighbours("hours",options.hours,6).forEach(function(u){var d=u.toDate(),span=$("<span>").addClass("calElement").css("width",w).attr("millis",u.time()).html(u.format("%H"));if(doTitle)span.attr("title",
u.format("%Y-%m-%d %Hh"));if(isDateAvailable(d,"hour"))span.addClass("available");if(now.align("hours",6).toIso(4)===u.toIso(4))span.addClass("today");if(u.toIso(4)===cal.toIso(4))span.addClass("selected");divHours.append(span)})};divYears.empty();divMonths.empty();divDays.empty();divHours.empty();fillYears(stamp);if(tr.extend("year").contains("month",stamp))fillMonths(stamp);check=tr.ranges.some(function(r){var t=new TimeRange(r[0],r[1]);return t.resolution()>2&&t.extend("month").contains("day",
stamp)});if(check)fillDays(stamp);check=tr.ranges.some(function(r){var t=new TimeRange(r[0],r[1]);return t.resolution()>3&&t.extend("day").contains("hour",stamp)});if(check)fillHours(stamp)};theDiv.click(function(ev){var stamp,el=$(ev.target).closest(".calElement");if(el.hasClass("calElement")){stamp=utc(parseInt(el.attr("millis"),10));options.callback(calendar,stamp)}});theDiv.dblclick(function(e){e.preventDefault();return false});if(options.useWheel){var direc=function(e){if(!e)e=event;return e.detail<
0||e.wheelDelta>0?1:-1};$(divYears).bind("mousewheel DOMMouseScroll",function(e){var checkDate=calendar.stamp.delta("years",direc(e.originalEvent));if(isDateAvailable(checkDate,"year"))options.callback(calendar,checkDate)});$(divMonths).bind("mousewheel DOMMouseScroll",function(e){var checkDate=calendar.stamp.delta("months",direc(e.originalEvent));if(isDateAvailable(checkDate,"month"))options.callback(calendar,checkDate)});$(divDays).bind("mousewheel DOMMouseScroll",function(e){var checkDate=calendar.stamp.delta("days",
direc(e.originalEvent));if(isDateAvailable(checkDate,"day"))options.callback(calendar,checkDate)});$(divHours).bind("mousewheel DOMMouseScroll",function(e){var checkDate=calendar.stamp.delta("hours",direc(e.originalEvent)*6);if(isDateAvailable(checkDate,"hour"))options.callback(calendar,checkDate)})}return calendar};var Crs,Scripts={},Layers={crs:{},base:[],over:[]},timeRanges={};timeRanges["arc-sentinel"]=new TimeRange("2018-03-01",utc().delta("hours",-48).toIso(3));
timeRanges["arc-gibs"]=new TimeRange("2000-03-01",utc().delta("hours",-4).toIso(3));timeRanges["ant-gibs"]=new TimeRange("2000-03-01",utc().delta("hours",-4).toIso(3));timeRanges["ter-gibs"]=new TimeRange("2000-03-01",utc().delta("hours",-4).toIso(3));["arc-gibs","ant-gibs","ter-gibs"].forEach(function(token){var latest=utc(timeRanges[token].latest()).delta("hours",-8).toIso(3);timeRanges[token].latest=function(){return latest}});timeRanges["sit-cryosat"]=(new TimeRange).push("2011-01","2013-03");
timeRanges["test-m"]=new TimeRange("2013-08","2013-10");timeRanges["test-d"]=new TimeRange("2013-10-28","2013-11-02");timeRanges["test-h"]=new TimeRange("2013-11-02-00","2013-11-04-00");
if(!dataTimeRanges){timeRanges["sic-amsr2"]=(new TimeRange).push("2013-03-01",utc().delta("days",-1).toIso(3));timeRanges["sit-smos"]=(new TimeRange).push("2011-01-01","2011-01-10").push("2012-10-15","2012-10-31").push("2013-02-01","2013-04-15").push("2013-10-13","2013-10-19");timeRanges["gfs-forecast"]=(new TimeRange).push("2013-12-01-00",utc().delta("days",4).toIso(3)+"-18")}else(function(){var name;for(name in dataTimeRanges)if(dataTimeRanges.hasOwnProperty(name)&&name!=="stamp"){if(timeRanges[name]===
undefined)timeRanges[name]=new TimeRange;dataTimeRanges[name].forEach(function(r){timeRanges[name].push(r[0],r[1])})}})();
Crs={3413:function(zoomInfo,key){return new L.Proj.CRS.TMS("EPSG:3413","+proj=stere +lat_0=90 +lat_ts=70 +lon_0=-45 +k=1 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs",[-4194304,-4194304,4194304,4194304],{resolutions:[131072,65536,32768,16384,8192,4096,2048,1024,512,256,128,64,32,16,8,4,2,1],zoomInfo:zoomInfo,key:key,epsg:"3413",domain:"NH"})},3995:function(zoomInfo,key){return new L.Proj.CRS("EPSG:3995","+proj=stere +lat_0=90 +lat_ts=71 +lon_0=0 +k=1 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs",
[-4194304,4194304,4194304,-4194304],{resolutions:[131072,65536,32768,16384,8192,4096,2048,1024,512,256,128,64,32,16,8,4,2,1],zoomInfo:zoomInfo,key:key,epsg:"3995",domain:"NH"})},3031:function(zoomInfo,key){return new L.Proj.CRS.TMS("EPSG:3031","+proj=stere +lat_0=-90 +lat_ts=-71 +lon_0=0 +k=1 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs",[-4194304,-4194304,4194304,4194304],{resolutions:[131072,65536,32768,16384,8192,4096,2048,1024,512,256,128,64,32,16,8,4,2,1],zoomInfo:zoomInfo,key:key,
epsg:"3031",domain:"SH"})},4326:function(zoomInfo,key){return new L.Proj.CRS.TMS("EPSG:4326","+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs",[-180,-90,180,90],{resolutions:[360/(512+128),360/(512+128)/2,360/(512+128)/4,360/(512+128)/8,360/(512+128)/16,360/(512+128)/32,360/(512+128)/64,360/(512+128)/128,360/(512+128)/256],zoomInfo:zoomInfo,key:key,epsg:"3413",domain:"PL"})},3857:function(zoomInfo,key){return L.extend(L.CRS.EPSG3857,{options:{zoomInfo:zoomInfo,key:key,epsg:"3413",domain:"PL"}})}};
Layers={base:[{"goo-sat":{enabled:true,index:1,type:"base",order:100,name:"Google Satellite",icon:"/images/explorer/maps/goo-sat-icon.png",comment:"Google's high resolution satellite map.",epsg:"3857",tms:false,latlngzoom:[34,13,1],zoom:{diff:0,min:0,max:18},getTL:function(key){return new L.Google("SATELLITE",{attribution:"",key:key})}}},{"arc-data":{enabled:true,index:0,type:"base",order:10,epsg:"3413",name:"Arctic - Data",icon:"/images/explorer/maps/arc-mask-icon.png",comment:"Land mask with multiple overlays: forecast, concentration, thickness, pemafrost, etc.",
latlngzoom:[90,0,3],zoom:{min:3,max:6,off:0,diff:0},zoomAlt:{min:4,max:6,off:1,diff:0},overlays:["gfs-forecast","sic-amsr2","sit-smos","sit-cryosat","sst-avhrr","sit-piomas","gfs-simulation","labels-cities","labels-features","labels-economy"],getTL:function(key,zoom,fnDate){return new L.Proj.TileLayer.TMS("/images/explorer/layers/arc-mask/arc-mask-{z}-{y}-{x}.png",Crs["3413"](zoom,key),{transpic:"/images/explorer/trans.512.png",noBlack:true,tms:false,minZoom:0,maxZoom:zoom.max-zoom.min,attribution:"",
tileSize:512,noWrap:true,continuousWorld:true,key:key})}}},{"arc-ter":{enabled:true,index:3,type:"base",order:20,epsg:"3413",name:"Arctic - True Color",icon:"/images/explorer/maps/arc-341-icon.png",comment:"This is how it looks from space with a naked eye. In winter the black spot marks the Arctic night",timeRange:timeRanges["arc-gibs"],latlngzoom:[90,0,3],zoom:{min:3,max:9,off:0,diff:0},overlays:["sic-amsr2","labels-cities","labels-features","gfs-forecast"],getTL:function(key,zoom,fnDate){return new L.Proj.TileLayer.TMS(IMAGEOVERLAYROOT+
"terra-341/{s}.{d}.{z}.{y}.{x}",Crs["3413"](zoom,key),{subdomains:["map1","map1a","map1b","map1c"],d:fnDate,noBlack:true,tms:false,transpic:"/images/explorer/trans.512.png",minZoom:0,maxZoom:zoom.max-zoom.min,attribution:'<a href="https://wiki.earthdata.nasa.gov/display/GIBS/">Earthdata</a>',tileSize:512,noWrap:true,continuousWorld:true,key:key,zoomOffset:-1})}}},{"arc-367":{enabled:true,index:4,type:"base",order:30,epsg:"3413",name:"Arctic - Infrared",icon:"/images/explorer/maps/arc-367-icon.png",
comment:"Layer including infrared band, allows to distuinguish clouds and ice.",timeRange:timeRanges["arc-gibs"],latlngzoom:[90,0,3],zoom:{min:3,max:9,off:0,diff:0},overlays:["sic-amsr2","labels-cities","labels-features"],getTL:function(key,zoom,fnDate){return new L.Proj.TileLayer.TMS(IMAGEOVERLAYROOT+"terra-367/{s}.{d}.{z}.{y}.{x}",Crs["3413"](zoom,key),{subdomains:["map1","map1a","map1b","map1c"],d:fnDate,noBlack:true,tms:false,transpic:"/images/explorer/trans.512.png",minZoom:0,maxZoom:zoom.max-
zoom.min,attribution:'<a href="https://wiki.earthdata.nasa.gov/display/GIBS/">Earthdata</a>',tileSize:512,noWrap:true,continuousWorld:true,key:key,zoomOffset:-1})}}},{"arc-721":{enabled:true,index:5,type:"base",order:40,epsg:"3413",name:"Arctic - False Color",icon:"/images/explorer/maps/arc-721-icon.png",comment:"Layer with false colors, saturation of the blue band indicates 'ice wetness",timeRange:timeRanges["arc-gibs"],latlngzoom:[90,0,3],zoom:{min:3,max:9,off:0,diff:0},overlays:["sic-amsr2","labels-cities",
"labels-features"],getTL:function(key,zoom,fnDate){return new L.Proj.TileLayer.TMS(IMAGEOVERLAYROOT+"terra-721/{s}.{d}.{z}.{y}.{x}",Crs["3413"](zoom,key),{subdomains:["map1","map1a","map1b","map1c"],d:fnDate,noBlack:true,tms:false,transpic:"/images/explorer/trans.512.png",minZoom:0,maxZoom:zoom.max-zoom.min,attribution:'<a href="https://wiki.earthdata.nasa.gov/display/GIBS/">Earthdata</a>',tileSize:512,noWrap:true,continuousWorld:true,key:key,zoomOffset:-1})}}},{"arc-aqa":{enabled:true,index:6,type:"base",
order:50,epsg:"3413",name:"Arctic - True Color (Aqua)",icon:"/images/explorer/maps/arc-341-icon.png",comment:"Similar to Terra, but with a different time of overpass",timeRange:timeRanges["arc-gibs"],latlngzoom:[90,0,3],zoom:{min:3,max:9,off:0,diff:0},overlays:["sic-amsr2","labels-cities","labels-features","gfs-forecast"],getTL:function(key,zoom,fnDate){return new L.Proj.TileLayer.TMS(IMAGEOVERLAYROOT+"aqua-341/{s}.{d}.{z}.{y}.{x}",Crs["3413"](zoom,key),{subdomains:["map1","map1a","map1b","map1c"],
d:fnDate,noBlack:true,tms:false,transpic:"/images/explorer/trans.512.png",minZoom:0,maxZoom:zoom.max-zoom.min,attribution:'<a href="https://wiki.earthdata.nasa.gov/display/GIBS/">Earthdata</a>',tileSize:512,noWrap:true,continuousWorld:true,key:key})}}},{"ter-341":{enabled:true,index:7,type:"base",order:60,name:"Terra - True Color",icon:"/images/explorer/maps/ter-341-icon.png",comment:"The earth as seen from the MODIS instrument at a 700km orbit. Updates within 3 hours after overpass.",epsg:"4326",
timeRange:timeRanges["ter-gibs"],latlngzoom:[10,0,1],zoom:{min:0,max:8,off:0,diff:0},getTL:function(key,zoom,fnDate){return new L.Proj.TileLayer.TMS("http://{s}.vis.earthdata.nasa.gov/wmts-geo/MODIS_Terra_CorrectedReflectance_TrueColor/default/{d}/EPSG4326_250m/{z}/{y}/{x}.jpg",Crs["4326"](zoom),{noBlack:false,subdomains:["map1","map1a","map1b","map1c"],d:fnDate,tms:false,transpic:"/images/explorer/trans.512.png",minZoom:zoom.min,maxZoom:zoom.max,tileSize:512,noWrap:true,continuousWorld:true,attribution:'<a href="https://wiki.earthdata.nasa.gov/display/GIBS/">NASA-Earthdata</a>',
key:key})}}},{"ter-721":{enabled:true,index:8,type:"base",order:70,name:"Terra - False Color",icon:"/images/explorer/maps/ter-721-icon.png",comment:"MODIS false color images, with bands 712 mapped onto a RGB spectrum",epsg:"4326",timeRange:timeRanges["ter-gibs"],latlngzoom:[10,0,1],zoom:{min:0,max:8,off:0,diff:0},getTL:function(key,zoom,fnDate){return new L.Proj.TileLayer.TMS("http://{s}.vis.earthdata.nasa.gov/wmts-geo/MODIS_Terra_CorrectedReflectance_Bands721/default/{d}/EPSG4326_250m/{z}/{y}/{x}.jpg",
Crs["4326"](zoom),{subdomains:["map1","map1a","map1b","map1c"],d:fnDate,transpic:"/images/explorer/trans.512.png",noBlack:false,tms:false,minZoom:zoom.min,maxZoom:zoom.max,tileSize:512,noWrap:true,continuousWorld:true,attribution:'<a href="https://wiki.earthdata.nasa.gov/display/GIBS/">NASA-Earthdata</a>',key:key})}}},{"ant-ter":{enabled:true,index:9,type:"base",order:80,epsg:"3031",name:"Antarctic - True Color",icon:"/images/explorer/maps/ant-ter-icon.png",comment:"This is how it looks from space with a naked eye. In winter the black spot marks the Antarctic night",
timeRange:timeRanges["ant-gibs"],latlngzoom:[-90,0,3],zoom:{min:3,max:9,off:0,diff:0},overlays:["labels-antarctic"],getTL:function(key,zoom,fnDate){return new L.Proj.TileLayer.TMS(IMAGEOVERLAYROOT+"ant-terra/{s}.{d}.{z}.{y}.{x}",Crs["3031"](zoom,key),{subdomains:["map1","map1a","map1b","map1c"],d:fnDate,noBlack:true,tms:false,transpic:"/images/explorer/trans.512.png",minZoom:0,maxZoom:zoom.max-zoom.min,attribution:'<a href="https://wiki.earthdata.nasa.gov/display/GIBS/">Earthdata</a>',tileSize:512,
noWrap:true,continuousWorld:true,key:key,zoomOffset:-1})}}},{"bwm-mapnik":{enabled:true,index:10,type:"base",order:120,name:"Openstreet Map (b/w)",icon:"/images/explorer/maps/bwm-mapnik-icon.png",comment:"Beautiful black/white Openstreet Map, good for a low bandwidth connection.",epsg:"3857",crs:L.CRS.EPSG3857,latlngzoom:[0,0,1],zoom:{diff:0,min:0,max:18},overlays:["owm-temps","owm-press"],getTL:function(key,zoom){return new L.TileLayer("http://{s}.www.toolserver.org/tiles/bw-mapnik/{z}/{x}/{y}.png",
{key:key,minZoom:0,maxZoom:18,attribution:'&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'})}}},{"owm-temps":{enabled:true,index:11,type:"map-overlay",order:200,name:"Temperature",icon:"/images/explorer/maps/owm-temps-icon.png",comment:"worldwide, by OpenWeatherMap",epsg:"3857",zoom:{diff:0,min:0,max:18},getTL:function(key,zoom){return new L.TileLayer("http://{s}.tile.openweathermap.org/map/temp/{z}/{x}/{y}.png",
{key:key,subdomains:"1234",maxZoom:18,opacity:0.4,attribution:'IMap data &copy; <a href="http://openweathermap.org">OpenWeatherMap</a>'})}}},{"owm-press":{enabled:true,index:12,type:"map-overlay",order:210,name:"Sea Level Pressure",icon:"/images/explorer/maps/owm-press-icon.png",comment:"worldwide, by OpenWeatherMap",epsg:"3857",zoom:{diff:0,min:0,max:18},getTL:function(key,zoom){return new L.TileLayer("http://{s}.tile.openweathermap.org/map/pressure_cntr/{z}/{x}/{y}.png",{key:key,subdomains:"1234",
maxZoom:18,opacity:0.4,attribution:'IMap data &copy; <a href="http://openweathermap.org">OpenWeatherMap</a>'})}}},{"arctic-coat":{enabled:true,index:15,type:"map-overlay",order:300,name:"Arctic - Coastlines",icon:"/images/explorer/maps/sic-amsr2-icon.png",comment:"",epsg:"3413",crs:Crs["3413"],getTL:function(){return new L.Proj.TileLayer.TMS("https://map1c.vis.earthdata.nasa.gov/wmts-arctic/wmts.cgi?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=arctic_coastlines_3413&STYLE=&TILEMATRIXSET=EPSG3413_250m&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&FORMAT=image%2Fpng",
Crs["3413"],{subdomains:["map1","map1a","map1b","map1c"],transpic:"/images/explorer/trans.512.png",tms:false,minZoom:0,maxZoom:5,attribution:"",tileSize:512,noWrap:true,continuousWorld:true})}}},{"arc-sentinel":{enabled:true,index:2,type:"base",order:15,epsg:"3995",name:"Sentinel 2 - Arctic",icon:"/images/explorer/maps/arc-sentinel2.png",comment:"NRT true color swaths from ESA's Sentinel Satellite",latlngzoom:[90,0,3],zoom:{min:0,max:12,off:0,diff:0},overlays:["labels-cities","labels-features"],timeRange:timeRanges["arc-sentinel"],
getTL:function(key,zoom){return new L.tileLayer.sentinel("http://services.eocloud.sentinel-hub.com/v1/wms/{s}",{subdomains:["ff6d8302-2479-4a5a-9406-255d87cab12f","b4144647-aedd-421f-8bfa-e93803bed520","3edfd6dc-9de1-4e93-ae14-f49d8e73b0af","de23c422-a74b-49ef-952f-335714aca15a"],transpic:"/images/explorer/trans.512.png",layers:"1_TRUE_COLOR",format:"image/png",transparent:true,version:"1.3.1",attribution:'<a href="https://www.sentinel-hub.com/">Sentinel-Hub</a>',srs:"EPSG:3995",tileSize:512,noWrap:true,
continuousWorld:false,minZoom:zoom.min,maxZoom:zoom.max-zoom.min})}}},{"arc-sentinel_3":{enabled:true,index:13,type:"base",order:16,epsg:"3995",name:"Sentinel 2 - Arctic (3 days)",icon:"/images/explorer/maps/arc-sentinel2.png",comment:"Composite of last 3 days swaths from ESA's Sentinel Satellite",latlngzoom:[90,0,3],zoom:{min:0,max:12,off:0,diff:0},overlays:["labels-cities","labels-features"],timeRange:timeRanges["arc-sentinel"],getTL:function(key,zoom){return new L.tileLayer.sentinel("http://services.eocloud.sentinel-hub.com/v1/wms/{s}",
{buildDate:function(day){return"&TIME="+utc(day).delta("days",-3).toIso()+"/"+day},subdomains:["814e7a7a-d0b4-4355-a327-2e490cf268a2"],transpic:"/images/explorer/trans.512.png",layers:"1_TRUE_COLOR",format:"image/png",transparent:true,version:"1.3.1",attribution:'<a href="https://www.sentinel-hub.com/">Sentinel-Hub</a>',srs:"EPSG:3995",tileSize:512,noWrap:true,continuousWorld:false,minZoom:zoom.min,maxZoom:zoom.max-zoom.min})}}},{"gfs-simulation":{enabled:DEBUG,index:21,type:"sim-overlay",order:310,
name:"Weather Simulation",icon:"/images/explorer/maps/gfs-simulation.png",comment:"Surface conditions (2m temp, 10m wind)",epsg:"3413",bounds:[[38.8,180],[38.8,0]],opacity:0.6,urlPattern:IMAGEOVERLAYROOT+"gfs/%Y/gfs-%Y-%m-%d-%H.png",timeRange:timeRanges["gfs-simulation"],attribution:"<a href='http://nomads.ncep.noaa.gov/txt_descriptions/GFS_high_resolution_doc.shtml'>NCEP/GFS</a>",colorbar:"/images/explorer/cbar-gfs.png"}},{"gfs-forecast":{enabled:true,index:16,type:"image-overlay",order:400,name:"GFS Forecast",
icon:"/images/explorer/maps/gfs-temps-icon.png",comment:"Surface conditions (2m temp, 10m wind (>10m/s), SLP)",epsg:"3413",bounds:[[38.8,180],[38.8,0]],opacity:0.6,urlPattern:IMAGEOVERLAYROOT+"gfs/%Y/gfs-%Y-%m-%d-%H.png",timeRange:timeRanges["gfs-forecast"],attribution:"<a href='http://nomads.ncep.noaa.gov/txt_descriptions/GFS_high_resolution_doc.shtml'>NCEP/GFS</a>",colorbar:"/images/explorer/cbar-gfs.png"}},{"sst-avhrr":{enabled:true,index:22,type:"image-overlay",order:410,name:"Sea Surface Temp.",
icon:"/images/explorer/maps/sit-smos-icon.png",comment:"Daily Sea Surface Temperature (AVHRR)",epsg:"3413",bounds:[[38.8,180],[38.8,0]],opacity:0.9,urlPattern:IMAGEOVERLAYROOT+"sst/%Y/sst-%Y-%m-%d.png",timeRange:timeRanges["sst-avhrr"],attribution:"",colorbar:""}},{"sic-amsr2":{enabled:true,index:17,type:"image-overlay",order:420,name:"Sea Ice Concentration",icon:"/images/explorer/maps/sic-amsr2-icon.png",comment:"Daily high resolution maps from the AMSR2 instrument",epsg:"3413",bounds:[[38.8,180],
[38.8,0]],opacity:0.9,urlPattern:IMAGEOVERLAYROOT+"amsr2/%Y/amsr2-%Y-%m-%d.png",timeRange:timeRanges["sic-amsr2"],attribution:'<a href="ftp://ftp-projects.zmaw.de/seaice/AMSR2/README.txt">University of Hamburg</a>'}},{"sit-cryosat":{enabled:true,index:18,type:"image-overlay",order:430,name:"CryoSat Thickness",icon:"/images/explorer/maps/sit-smos-icon.png",comment:"Monthly (winter) thickness from the ESA's CryoSat 2 satellite",epsg:"3413",bounds:[[38.8,180],[38.8,0]],opacity:0.9,urlPattern:IMAGEOVERLAYROOT+
"cryosat/%Y/cryosat-%Y-%m.png",timeRange:timeRanges["sit-cryosat"],attribution:'<a href="http://www.awi.de/en/home/">AWI</a>',colorbar:"/images/explorer/cbar-cryo.png"}},{"sit-smos":{enabled:true,index:19,type:"image-overlay",order:440,name:"SMOS Thickness",icon:"/images/explorer/maps/sit-smos-icon.png",comment:"Daily (winter) sea ice thickness (m) from the ESA's SMOS satellite",epsg:"3413",bounds:[[38.8,180],[38.8,0]],opacity:0.9,urlPattern:IMAGEOVERLAYROOT+"smos/%Y/smos2-%Y-%m-%d.png",timeRange:timeRanges["sit-smos"],
attribution:'<a href="http://icdc.zmaw.de/l3c_smos_sit.html">University of Hamburg</a>',colorbar:"/images/explorer/cbar-smos.png"}},{"sit-piomas":{enabled:true,index:20,type:"image-overlay",order:450,name:"PIOMAS Thickness",icon:"/images/explorer/maps/sit-smos-icon.png",comment:"Monthly thickness from the PSC's sea ice model",epsg:"3413",bounds:[[38.8,180],[38.8,0]],opacity:0.9,urlPattern:IMAGEOVERLAYROOT+"piomas/%Y/piomas-%Y-%m.png",timeRange:timeRanges["sit-piomas"],attribution:'<a href="http://psc.apl.washington.edu/wordpress/research/projects/projections-of-an-ice-diminished-arctic-ocean/data-piomas/">PSC</a>',
colorbar:"/images/explorer/cbar-cryo.png"}},{"labels-cities":{enabled:true,index:25,type:"marker-overlay",order:500,name:"Cities &amp; Places",icon:"/images/explorer/maps/sic-amsr2-icon.png",comment:"A few significant human settlements",style:"aio-label-marker-red",data:{"Paris":{coords:[48.8569298,2.3412001],lvl:2,style:"-bold"},"London":{coords:[51.506321,-0.12714],lvl:0,style:"-bold"},"Berlin":{coords:[52.5160713,13.3769798],lvl:0,style:"-bold"},"Copenhagen":{coords:[55.6756783,12.5676003],lvl:2,
style:"-bold"},"Oslo":{coords:[59.912281,10.74998],lvl:0,style:"-bold"},"Stockholm":{coords:[59.3323288,18.0629292],lvl:1,style:"-bold"},"Helsinki":{coords:[60.1711617,24.9326496],lvl:0,style:"-bold"},"Moscow":{coords:[55.751709,37.6180229],lvl:0,style:"-bold"},"Nuuk":{coords:[64.1812057,-51.72995],lvl:0,style:"-bold"},"Reykjavik":{coords:[64.1474075,-21.9339905],lvl:0,style:"-bold"},"Warsaw":{coords:[52.2287483,21.0062504],lvl:2,style:"-bold"},"Ulan Bator":{coords:[47.9221001,106.9169693],lvl:3,
style:"-bold"},"Minsk":{coords:[53.8832016,27.5042992],lvl:4,style:"-bold"},"Alert":{coords:[82.5137,-62.332],lvl:1,style:""},"Ambarchik":{coords:[69.6138229,162.2874603],lvl:4,style:""},"Anadyr\u2019":{coords:[64.735672,177.5073853],lvl:3,style:""},"Anchorage":{coords:[61.2175484,-149.8583832],lvl:0,style:""},"Arkhangel\u2019sk":{coords:[64.5377426,40.5155792],lvl:2,style:""},"Barcelona":{coords:[41.3855782,2.16874],lvl:3,style:""},"Barrow":{coords:[71.2888184,-156.7923737],lvl:1,style:""},"Bordeaux":{coords:[44.8366318,
-0.58105],lvl:4,style:""},"Chicago":{coords:[41.8841515,-87.6324081],lvl:3,style:""},"Churchill":{coords:[58.7691193,-94.1679535],lvl:3,style:""},"Cologne":{coords:[50.9416695,6.9551601],lvl:3,style:""},"Edmonton":{coords:[53.5462418,-113.4903717],lvl:3,style:""},"Fairbanks":{coords:[64.8450775,-147.7220612],lvl:4,style:""},"Glasgow":{coords:[55.857811,-4.2425299],lvl:4,style:""},"Hammerfest":{coords:[70.6623917,23.6835308],lvl:4,style:""},"Inuvik":{coords:[68.3610535,-133.7349243],lvl:3,style:""},
"Iqaluit":{coords:[63.753582,-68.502802],lvl:2,style:""},"Irkutsk":{coords:[52.3082504,104.2391434],lvl:2,style:""},"Juneau":{coords:[58.2997398,-134.4067841],lvl:2,style:""},"Kangerlussuaq":{coords:[67.0086111,-50.6891667],lvl:4,style:""},"Kodiak":{coords:[57.79629,-152.41455],lvl:4,style:""},"Labrador City":{coords:[52.9500313,-66.9145126],lvl:3,style:""},"Longyearbyen":{coords:[78.2185898,15.6487484],lvl:4,style:""},"Minneapolis":{coords:[44.9790306,-93.2649307],lvl:3,style:""},"Murmansk":{coords:[68.9727936,
33.0868492],lvl:1,style:""},"Nome":{coords:[64.4994736,-165.4057922],lvl:3,style:""},"Noril'sk":{coords:[69.3473434,88.2070236],lvl:3,style:""},"Okhotsk":{coords:[59.3628998,143.2270813],lvl:4,style:""},"Resolute":{coords:[74.683333,-94.9],lvl:1,style:""},"Surgut":{coords:[61.2549515,73.4354019],lvl:3,style:""},"Tiksi":{coords:[71.6362381,128.8588562],lvl:0,style:""},"Upermavik":{coords:[72.7913589,-56.1552811],lvl:3,style:""},"Vorkuta":{coords:[67.5015869,64.0609665],lvl:3,style:""},"Winnipeg":{coords:[49.8995285,
-97.1411133],lvl:3,style:""},"Yakutsk":{coords:[62.0330429,129.7196808],lvl:3,style:""},"Yellowknife":{coords:[62.4544792,-114.3709488],lvl:3,style:""},"\u00dcr\u00fcmqi":{coords:[43.7878685,87.5862732],lvl:3,style:""}}}},{"labels-features":{enabled:true,index:26,type:"marker-overlay",order:510,name:"Geographic Features",icon:"/images/explorer/maps/sic-amsr2-icon.png",comment:"Seas, Glaciers, Islands, etc.",style:"aio-label-marker",data:{"Petermann Glacier":{coords:[80.75,-60.75],lvl:0,style:"-magenta"},
"Wrangel":{coords:[71.1999969,-179.4799957],lvl:4,style:"-green"},"Jan Mayen":{coords:[70.9710007,-8.4879999],lvl:3,style:"-green"},"Greenland Sea":{coords:[75,-10],lvl:3,style:"-blue"},"Hudson Bay":{coords:[59.9821968,-85.762825],lvl:3,style:"-blue"},"Lincoln Sea":{coords:[83.6,-55],lvl:3,style:"-blue"},"Kara Sea":{coords:[75.4245911,80.4504166],lvl:3,style:"-blue"},"Barents Sea":{coords:[75,40],lvl:3,style:"-blue"},"Baffin Bay":{coords:[73,-67],lvl:3,style:"-blue"},"Bering Sea":{coords:[59.4500008,
-177.6900024],lvl:3,style:"-blue"},"Beaufort Sea":{coords:[70.526108,-141.498886],lvl:3,style:"-blue"},"Chukchi Sea":{coords:[69.37269,-170.39854],lvl:3,style:"-blue"},"Davis Strait":{coords:[60.85101,-63.39802],lvl:3,style:"-blue"},"North Pole":{coords:[90,0],lvl:3,style:"-orange"},"Lake Superior":{coords:[47.5271988,-87.7548981],lvl:4,style:"-blue"},"Laptev Sea":{coords:[75.06545,126.90263],lvl:3,style:"-blue"},"Magnetic Pole":{coords:[86.395,193.71],lvl:2,style:"-orange"},"Arctic Ocean":{coords:[85,
-180],lvl:0,style:"-blue"},"Jakobshavn Glacier":{coords:[69.1666,-49.833],lvl:3,style:"-magenta"},"Helheim Glacier":{coords:[66.35,-38.2],lvl:0,style:"-magenta"},"Zachariae Isstrom":{coords:[78.916667,-21.166667],lvl:3,style:"-magenta"}}}},{"labels-economy":{enabled:true,index:27,type:"marker-overlay",order:520,name:"Resource Extraction",icon:"/images/explorer/maps/sic-amsr2-icon.png",comment:"EEZs, Oil rigs, mining projects, pipelines, harbours, airports, etc",style:"aio-label-marker",data:{"Isua Project":{coords:[65.188881,
-49.7586695],lvl:3,style:"-black",link:""},"Prirazlomnaya":{coords:[69.251944,57.342778],lvl:3,style:"-black",link:""}}}},{"labels-marker":{enabled:true,index:28,type:"marker-overlay",order:530,name:"Wikimarker",icon:"",comment:"",style:"aio-label-marker",data:{"Isua Project":{coords:[65.188881,-49.7586695],lvl:3,style:"-black",link:""},"Prirazlomnaya":{coords:[69.251944,57.342778],lvl:3,style:"-black",link:""}}}},{"labels-antarctic":{enabled:true,index:29,type:"marker-overlay",order:540,name:"Place Names",
icon:"",comment:"",style:"aio-label-marker",data:{"Weddell Sea":{coords:[-73,-45],lvl:3,style:"-blue"},"Ross Sea":{coords:[-75,-175],lvl:3,style:"-blue"},"Davis Sea":{coords:[-66,93.5],lvl:3,style:"-blue"},"Bellingshausen Sea":{coords:[-71,-85],lvl:3,style:"-blue"},"Amundsen Sea":{coords:[-72.5,-111.91667],lvl:3,style:"-blue"},"Byrd Station":{coords:[-80.01667,-119.53333],lvl:3,style:"-red"},"Georg von Neumayer Station":{coords:[-70.61667,-8.36],lvl:3,style:"-red"},"McMurdo Station":{coords:[-77.85,
166.66667],lvl:3,style:"-red"},"Vostok Station":{coords:[-78.46442,106.83733],lvl:3,style:"-red"},"Eilers Peak":{coords:[-80.06667,159.46667],lvl:3,style:"-green"},"Aurora Peak":{coords:[-67.38333,144.2],lvl:3,style:"-green"},"Pine Island Glacier":{coords:[-75,-101],lvl:3,style:"-magenta"},"South Pole":{coords:[-90,0],lvl:3,style:"-orange"}}}},{"labels-antarctic-icebergs":{enabled:false,index:29,type:"marker-overlay",order:550,name:"Large Icebergs",icon:"",comment:"",style:"aio-label-marker",data:{"Weddell Sea":{coords:[-73,
-45],lvl:3,style:"-blue"}}}}],all:function(key,type){var i,obj,lay,accu=[];type=type||"base";for(i in Layers[type])if(Layers[type].hasOwnProperty(i)){key=H.firstAttr(Layers[type][i]);lay=Layers[type][i][key];if(lay.enabled){lay.key=key;accu.push(lay)}}return accu},filter:function(fn,sorted){var layers;if(typeof sorted==="undefined")sorted=true;layers=Layers.all().filter(fn);if(sorted)return layers.sort(function(a,b){return a.order-b.order});else return layers},byKey:function(key,type){var i,j,obj;
type=type||"base";for(i in Layers[type])if(Layers[type].hasOwnProperty(i))for(j in Layers[type][i])if(Layers[type][i].hasOwnProperty(j))if(j===key){obj=Layers[type][i][j];obj.key=key;return obj}},byIndex:function(index,type){var i,lay,key;type=type||"base";for(i in Layers[type])if(Layers[type].hasOwnProperty(i)){key=H.firstAttr(Layers[type][i]);lay=Layers[type][i][key];if(lay.index===index){lay.key=key;return lay}}},code2layers:function(code){var i,layers=[];code=H.Base62.toNumber(code);function bit(i,
test){return i&1<<test}for(i=0;i<32;i++)if(bit(code,i))layers.push(i);return layers.sort(function(a,b){return a-b})},layers2code:function(layers){var out=0;if(!layers.length)return null;layers.forEach(function(l){out+=1<<l});return H.Base62.fromNumber(out)},deb:function(){Layers.all().sort(function(a,b){return a.index-b.index}).forEach(function(l){var key="                 "+l.key;var cod=Layers.layers2code([l.index]);console.log(key.substr(key.length-18),"\t",l.index,"\t",cod,"\t",l.order,"\t",JSON.stringify(l.zoom))})}};
(function(){var l,n,layers=[];for(l in Layers.base)for(n in Layers.base[l])layers.push(n);TIM.step("LOADED","Layers: "+layers.length)})();
var MAPS=function(){var self,isSplitScreen=false,dfLocation="/explorer/8//3-N90-E0/",wikiMarkers=[null,null],mapR={map:null,div:null,list:{},overs:{},ctrls:{},timeRange:new TimeRange},mapL={map:null,div:null,list:{},overs:{},ctrls:{},timeRange:new TimeRange},layout={paddingTop:52,borderCenter:4},divMsgOverlay,geocoder=new google.maps.Geocoder,debTitle=true,status={lay1:[],lay2:[],day1:null,day2:null,lat:null,lng:null,zoom:null},ignore={events:false};function getMapTL(map){return map._layers[H.firstAttr(map._layers)]}
return{deb:function(){var rTL=getMapTL(mapR.map),lTL=getMapTL(mapL.map),rZo=rTL.options.minZoom+"/"+rTL.options.maxZoom,lZo=lTL.options.minZoom+"/"+lTL.options.maxZoom,rZi=mapR.map.options.crs.options.zoomInfo.min+"/"+mapR.map.options.crs.options.zoomInfo.max+"/"+mapR.map.options.crs.options.zoomInfo.off,lZi=mapL.map.options.crs.options.zoomInfo.min+"/"+mapL.map.options.crs.options.zoomInfo.max+"/"+mapL.map.options.crs.options.zoomInfo.off,rLY=Layers.byIndex(status.lay1[0]),lLY=Layers.byIndex(status.lay2[0]),
rYz=rLY.zoom.min+"/"+rLY.zoom.max,lYz=lLY.zoom.min+"/"+lLY.zoom.max;console.table([["side","mZoom","cZoom","lKey","tlZoom","lyZoom"],["right",mapR.map.getZoom(),rZi,rTL.key,rZo,rYz],["left",mapL.map.getZoom(),lZi,lTL.key,lZo,lYz]])},oversource:"",left:mapL,right:mapR,status:status,ignore:ignore,layout:layout,markers:wikiMarkers,transpic:"/images/explorer/trans.512.png",notavail:"/images/explorer/notavail.512.png",isSplitScreen:function(){return isSplitScreen},boot:function(){self=this;window.onload=
this.onload;window.onresize=this.updateSize;window.onhashchange=this.onhashchange;return this},onhashchange:function(){console.log("Hash",location.hash)},onload:function(){var path=location.pathname||dfLocation;TIM.step("LOADING","Hash: "+path);mapR.div=$("#mapR");mapL.div=$("#mapL");self.parseLocation(path);self.updateSize();self.prepBaseList("right");self.prepBaseList("left");self.createMap("right");self.createMap("left");self.updateControls("right");self.updateControls("left");self.activateMap("right");
self.activateMap("left");self.initOverlays();self.initMarker();self.updateAttribution();self.updateSplitScreen(isSplitScreen);self.updateTime();self.updatePerma();$(mapR.ctrls.loader._container).css({"box-shadow":"0 0","background":"transparent"});$(mapL.ctrls.loader._container).css({"box-shadow":"0 0","background":"transparent"});$(".leaflet-control-loading").parent().css({background:"#666"});$("form.leaflet-control-layers-list").css({margin:"4px 6px"});$("#mapContainer").css({background:"#740F0F"});
$("#msgs-overlay").css({display:"none"});$("#navPerma img").css({"background":"transparent","background-image":"url()","padding-left":"2px"});TIM.step("LOADED","Maps")},updateSize:function(){var navHeight=$(".navbar").height(),trnHeight=$("#sec-maphead").height(),w=$(window).width(),t=fullScreenApi.isFullScreen()?trnHeight:navHeight+trnHeight,h=$(window).height()-t,b=layout.borderCenter/2;if(isSplitScreen){mapR.div.css({top:t+"px",height:h+"px",width:w/2-b+"px",left:w/2+b+"px"});mapL.div.css({top:t+
"px",height:h+"px",width:w/2-b+"px",left:0})}else{mapR.div.css({top:t+"px",height:h+"px",width:w+"px",left:0});mapL.div.css({top:t+"px",height:h+"px",width:0,left:0})}if(mapL.map){mapL.map.invalidateSize();mapR.map.invalidateSize()}},geocode:function(){var loc,cmpnts,types,center=mapR.map.getCenter(),latlng=new google.maps.LatLng(center.lat,center.lng);mapR.map.fire("dataloading");mapL.map.fire("dataloading");geocoder.geocode({latLng:latlng},function(res,stats){var locs=[];mapR.map.fire("dataload");
mapL.map.fire("dataload");if(stats===google.maps.GeocoderStatus.OK){res.reverse().forEach(function(r,idx){cmpnts=r.address_components.map(function(c){return c.short_name});types=r.types.reduce(function(a,b){return a+", "+b},"")});if(res.length===0)locs.push("uninhabited");else{if(res[0].types[0]==="country"){locs.push(res[0].address_components[0].short_name);locs.push(res[0].address_components[0].long_name)}if(res.length===2)locs.push(res[1].address_components[0].long_name);else if(res.length===3)locs.push(res[2].address_components[0].long_name);
else if(res.length>3)locs.push(res[3].address_components[0].long_name)}$("#navLocation").text(locs.join(" "))}else if(stats===google.maps.GeocoderStatus.ZERO_RESULTS)$("#navLocation").text("uninhabited");else $("#navLocation").text("unidentified");$("#navLocation").href=$("permaLink").href})},parseLocation:function(pathname){var path=(pathname||location.pathname).split("/");function ged(i,value){return i>=path.length?value:path[i]===""?value:path[i]}function layerRange(layers){var tr=new TimeRange;
if(Layers.byIndex(layers[0]).timeRange&&Layers.byIndex(layers[0]).type==="base")return Layers.byIndex(layers[0]).timeRange;else{layers.forEach(function(idx){var l=Layers.byIndex(idx);if(!!l.timeRange)tr.push(l.timeRange)});return tr}}var dfDate=utc().delta("days",-1).toIso(),dfLay=dfLocation.split("/")[2],dfCrds=dfLocation.split("/")[4],code=ged(2,dfLay).split("-"),date=ged(3,"").split(";"),coords=ged(4,"").split("-"),place=decodeURIComponent(ged(5,"")),lat,lng,baseR,baseL,timeR,timeL;status.place=
place||"";status.lay1=Layers.code2layers(code[0]);if(code.length===2){status.lay2=Layers.code2layers(code[1]);isSplitScreen=true}else status.lay2=[status.lay1[0]];baseR=Layers.byIndex(status.lay1[0]);baseL=Layers.byIndex(status.lay2[0]);if(!baseR||!baseL)console.log("parseLocation: unknown indezes",status.lay1[0],status.lay2[0]);timeR=layerRange(status.lay1);timeL=layerRange(status.lay2);if(date.length===0||date.length===1&&date[0]===""){status.day1=timeR.length()?timeR.latest():dfDate;status.day2=
timeL.length()?timeL.latest():dfDate}else if(date.length===1){status.day1=date[0];status.day2=date[0]}if(date.length===2){status.day1=date[0];status.day2=date[1]}if(coords.length!==3){coords=baseR.latlngzoom;coords=[coords[2],coords[0],coords[1]]}status.zoom=~~coords[0];status.zoom=H.bounds(status.zoom,baseR.zoom.min,baseR.zoom.max);if(isSplitScreen)status.zoom=H.bounds(status.zoom,baseL.zoom.min,baseL.zoom.max);lat=coords[1];lng=coords[2];status.lat=lat[0]==="N"?parseFloat(lat.substr(1)):lat[0]===
"S"?-parseFloat(lat.substr(1)):lat;status.lng=lng[0]==="E"?parseFloat(lng.substr(1)):lng[0]==="W"?-parseFloat(lng.substr(1)):lng;TIM.step("STATUS",JSON.stringify(status).split('"').join(""))},updatePerma:function(){var perma=$("#navPerma a"),link="/"+dfLocation.split("/")[1]+"/",title="Permalink: "+location.host+link,text="//arctic.io/"+dfLocation.split("/")[1]+"/",code,codeL,codeR,datum="",zoom,lat,lng,fragment,abs=Math.abs,rightCanDate,leftCanDate;rightCanDate=mapR.timeRange.ranges.length>0;leftCanDate=
mapL.timeRange.ranges.length>0;codeR=Layers.layers2code(status.lay1);codeL=Layers.layers2code(status.lay2);code=codeR+(isSplitScreen?"-"+codeL:"");datum=rightCanDate&&!isSplitScreen?status.day1:rightCanDate&&leftCanDate&&isSplitScreen?status.day1+";"+status.day2:!rightCanDate&&leftCanDate&&isSplitScreen?";"+status.day2:rightCanDate&&!leftCanDate&&isSplitScreen?status.day1:undefined;zoom=status.zoom;lat=status.lat.toFixed(5);lng=status.lng.toFixed(5);lat=lat<0?"S"+abs(lat):"N"+abs(lat);lng=lng<0?"W"+
abs(lng):"E"+abs(lng);fragment=[code,datum,[zoom,lat,lng].join("-")].join("/");perma.text(text+fragment);perma.attr("href",link+fragment);perma.attr("title",title+fragment)},setMarker:function(map,lat,lng,feat){var mapX=map===mapR.map?mapR:mapL,idx=map===mapR.map?0:1;if(wikiMarkers[idx]){mapX.map.removeLayer(wikiMarkers[idx]);wikiMarkers[idx]=null}if(feat){wikiMarkers[idx]=L.marker([lat,lng],{icon:new L.Label({className:"aio-label-marker-wiki",html:feat||"name me"}),clickable:true}).addTo(mapX.map);
wikiMarkers[idx].on("click",function(){});if(idx===0)status.place=feat;return wikiMarkers[idx]}},getCenter:function(map){var prj=map.options.crs.projection,sw=map.getBounds()._southWest,ne=map.getBounds()._northEast,psw=prj.project(sw),pne=prj.project(ne),x=psw.x+(pne.x-psw.x)/2,y=psw.y+(pne.y-psw.y)/2;return prj.unproject({x:x,y:y})},initMarker:function(){if(status.place){self.setMarker(mapR.map,status.lat,status.lng,status.place);self.setMarker(mapL.map,status.lat,status.lng,status.place)}},updateAttribution:function(){},
changeTime:function(cal,stamp){var mapX=cal.side==="right"?mapR:mapL,dayX=cal.side==="right"?"day1":"day2",res=mapX.timeRange.resolution(),base=cal.side==="right"?Layers.byIndex(status.lay1[0]):Layers.byIndex(status.lay2[0]),token=cal.side==="right"?base.key:base.name;status[dayX]=stamp.toIso(res);if(!!base.timeRange)mapX.list[token].redraw();H.each(mapX.overs,function(a,o){o.updateTime(stamp)});self.updateTime();self.updatePerma()},updateTime:function(){var rightCanDate,leftCanDate,res,iso;mapR.timeRange=
new TimeRange;mapL.timeRange=new TimeRange;status.lay1.forEach(function(idx){var l=Layers.byIndex(idx);if(!!l.timeRange){rightCanDate=true;mapR.timeRange.push(l.timeRange)}});status.lay2.forEach(function(idx){var l=Layers.byIndex(idx);if(!!l.timeRange){leftCanDate=true;mapL.timeRange.push(l.timeRange)}});if(rightCanDate){status.day1=status.day1||utc().toIso();res=mapR.timeRange.resolution();iso=res<4?utc(status.day1).toIso(res):utc(status.day1).format("%Y-%m-%d %Hh");mapR.ctrls.calendar.updateDisplay(iso);
mapR.ctrls.calendar.updateRange(mapR.timeRange,utc(status.day1))}mapR.ctrls.calendar._container.style.visibility=rightCanDate?"visible":"hidden";if(leftCanDate){status.day2=status.day2||utc().toIso();res=mapL.timeRange.resolution();iso=res<4?utc(status.day2).toIso(res):utc(status.day2).format("%Y-%m-%d %Hh");mapL.ctrls.calendar.updateDisplay(iso);mapL.ctrls.calendar.updateRange(mapL.timeRange,utc(status.day2))}mapL.ctrls.calendar._container.style.visibility=leftCanDate?"visible":"hidden";mapR.timeRange.log()},
initOverlays:function(){status.lay1.slice(1).forEach(function(idx){self.changeOverlay(mapR.map,Layers.byIndex(idx).key,true,true)});status.lay2.slice(1).forEach(function(idx){self.changeOverlay(mapL.map,Layers.byIndex(idx).key,true,true)})},toggleOverlay:function(layers,key){var idx=Layers.byKey(key).index,pos=layers.indexOf(idx);if(pos===-1)layers.push(idx);else layers.splice(pos,1)},changeOverlay:function(map,key,onoff,silent){var layer=Layers.byKey(key),layers=map===mapR.map?status.lay1:status.lay2,
day=map===mapR.map?status.day1:status.day2,overs=map===mapR.map?mapR.overs:mapL.overs,ctrlLayers=map===mapR.map?mapR.ctrls.layers:mapL.ctrls.layers;if(onoff)switch(layer.type){case "map-overlay":case "wms-overlay":overs[key]=layer.getTL(layer.key,layer.zoom).addTo(map);break;case "image-overlay":overs[key]=(new L.TimeOverlay(layer,utc(day))).addTo(map);break;case "sim-overlay":overs[key]=(new L.SimOverlay(layer,utc(day))).addTo(map);break;case "marker-overlay":overs[key]=(new L.MarkerOverlay(layer)).addTo(map);
break;default:throw new Error("Unknown Layer Type: "+key);}else{map.removeLayer(overs[key]);delete overs[key]}if(map===mapR.map)mapR.ctrls.layers._overlays[key]=onoff;if(!silent){self.toggleOverlay(layers,key);self.updateTime();self.updateAttribution();self.updatePerma()}ctrlLayers.update()},changeBase:function(map,newKey,forceSilent){forceSilent=typeof forceSilent==="undefined"?false:true;var newCrsTL,othCrsTL,crsZoomMin,crsZoomMax,curZoom,othZoom,side=map===mapR.map?"right":"left",curMap=map===
mapR.map?mapR.map:mapL.map,othMap=map===mapR.map?mapL.map:mapR.map,curList=map===mapR.map?mapR.list:mapL.list,othList=map===mapR.map?mapL.list:mapR.list,curLayers=map===mapR.map?status.lay1:status.lay2,othLayers=map===mapR.map?status.lay2:status.lay1,othLay=Layers.byIndex(othLayers[0]),curLay=Layers.byIndex(curLayers[0]),newLay=Layers.byKey(newKey),newCrs=Crs[newLay.epsg](newLay.zoom),curCrs=Crs[curLay.epsg](curLay.zoom),curToken=map===mapR.map?curLay.key:curLay.name,othToken=map===mapR.map?othLay.name:
othLay.key,newToken=map===mapR.map?newLay.key:newLay.name,llzoom=newLay.latlngzoom,prevFade=curMap.options.fadeAnimation,prevZoom=curMap.options.zoomAnimation,fnDate=map===mapR.map?function(){return MAPS.status.day1}:function(){return MAPS.status.day2};function getMaskCrsTLForMap(key,map){var layMask=Layers.byKey("arc-data"),zoom=key==="arc-data"?layMask.zoom:layMask.zoomAlt,fnDate=map===mapR.map?function(){return MAPS.status.day1}:function(){return MAPS.status.day2};return[Crs["3413"](zoom),layMask.getTL("arc-data",
zoom,fnDate)]}DEBUG&&console.log("Stat0",curLay.key,">",newKey,curLay.epsg,">",newLay.epsg);if(curLay.key===newKey&&!forceSilent)return;else if(newLay.epsg===curLay.epsg||forceSilent){newCrsTL=newKey==="arc-data"?getMaskCrsTLForMap(othLay.key,othMap):[Crs[newLay.epsg](newLay.zoom),newLay.getTL(newKey,newLay.zoom,fnDate)];othCrsTL=othLay.key==="arc-data"?getMaskCrsTLForMap(newKey,curMap):[];mapR.map.sync();mapL.map.sync();curLayers[0]=newLay.index;curLayers.slice(1).forEach(function(idx){var key=Layers.byIndex(idx).key;
if(H.contains(newLay.overlays,key)){self.changeOverlay(curMap,key,false,true);self.toggleOverlay(curLayers,key)}else mapR.ctrls.layers._overlays[key]=true});if(isSplitScreen){crsZoomMin=Math.max(curMap.options.crs.options.zoomInfo.min,othMap.options.crs.options.zoomInfo.min);crsZoomMax=Math.min(curMap.options.crs.options.zoomInfo.max,othMap.options.crs.options.zoomInfo.max)}else{crsZoomMin=curMap.options.crs.options.zoomInfo.min;crsZoomMax=curMap.options.crs.options.zoomInfo.max}status.zoom=H.bounds(status.zoom+
curMap.options.crs.options.zoomInfo.min,crsZoomMin,crsZoomMax)-curMap.options.crs.options.zoomInfo.min;ignore.events=true;curMap.removeLayer(curList[curToken]);curMap.options.crs=newCrsTL[0];curMap.addLayer(newCrsTL[1]);curList[newToken]=newCrsTL[1];if(othCrsTL.length){othMap.removeLayer(othList[othToken]);othMap.options.crs=othCrsTL[0];othMap.addLayer(othCrsTL[1]);othList[othToken]=othCrsTL[1]}ignore.events=false;othZoom=status.zoom;curZoom=status.zoom;othMap.setView([status.lat,status.lng],othZoom,
{reset:true,animate:false,zoom:false});curMap.setView([status.lat,status.lng],curZoom,{reset:true,animate:false,zoom:false});if(map===mapR.map)mapR.ctrls.layers.updateActiveLayer(newKey);if(forceSilent)return}else{curLayers.slice(1).forEach(function(idx){var key=Layers.byIndex(idx).key;if(newLay.overlays.indexOf(key)===-1){self.changeOverlay(curMap,key,false,true);self.toggleOverlay(curLayers,key)}else mapR.ctrls.layers._overlays[key]=true});if(newLay.timeRange)status.day2=status.day1=newLay.timeRange.latest();
else{status.day1="";status.day2=""}if(newCrs.options.domain!==curCrs.options.domain){status.lat=llzoom[0];status.lng=llzoom[1];status.zoom=llzoom[2]}self.changeBase(mapR.map,newKey,true);self.changeBase(mapL.map,newKey,true);self.prepBaseList("left");self.updateControls("left");mapR.ctrls.layers.update()}self.updateSplitScreen(isSplitScreen);self.updateTime();self.updateAttribution();self.updatePerma()},prepBaseList:function(side){var base=side==="right"?Layers.byIndex(status.lay1[0]):Layers.byIndex(status.lay2[0]),
mapX=side==="right"?mapR:mapL,dayX=side==="right"?"day1":"day2",filter=side==="right"?function(l){return l.type==="base"}:function(l){return l.type==="base"&&l.epsg===base.epsg},layers=Layers.filter(filter),token;mapX.list={};layers.forEach(function(l){token=side==="right"?l.key:Layers.byKey(l.key).name;mapX.list[token]=l.getTL(l.key,l.zoom,function(){return MAPS.status[dayX]});mapX.list[token].options.side=side;mapX.list[token].options.timeRange=base.timeRange;mapX.list[token].options.key=l.key})},
updateControls:function(side){var mapX=side==="right"?mapR:mapL,indx=side==="right"?status.lay1[0]:status.lay2[0],base=Layers.byIndex(indx);mapX.ctrls.loader=mapX.ctrls.loader||(new L.Control.Loading).addTo(mapX.map);mapX.ctrls.slider=mapX.ctrls.slider||(new L.Control.Zoom).addTo(mapX.map);mapX.ctrls.recticle=mapX.ctrls.recticle||(new L.Control.Recticle).addTo(mapX.map);mapX.ctrls.full=mapX.ctrls.full||(new L.Control.FullScreen).addTo(mapX.map);mapX.ctrls.split=mapX.ctrls.split||(new L.Control.SplitScreen).addTo(mapX.map);
mapX.ctrls.coords=mapX.ctrls.coords||(new L.control.coordinates).addTo(mapX.map);mapX.ctrls.calendar=mapX.ctrls.calendar||(new L.Control.Calendar(utc(status.day1),{timeRange:base.timeRange})).addTo(mapX.map);mapX.ctrls.attribution=mapX.ctrls.attribution||(new L.Control.Attribution({prefix:false})).addTo(mapX.map);if(mapX===mapR)mapR.ctrls.layers=mapR.ctrls.layers||(new L.Control.PrettyLayers(base.key)).addTo(mapR.map).update();if(mapX===mapL){mapL.ctrls.layers=mapL.ctrls.layers||(new L.Control.SimpleLayers(mapL.list,
null,{position:"topright"})).addTo(mapL.map);mapL.ctrls.layers.update=L.Util.falseFn;mapL.ctrls.cursor=mapL.ctrls.cursor||(new L.Control.SplitCursor).addTo(mapL.map)}},createMap:function(side){var mapX=side==="right"?mapR:mapL,base=side==="right"?Layers.byIndex(status.lay1[0]):Layers.byIndex(status.lay2[0]),center=new L.LatLng(status.lat,status.lng),layers,name,key,zoom,$controlContainer;zoom=H.clone(base.zoom);mapX.timeRange=base.timeRange||new TimeRange;if(side==="right"){mapR.map=new L.Map("mapR",
{side:"Right",tms:true,layers:[mapR.list[base.key]],crs:Crs[base.epsg](zoom,"mp-"+base.key),center:center,zoom:status.zoom-zoom.min,fullscreenControl:false,zoomControl:false,zoomsliderControl:false,calendarControl:false,trackResize:false,attributionControl:false});if($(mapR.map._controlContainer).children().length<5){$controlContainer=$(mapR.map._controlContainer);$controlContainer.append('<div class="leaflet-top leaflet-center"></div>');mapR.map._controlCorners.topcenter=$controlContainer.children(".leaflet-top.leaflet-center").first()[0]}}else{mapL.map=
new L.Map("mapL",{side:"Left",layers:[mapL.list[base.name]],tms:true,crs:Crs[base.epsg](zoom,base.key),center:center,zoom:status.zoom-zoom.min,fullscreenControl:false,zoomControl:false,zoomsliderControl:false,calendarControl:false,trackResize:false,attributionControl:false});if($(mapL.map._controlContainer).children().length<5){$controlContainer=$(mapL.map._controlContainer);$controlContainer.append('<div class="leaflet-top leaflet-center"></div>');mapL.map._controlCorners.topcenter=$controlContainer.children(".leaflet-top.leaflet-center").first()[0]}}},
changeSplitScreen:function(){isSplitScreen=!isSplitScreen;self.updateSize();self.updateSplitScreen(isSplitScreen)},updateSplitScreen:function(){var latlng=new L.LatLng(status.lat,status.lng),zoomR=status.zoom-mapR.map.options.crs.options.zoomInfo.min,zoomL=status.zoom-mapL.map.options.crs.options.zoomInfo.min,isTouch=L.Browser.touch;mapR.map.sync();mapL.map.sync();mapL.ctrls.recticle._container.style.visibility=isSplitScreen?"visible":"hidden";mapL.ctrls.slider._container.style.visibility=isSplitScreen?
"visible":"hidden";mapL.ctrls.full._container.style.visibility=isSplitScreen?"visible":"hidden";mapL.ctrls.split._container.style.visibility=isSplitScreen?"visible":"hidden";mapL.ctrls.cursor._container.style.visibility=isTouch?"hidden":isSplitScreen?"visible":"hidden";mapR.ctrls.recticle._container.style.visibility=isSplitScreen?"hidden":"visible";mapR.ctrls.slider._container.style.visibility=isSplitScreen?"hidden":"visible";mapR.ctrls.full._container.style.visibility=isSplitScreen?"hidden":"visible";
mapR.ctrls.split._container.style.visibility=isSplitScreen?"hidden":"visible";if(!isSplitScreen)mapL.ctrls.cursor.deactivate();else{mapL.map.setView([0,0],0,{reset:true,animate:false,zoom:false});mapR.map.sync(mapL.map);mapL.map.sync(mapR.map);mapL.map.setView(latlng,zoomL,{reset:true,animate:false,zoom:false});mapR.map.setView(latlng,zoomR,{reset:true,animate:false,zoom:false})}},activateMap:function(side,activate){var map=side==="right"?mapR.map:mapL.map,ignoreMap=null;activate=typeof activate===
"undefined"?true:false;function getMapX(e){return $(e.target._container).attr("id")==="mapR"?mapR:mapL}function otherMap(map){return map===mapR.map?mapL.map:mapR.map}function coords(map){var c=map.getCenter();return c.lng+", "+c.lat+", "+map.getZoom()}function onMapMouseMove(e,map,side){console.log("EVENT."+side+".move: "+e.latlng)}function onMapZoomStart(e,map,side){}function onMapZoomEnd(e){var mapX=getMapX(e),lay=Layers.byIndex(mapX===mapR?status.lay1[0]:status.lay2[0]),zoom=lay.zoom,key=lay.key;
if(!ignore.events){status.zoom=mapX.map.getZoom();self.updatePerma()}}function onMapMoveEnd(e){var mapX=getMapX(e),c=mapX.map.getCenter();if(!ignore.events){status.lng=c.lng;status.lat=c.lat;self.geocode();self.updatePerma()}}function onMapDragEnd(e,map,side){}function onMapResize(e,map,side){}function onMouseOver(e){var mapX=getMapX(e)}function onMouseOut(e){var mapX=getMapX(e)}function onLayerRemove(e){var mapX=getMapX(e)}function onLayerAdd(e){var mapX=getMapX(e)}if(activate){map.on("zoomend",
onMapZoomEnd);map.on("moveend",onMapMoveEnd);map.on("dragend",onMapDragEnd);map.on("resize",onMapResize);map.on("layeradd",onLayerAdd);map.on("mouseover",onMouseOver);map.on("mouseout",onMouseOut);map.on("layerremove",onLayerRemove);map.on("layeradd",onLayerAdd)}else{map.off("zoomend",onMapZoomEnd);map.off("moveend",onMapMoveEnd);map.off("dragend",onMapDragEnd);map.off("resize",onMapResize);map.off("layeradd",onLayerAdd);map.off("mouseover",onMouseOver);map.off("mouseout",onMouseOut);map.off("layerremove",
onLayerRemove);map.off("layeradd",onLayerAdd)}}}}().boot();
